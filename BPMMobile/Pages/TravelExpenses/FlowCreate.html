<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta charset="utf-8" />
    <title>差旅费报销</title>
    <script type="text/javascript" src="../../../../Scripts/baidu-statistics.js"></script>
    <script type="text/javascript" src="../../../../Scripts/zepto.min.js"></script>
   
    <script type="text/javascript" src="../../../../Scripts/mui.js"></script>
    <script type="text/javascript" src="../../../../Scripts/mui.poppicker.js"></script>
    <script type="text/javascript" src="../../../../Scripts/mui.picker.min.js"></script>
    <script type="text/javascript" src="http://wb.weigaoholding.com:8090/res/js/qingjs.js"></script>
    <script type="text/javascript" src="../../../../Scripts/util.js"></script>
    <script type="text/javascript" src="../../../../Scripts/upload.js"></script>
    <script type="text/javascript" src="../../../../Scripts/upload.detail.js"></script>
   
    <script type="text/javascript" src="../../../../Scripts/calendar-selector.js"></script>
    <script type="text/javascript" src="../../../../Scripts/city.data.js"></script>
    <script type="text/javascript" src="../../../../Scripts/ApprovalUtils.js"></script>
    <link rel="stylesheet" href="../../../../Content/mui.min.css" />
    <link rel="stylesheet" href="../../../../Content/mui.picker.min.css" />
    <link rel="stylesheet" href="../../../../Content/mui.poppicker.css" />
    <link rel="stylesheet" href="../../../../Content/upload.css" />
    <link rel="stylesheet" href="../../Content/ApprovalUtils.css" />
    <link rel="stylesheet" href="../../../../Content/maintanse.css" />
    <link rel="stylesheet" href="../../../../Content/city-selector.css" />
    <link rel="stylesheet" href="../../../../Content/calendar-selector.css" />
    
</head>
<body>
   

  
                        <div class="mui-card extra_content" id="#expense_detail">
                            <ul class="mui-table-view">
                                <li class="mui-table-view-cell mui-collapse mui-active">
                                    <a href="#" class="mui-navigate-right">差旅费和区间交通费用标准</a>
                                    <div class="mui-collapse-content">
                                        <form>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-2 illustration_context">人员</div>
                                                <div class="mui-col-xs-2 illustration_context">飞机</div>
                                                <div class="mui-col-xs-2 illustration_context">高铁(动车)</div>
                                                <div class="mui-col-xs-2 illustration_context">火车</div>
                                                <div class="mui-col-xs-2 illustration_context">轮船</div>
                                                <div class="mui-col-xs-2 illustration_context">长途汽车</div>
                                            </div>
                                            <div class="mui-row ">
                                                <div class="mui-col-xs-2 illustration_context">一级</div>
                                                <div class="mui-col-xs-2 illustration_context">经济舱</div>
                                                <div class="mui-col-xs-2 illustration_context">二等座</div>
                                                <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                                                <div class="mui-col-xs-2 illustration_context">三等舱</div>
                                                <div class="mui-col-xs-2 illustration_context">实报</div>
                                            </div>
                                            <div class="mui-row ">
                                                <div class="mui-col-xs-2 illustration_context">二级</div>
                                                <div class="mui-col-xs-2 illustration_context"></div>
                                                <div class="mui-col-xs-2 illustration_context">二等座</div>
                                                <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                                                <div class="mui-col-xs-2 illustration_context">四等舱</div>
                                                <div class="mui-col-xs-2 illustration_context">实报</div>
                                            </div>
                                            <div class="mui-row ">
                                                <div class="mui-col-xs-2 illustration_context">三级</div>
                                                <div class="mui-col-xs-2 illustration_context"></div>
                                                <div class="mui-col-xs-2 illustration_context">二等座</div>
                                                <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                                                <div class="mui-col-xs-2 illustration_context">四等舱</div>
                                                <div class="mui-col-xs-2 illustration_context">实报</div>
                                            </div>
                                            <div class="mui-row ">
                                                <div class="mui-col-xs-2 illustration_context">四级</div>
                                                <div class="mui-col-xs-2 illustration_context"></div>
                                                <div class="mui-col-xs-2 illustration_context">二等座</div>
                                                <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                                                <div class="mui-col-xs-2 illustration_context">四等舱</div>
                                                <div class="mui-col-xs-2 illustration_context">实报</div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-2 illustration_context">五级</div>
                                                <div class="mui-col-xs-2 illustration_context"></div>
                                                <div class="mui-col-xs-2 illustration_context">二等座</div>
                                                <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                                                <div class="mui-col-xs-2 illustration_context">四等舱</div>
                                                <div class="mui-col-xs-2 illustration_context">实报</div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    1.常驻地为：新疆、云南、广西、贵州、广东、海南、福建、甘肃、四川、重庆、青海地区的人员可乘坐飞机；2.其他人员从公司出发到以上地区出差可按照上述地区人员标准乘坐飞机。3.其他常驻地的人员，乘坐飞机则按照火车票、轮船票的票价予以报销差旅费；
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </li>
                                <li class="mui-table-view-cell mui-collapse">
                                    <a href="#" class="mui-navigate-right">住宿费标准</a>
                                    <div class="mui-collapse-content">
                                        <form>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    人员/标准
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    一类城市
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    二类城市
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    一级
                                                </div>
                                                <div class="mui-col-xs-8 illustration_context">
                                                    280元/天
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    二级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    180元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    160元/天
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    三级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    140元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    120元/天
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    四级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    120元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    100元/天
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    五级
                                                </div>
                                                <div class="mui-col-xs-8 illustration_context">
                                                    男50元/天，女80元/天
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    审批同意指定的全国连锁酒店住宿，标准不得超过150元/天；同一地区有两名以上常住人员，必须按照公司《201406号市场房屋租赁规定》租房，否则不予报销住宿费。
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    外围市场租房标准
                                                </div>
                                                <div class="mui-col-xs-8 illustration_context">
                                                    8000元/年
                                                </div>
                                            </div>
                                            <div class="mui-row ">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    具体租房标准见《201406号市场房屋租赁规定》
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </li>
                                <li class="mui-table-view-cell mui-collapse">
                                    <a href="#" class="mui-navigate-right">市内交通费</a>
                                    <div class="mui-collapse-content">
                                        <form>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    人员/标准
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    一类城市
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    二类城市
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    一级
                                                </div>
                                                <div class="mui-col-xs-8 illustration_context">
                                                    60元/天
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    二级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    60元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    50元/天
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    三级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    50元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    40元/天
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    四级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    40元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    30元/天
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    配备办公用车的销售干部由公司由公司统一采购油卡，发往各市场，销售干部不再报销市内交通费；
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    五级
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    15元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    10元/天
                                                </div>
                                            </div>
                                            <div class="mui-row">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    护理团队业务员上市场一年以后取消市内交通补助，其他人员继续享受以上标准
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </li>
                                <li class="mui-table-view-cell mui-collapse">
                                    <a href="#" class="mui-navigate-right">餐饮费标准</a>
                                    <div class="mui-collapse-content">
                                        <form>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    类型/标准
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    一类地区
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    二类地区
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    不固定出差地的人员
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    30元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    25元/天
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    含5元的水电补助及物业费用
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    办事处统一食宿的人员
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    700元/人/月
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    600元/人/月
                                                </div>
                                            </div>
                                            <div class="mui-row bottomborder">
                                                <div class="mui-col-xs-12 illustration_context_extra">
                                                    含5元的水电补助及物业费用
                                                </div>
                                            </div>
                                            <div class="mui-row ">
                                                <div class="mui-col-xs-4 illustration_context">
                                                    报销住宿费及租房的人员
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">
                                                    20元/天
                                                </div>
                                                <div class="mui-col-xs-4 illustration_context">

                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </li>
                            </ul>
                        </div>
                 <div id="main_body">
       
                    <div id="form_main">
                        <div id="personal_info" class="mui-card">
                            <ul class="mui-table-view">
                                <li class="mui-table-view-cell mui-collapse">
                                    <a class="mui-navigate-right mui-row" href="#"><h5 class="mui-col-xs-7">报销人</h5><h5 class="mui-col-xs-5" id="fname"></h5></a>
                                    <div class="mui-collapse-content">
                                        <form class="mui-input-group">
                                            <div class="mui-input-row">
                                                <label for="fjob">职务</label>
                                                <input type="text" id="fjob" name="fjob" readonly="readonly" value="" />
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="fgrade">级别</label>
                                                <input type="text" id="fgrade" name="fgrade" readonly="readonly" value="" />
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="fsex">性别</label>
                                                <input type="text" id="fsex" name="fsex" readonly="readonly" value="" />
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="fcompany">公司名称</label>
                                                <input type="text" id="fcompany" name="fcompany" readonly="readonly" value="" />
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="fmarket">销售分公司</label>
                                                <input type="text" id="fmarket" name="fmarket" readonly="readonly" value="" />
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="fregion">大区</label>
                                                <input type="text" id="fregion" name="fregion" readonly="readonly" value="" />
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="foffice">办事处</label>
                                                <input type="text" id="foffice" name="foffice" readonly="readonly" value="" />
                                            </div>
                                        </form>
                                    </div>
                                </li>
                                <li class="mui-table-view-cell mui-collapse">
                                    <a class="mui-navigate-right mui-row" href="#"><h5 class="mui-col-xs-7">报销日期</h5><h5 class="mui-col-xs-5" id="freimbursedate2"></h5></a>
                                    <div class="mui-collapse-content">
                                        <form class="mui-input-group">
                                            <div class="mui-input-row">
                                                <label for="freimbursedate" class="">本次日期</label>
                                                <input type="date" id="freimbursedate" name="freimbursedate" value="2017-06-13" class="fdate_adj"/>
                                            </div>
                                            <div class="mui-input-row">
                                                <label for="freimburselast" class="">上次日期</label>
                                                <input type="date" id="freimburselast" name="freimburselast" value="2017-05-04" readonly="readonly" class="fdate_adj" />
                                            </div>
                                            <div class="mui-input-row" id="cwdate">
                                                <label for="freimbursepend" class="">财务审核日期</label>
                                                <input type="date" id="freimbursepend" name="freimbursepend" value="2017-06-19"  class="fdate_adj"/>
                                            </div>
                                        </form>
                                    </div>
                                </li>

                                <li class="mui-input-row">
                                    <label for="fbusinessday" class="mui-col-xs-8">出差天数</label>
                                    <input type="number" id="fbusinessday" name="fbusinessday" value=""  class="mui-col-xs-4" placeholder="请输入出差天数"/>
                                </li>

                                <li class="mui-input-row">
                                    <label for="freimbursecannumber" class="mui-col-xs-8">可报销次数</label>
                                    <input type="number" id="freimbursecannumber" name="freimbursecannumber" value="0" readonly="readonly" class="mui-col-xs-4">
                                </li>

                                <li class="mui-input-row">
                                    <label for="freimburseusenumber" class="mui-col-xs-8">本单次数</label>
                                    <input type="number" id="freimburseusenumber" name="freimburseusenumber" value="" class="mui-col-xs-4" placeholder="请输入本单次数"/>
                                </li>
                                <li class="mui-input-row">
                                    <label for="fbxhj" class="mui-col-xs-8">报销合计</label>
                                    <input type="text" id="fbxhj" name="fbxhj" value="0" readonly="readonly"  class="mui-col-xs-4"/>
                                </li>
                                <li class="mui-input-row">
                                    <label for="fcwsh" class="mui-col-xs-8">财务审核</label>
                                    <input type="text" id="fcwsh" name="fcwsh" value="0" readonly="readonly" class="mui-col-xs-4"/>
                                </li>
                            </ul>
                        </div>

                    </div>

                    <input type="hidden" id="fbm" name="fbm" value="" />
                    <input type="hidden" id="fno" name="fno" value="" />

                    <input type="hidden" id="fbsczrno" name="fbsczrno" value="" />
                    <input type="hidden" id="fbsczrsp" name="fbsczrsp" value="" />
                    <input type="hidden" id="fdqjlno" name="fdqjlno" value="" />
                    <input type="hidden" id="fdqjlsp" name="fdqjlsp" value="" />
                    <input type="hidden" id="ffgszjlno" name="ffgszjlno" value="" />
                    <input type="hidden" id="ffgszjlsp" name="ffgszjlsp" value="" />
                    <input type="hidden" id="fxsfzno" name="fxsfzno" value="" />
                    <input type="hidden" id="fxsfzsp" name="fxsfzsp" value="" />
                    <input type="hidden" id="fzjlno" name="fzjlno" value="" />
                    <input type="hidden" id="fzjlsp" name="fzjlsp" value="" />
                    <input type="hidden" id="fsckjno" name="fsckjno" value="" />
                    <input type="hidden" id="fsckjsp" name="fsckjsp" value="" />
                    <input type="hidden" id="fzgkjno" name="fzgkjno" value="" />
                    <input type="hidden" id="fzgkjsp" name="fzgkjsp" value="" />
                    <input type="hidden" id="fzjlzlno" name="fzjlzlno" value="" />
                    <input type="hidden" id="fzjlzlsp" name="fzjlzlsp" value="" />

                    <div class="mui-input-row mui-card" style="height:7rem;overflow:scroll;" id="uploaddiv">
                        <div class="border border-t upload-img" style="top:0rem;">
                            <!--上传图片-->
                            <div class="clearfix upload-btn" id="children-bg">
                                <label class="label">附件</label>
                                <span class="tips" id="imageCount"><!--已添加0张--></span>
                                <!--上传图片按钮  -->
                                <span class="upload-addbtn">
                                    <input type="file" accept="image/jpeg,image/jpg,image/png,image/jp2,image/bmp" id="file" style="opacity:0;">
                                </span>

                            </div>
                            <div class="upload-img-list"></div>
                        </div>
                    </div>
                 
                   
                    
                    <div id="form_secondary">
                       
                        
                    </div>
                     <div id="form_guide_project" class="mui-card">
                         <a id="button_tjmx" name="button_tjmx" class="mui-btn mui-btn-primary mui-btn-block mui-btn-outlined" href="#tjmx">
                             添加费用明细
                             <span class="mui-icon mui-icon-plusempty"></span>
                         </a>
                     </div>
                        <div id="form_guide_city_all">
                            <div id="form_guide_city">
                                <section id="city_header">
                                    

                                    <div id="city_show mui-card" class="city_show">
                                        <div class="mui-row">
                                            <button class="mui-btn mui-btn-primary mui-pull-left mui-col-xs-2" id="cancel_city" style="font-size:0.75rem;">取消</button>
                                            <h4 class="mui-text-center city_h mui-col-xs-8">城市选择</h4>
                                            <button class="mui-btn mui-btn-primary mui-pull-right mui-col-xs-2" id="complete_city" style="font-size:0.75rem;">完成</button>
                                        </div>
                                        <form class="mui-row">
                                            <div class="mui-col-xs-5 aim_div">
                                                <label for="fdeparture_chosen">出发地</label>
                                                <input type="hidden" id="fdeparture_citymid" name="fdeparture_citymid" />
                                                <input type="hidden" id="fdeparture_province_chosen" name="fdeparture_province_chosen">
                                                <input type="text" id="fdeparture_chosen" name="fdeparture_chosen" placeholder="请选择出发地" class="aim_input" readonly="readonly" />
                                            </div>
                                            <div class="mui-col-xs-2 mui-text-center">
                                                
                                                <span class="mui-icon mui-icon-arrowthinright arrow_adj" ></span>
                                                <input type="hidden" id="citytype_chosen" name="citytype_chosen" />
                                            </div>
                                            <div class="mui-col-xs-5 aim_div">
                                                <label for="fdestination_chosen">目的地</label>
                                                <input type="hidden" id="fdestination_citymid" name="fdestination_citymid" />
                                                <input type="hidden" id="fdestination_province_chosen" name="fdestination_province_chosen" />
                                                <input type="text" id="fdestination_chosen" name="fdestination_chosen" placeholder="请选择目的地" class="aim_input" readonly="readonly" />
                                            </div>
                                        </form>

                                    </div>
                                    <div id="city_main" class="city_main">
                                        <h5 class="mui-text-left" id="historycitylist">历史城市</h5>
                                        <div class="mui-row">
                                            <div class="mui-col-xs-4">
                                                <input type="hidden" id="history1province" name="history1province" value="山东省" class="historyprovince" />
                                                <input type="hidden" id="history1citytype" name="history1citytype" value="二类"  class="historycitytype"/>
                                                <input type="hidden" id="history1citymid" name="history1citymid" class="historycitymid"/>
                                                <button id="history1city" name="history1city" class="mui-btn mui-btn-primary city_chosen">威海市</button>
                                            </div>
                                            <div class="mui-col-xs-4">
                                                <input type="hidden" id="history2province" name="history2province" value="山东省"  class="historyprovince"/>
                                                <input type="hidden" id="history2citytype" name="history2citytype" value="二类"  class="historycitytype"/>
                                                <input type="hidden" id="history2citymid" name="history2citymid" class="historycitymid" />
                                                <button id="history2city" name="history2city" class="mui-btn mui-btn-primary city_chosen">青岛市</button>
                                           </div>    
                                            <div class="mui-col-xs-4">
                                                <input type="hidden" id="history3province" name="history3province" value="山东省" class="historyprovince"/>
                                                <input type="hidden" id="history3citytype" name="history3citytype" value="二类" class="historycitytype"/>
                                                <input type="hidden" id="history3citymid" name="history3citymid" class="historycitymid"/>
                                                <button id="history3city" name="history3city" class="mui-btn mui-btn-primary city_chosen">青岛市</button>
                                            </div>
                                        </div>
                                        <div class="mui-row" style="padding-top:0.4rem;">
                                            <div class="mui-col-xs-4">
                                                <input type="hidden" id="history4province" name="history4province" value="山东省" class="historyprovince"/>
                                                <input type="hidden" id="history4citytype" name="history4citytype" value="二类" class="historycitytype"/>
                                                <input type="hidden" id="history4citymid" name="history4citymid" class="historycitymid"/>
                                                <button id="history4city" name="history4city" class="mui-btn mui-btn-primary city_chosen">威海市</button>
                                            </div>
                                           
                                            <div class="mui-col-xs-4">
                                                <input type="hidden" id="history5province" name="history5province" value="山东省" class="historyprovince"/>
                                                <input type="hidden" id="history5citytype" name="history5citytype" value="二类" class="historycitytype"/>
                                                <input type="hidden" id="history5citymid" name="history5citymid" class="historycitymid"/>
                                                <button id="history5city" name="history5city" class="mui-btn mui-btn-primary city_chosen">青岛市</button>
                                            </div>
                                            <div class="mui-col-xs-4">
                                                <input type="hidden" id="history6province" name="history6province" value="山东省" class="historyprovince"/>
                                                <input type="hidden" id="history6citytype" name="history6citytype" value="二类" class="historycitytype"/>
                                                <input type="hidden" id="history6citymid" name="history6citymid" class="historycitymid"/>
                                                <button id="history6city" name="history6city" class="mui-btn mui-btn-primary city_chosen">青岛市</button>
                                            </div>
                                        </div>
                                        <br />
                                        <div style="display:none;">
                                            <h5 class="mui-text-left">热门城市</h5>
                                            <input type="hidden" id="hot1p" name="hot1p" value="上海市" />
                                            <input type="hidden" id="hot1t" name="hot1t" value="一类" />
                                            <button id="hot1c" name="hot1c" class="mui-btn mui-btn-primary city_chosen">上海市</button>
                                            &nbsp;
                                            <input type="hidden" id="hot2p" name="hot2p" value="北京市" />
                                            <input type="hidden" id="hot2t" name="hot2t" value="一类" />
                                            <button id="hot2c" name="hot2c" class="mui-btn mui-btn-primary city_chosen">北京市</button>
                                            &nbsp;
                                            <!--<input type="hidden" id="hot3p" name="hot3p" value="深圳市" />
                                            <input type="hidden" id="hot3t" name="hot3t" value="一类" />
                                            <button id="hot3c" name="hot3c" class="mui-btn mui-btn-primary city_chosen">深圳市</button>
                                            &nbsp;-->
                                            <input type="hidden" id="hot4p" name="hot4p" value="广东省" />
                                            <input type="hidden" id="hot4t" name="hot4t" value="一类" />
                                            <button id="hot4c" name="hot4c" class="mui-btn mui-btn-primary city_chosen">广州市</button>

                                        </div>
                                        <br />
                                        <div>
                                            <h5 class="mui-text-left">列表检索</h5>
                                        </div>



                                    </div>
                                </section>
                            </div>

                            <div class="mui-row mui-fullscreen city_collection">
                                <div class="mui-col-xs-3">
                                    <div id="segmentedControls" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-vertical">
                                    </div>
                                </div>
                                <div id="segmentedControlContents" class="mui-col-xs-9" style="border-left: 1px solid #c8c7cc;">
                                </div>
                            </div>


                        

        </div>
    </div>
    
    <div class="mui-btn-row post_div" id="commit_div">
        <button class="mui-btn mui-btn-primary post_button" type="button" id="commit_button" onclick="Save()">提交</button>
        <button class="mui-btn mui-btn-success hidden_button" type="button" id="hidden_button" onclick="hiddendetail()">返回主页面</button>
    </div>
    <div id="tjmx" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">住宿费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">市内交通费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">餐补费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">车船费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">飞机费</a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#tjmx"><b>取消</b></a>
            </li>
        </ul>
    </div>

    <script>

        mui.init();

        mui.ready(function () {
            tapEvent();
            getBPMParam();
            initMsg();
            upload();
            watch();
            getVersion('\\94制品在线费用报销\\市场费用报销', '市场差旅费用报销单');
         
        });
        mui('body').on('shown', '.mui-popover', function (e) {
            //console.log('shown', e.detail.id);//detail为当前popover元素
        });
        mui('body').on('hidden', '.mui-popover', function (e) {
            //console.log('hidden', e.detail.id);//detail为当前popover元素
        });

        XuntongJSBridge.call('getPersonInfo', {}, function (result) {
            if (typeof (result) == "string") {
                result = JSON.parse(result);
            }

            if (result.success == true || result.success == "true") {
                $("#fname").text(result.data.name);
                if (typeof (result.data.userName) == "undefined") {
                    $('#fno').val("");
                } else {
                    $('#fno').val(result.data.userName);
                }
            }
        });

        XuntongJSBridge.call('createPop', {
            'popTitle': '',
            'popTitleCallBackId': '1',
            'items': [
                { 'text': '刷新', 'callBackId': 'callback1' },
                { 'text': '保存草稿', 'callBackId': 'callback2' },
                {'text':'查看费用标准','callBackId':'callback3'}
            ],
            'menuList': [
                'openWithBrowser'
            ],

        }, function (result) {
            if (result.success == true || result.success == 'true') {
                var callBackId = result.data ? result.data.callBackId : '';
                if (callBackId == 'callback1') {
                    window.location.reload();
                    //location.reload();
                } else if (callBackId == 'callback2') {
                    saveAsDraft();
                } else if (callBackId == 'callback3') {
                    showdetail();
                }
            }

        });
        function isTp(flevel, fyxm, fxb, fno) {
            var xml = '<?xml version= "1.0" ?>';
            xml = xml + '    <Requests>';
            xml = xml + '      <Params>';
            xml = xml + '       <DataSource>BPM_EXPENSE</DataSource>';
            xml = xml + '          <ID>sp_zpjt_clfybx</ID>';
            xml = xml + '         <Type>2</Type>';
            xml = xml + '           <Method>GetUserDataProcedure</Method>';
            xml = xml + '          <ProcedureName>sp_zpjt_clfybx</ProcedureName>';
            xml = xml + '          <Filter>';
            xml = xml + '              <_x0040_flevel>' + flevel + '</_x0040_flevel>';
            xml = xml + '                <_x0040_empno>' + fno + '</_x0040_empno>';
            xml = xml + '               <_x0040_fyxm>' + fyxm + '</_x0040_fyxm>';
            xml = xml + '             <_x0040_fxb>' + fxb + '</_x0040_fxb>';
            xml = xml + '                <_x0040_fdqlb></_x0040_fdqlb>';
            xml = xml + '               <_x0040_fsatrdate></_x0040_fsatrdate>';
            xml = xml + '               <_x0040_fenddate></_x0040_fenddate>';
            xml = xml + '           </Filter>';
            xml = xml + '      </Params>';
            xml = xml + '   </Requests>';
            $.ajax({
                type: "POST",
                url: "/api/bpm/DataProvider",
                data: { '': xml },
                beforeSend: function (XHR) {
                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                },
                success: function (data, status) {

                    if (status == "success" || data.success == "true" || data.success == true) {


                        var provideData = JSON.parse(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));
                        //console.log(provideData);
                        var fistp = provideData.Tables[0].Rows[0].fistp;
                        var fybz = provideData.Tables[0].Rows[0].fybz;

                        //console.log($("#form_secondary").find("#fstandard").first());
                        if (fistp == "是") {

                            $("#form_secondary").find("#fspecially").first()[0].classList.value = "";
                            $("#form_secondary").find("#fstandard").first()[0].value = fybz;
                            $("#form_secondary").find("#ftp").first()[0].value = fistp;


                        } else {


                        }





                    }
                }, error: function (e) {
                    mui.toast(e);

                }, complete: function () {


                }
            });
        }

        var transport_data = [
            {
                value: 'dc',
                text: '动车'
            },
            {
                value: 'pk',
                text: '普快'
            },
            {
                value: 'qc',
                text: '汽车'
            },
            {
                value: 'lc',
                text: '轮船'
            },
            {
                value: 'zjc',
                text: '自驾车'
            }
        ];

        var ffymx_data = [

            {
                value: 'zsf',
                text: '住宿费'
            },
            {
                value: 'snjtf',
                text: '市内交通费'
            },
            {
                value: 'cbf',
                text: '餐补费'
            },
            {
                value: 'ccf',
                text: '车船费'
            },
            {
                value: 'fjf',
                text: '飞机费'
            }
        ];

        function tapEvent() {

            
           
            mui('body').on('tap', '.mui-popover-action li>a', function () {


                var a = this,
                    parent;
                //根据点击按钮，反推当前是哪个actionsheet
                for (parent = a.parentNode; parent != document.body; parent = parent.parentNode) {
                    if (parent.classList.contains('mui-popover-action')) {
                        break;
                    }
                }
                //关闭actionsheet
                mui('#' + parent.id).popover('toggle');
                var button_id = a.innerHTML;
                //console.log(button_id);

                if (button_id == '住宿费') {
                    //住宿费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';       
                    li = li + '           <input type="hidden" id="ffyxm" name="ffyxm" value="住宿费"/>';                   
                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" class="invalid_field" >威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation"></p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                    li = li + '                <p>所在城市<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                    li = li + '                <input type="text" value="至"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填" />';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder column_adj">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';

                  

                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                   
                    
                    
                } else if (button_id == '市内交通费') {
                    //市内交通
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';
                
                 
                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="市内交通费"/>';
                
                 
                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" class="invalid_field" >威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation"></p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                    li = li + '                <p>所在城市<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row">';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                    li = li + '                <input type="text" value="至"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';

                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else if (button_id == '餐补费') {
                    //餐补费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';
                  
                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="餐补费"/>';
                 
                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" class="invalid_field" >威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation"></p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                    li = li + '                <p>所在城市<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                    li = li + '                <input type="text" value="至"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';
                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else if (button_id == '车船费') {
                    //车船费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';
                  
                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="车船费"/>';
                   
                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" onclick="showcity(0,this)" class="mdcity">威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" >';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation">汽车</p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                    li = li + '                <p>目的地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';
                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else if (button_id == '飞机费') {
                    //飞机费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';
                  
                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="飞机费"/>';
                  
                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" onclick="showcity(0,this)" class="mdcity">威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation">飞机</p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                    li = li + '                <p>目的地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row ">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';
                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else {


                }
                var flevel = $("#fgrade").val();
                //var fyxm = $(this).text();
                var fyxm = a.innerHTML;
                var fxb = $("#fsex").val();
                var fno = $("#fno").val();

                
                $("#form_secondary").append(li);
               
                isTp(flevel, fyxm, fxb, fno);

                $(".mdate").mdater();

                autoSerial();

               
                if (button_id == '车船费') {
                    var element = document.getElementById('transport_div');
                    var aim = document.getElementById('transpotation');
                    var picker = new mui.PopPicker();
                    picker.setData(transport_data);
                    element.addEventListener('tap', function () {

                        picker.show(function (items) {

                            aim.textContent = items[0].text;
                        });

                    }, false);
                }


                $(".bxje").on('input', function () {
                    CalculateExpenses();
                    var bxje = $(this).val();
                    $(this).parent().parent().parent().parent().find('#ffy').children().text(bxje);
                });
                //$("#form_secondary").children().find("li").each(function () {
                //    $(this).removeClass('mui-acitve');
                //}); 
                $("#form_secondary").children().last().find("li").addClass('mui-active');

                document.getElementById('button_tjmx').scrollIntoView();
            });

            $("#freimbursedate").on('change', function () {
                $("#freimbursedate2").text($(this).val());
            });

           
        }
        //undo:重复绑定了click事件和tap事件
        function mdateTap(context) {

            $(context).mdater();

        }

        var city_auto_focus_flag = 0;
        var anchor_context = '';
        function showcity(i, context) {

            //i: 0代表出发地，1代表目的地
            //window.location.href="city-selector.html?autofocus="+i;

           
            $("#form_main").css("display", "none");
            $("#form_secondary").css("display", "none");
            $("#form_guide_project").css("display", "none");
            $(".post_div").css("display", "none");
            $("#form_guide_city_all").css("display", "block");
            $("#form_guide_city").css("display", "block");
            $(".city_collection").css("visibility", "visible");
            $("#form_guide_extra").css("display", "none");
            $("#uploaddiv").css("display", "none");
            $("#segmentedControls").css("visibility", "visible");
            $("#segmentedControlContents").css("visibility", "visible");
            $("#segmentedControlContents").css("overflow", "auto");
            city_auto_focus_flag = i;
            anchor_context = context;
            auto_focus();

            window.scrollTo(0, 0);
        }
        function hiddencity() {

            $("#form_guide_city_all").css("display", "none");
            $("#form_guide_city").css("display", "none");
            $(".city_collection").css("visibility", "hiddden");
            $("#form_main").css("display", "block");
            $("#form_secondary").css("display", "block");
            $("#form_guide_project").css("display", "block");
            $(".post_div").css("display", "block");
            $("#uploaddiv").css("display", "block");
            $("#segmentedControls").css("visibility", "hiddden");
            $("#segmentedControlContents").css("visibility", "hiddden");
            $("#segmentedControlContents").css("overflow", "hidden");
        }
        function deleteItem(context) {
            //console.log($(context).parent().parent().parent());
            var btnArray = ['否', '是'];
            mui.confirm('确认删除？', '', btnArray, function (e) {
                if (e.index == 1) {
                    $(context).parent().parent().parent().parent().parent().remove();
                    autoSerial();
                    CalculateExpenses();
                } else {
                   
                }
            })
           
        }
        function showdetail() {
            $("#form_main").css("display", "none");
            $("#form_secondary").css("display", "none");
            $("#form_guide_project").css("display", "none");
            $(".post_button").css("display", "none");
            $("#form_guide_extra").css("display", "none");
            $("#uploaddiv").css("display","none");
            $(".hidden_button").css("display", "block");
            $(".extra_content").css("display", "block");
            
        }

        function hiddendetail() {
            $("#form_main").css("display", "block");
            $("#form_secondary").css("display", "block");
            $("#form_guide_project").css("display", "block");
            $(".post_button").css("display", "block");
            $("#uploaddiv").css("display", "block");
            $("#form_guide_extra").css("display", "block");
            $(".hidden_button").css("display", "none");
            $(".extra_content").css("display", "none");

        }


        function autoSerial() {
            var i = 0;
            $("#form_secondary").find("#fentryno").each(function () {
                $(this).text((i + 1));
                i++;
            });
        }
    </script>
    <script>
       
       
        var xml = '<?xml version= "1.0" ?>';
        xml = xml + '      <Requests>';
        xml = xml + '     <Params>';
        xml = xml + '          <Method>GetFormPostData</Method>';
        xml = xml + '        <ProcessName>市场差旅费用报销单</ProcessName>';
        xml = xml + '         <ProcessVersion>1.1</ProcessVersion>';
        xml = xml + '          <Owner></Owner>';
        xml = xml + '      </Params>';
        xml = xml + '      <Params>';
        xml = xml + '         <DataSource>BPM_EXPENSE</DataSource>';
        xml = xml + '          <ID>sys_zpfy_fykm</ID>';
        xml = xml + '      <Type>1</Type>';
        xml = xml + '        <Method>GetUserDataTable</Method>';
        xml = xml + '       <TableName>sys_zpfy_fykm</TableName>';
        xml = xml + '       <OrderBy></OrderBy>';
        xml = xml + '        </Params>';
        xml = xml + '       <Params>';
        xml = xml + '          <DataSource>BPM_EXPENSE</DataSource>';
        xml = xml + '          <ID>BPM_ZPJT_SCCLVFBX_Province</ID>';
        xml = xml + '         <Type>1</Type>';
        xml = xml + '        <Method>GetUserDataTable</Method>';
        xml = xml + '      <TableName>BPM_ZPJT_SCCLVFBX_Province</TableName>';
        xml = xml + '          <OrderBy></OrderBy>';
        xml = xml + '     </Params>';
        xml = xml + '      <Params>';
        xml = xml + '        <DataSource>BPM_EXPENSE</DataSource>';
        xml = xml + '         <ID>BPM_ZPJT_SCCLVFBX_City</ID>';
        xml = xml + '            <Type>1</Type>';
        xml = xml + '          <Method>GetUserDataTable</Method>';
        xml = xml + '        <TableName>BPM_ZPJT_SCCLVFBX_City</TableName>';
        xml = xml + '          <OrderBy></OrderBy>';
        xml = xml + '       </Params>';
        xml = xml + '      <Params>';
        xml = xml + '          <DataSource>BPM_EXPENSE</DataSource>';
        xml = xml + '          <ID>BPM_ZPJT_SCCLVFBX_JTGJ</ID>';
        xml = xml + '        <Type>1</Type>';
        xml = xml + '         <Method>GetUserDataTable</Method>';
        xml = xml + '     <TableName>BPM_ZPJT_SCCLVFBX_JTGJ</TableName>';
        xml = xml + '           <OrderBy></OrderBy>';
        xml = xml + '       </Params>';

       

        xml = xml + '   </Requests>';
        $.ajax({
            type: "POST",
            url: "/api/bpm/DataProvider",
            data: { '': xml },
            beforeSend: function (XHR) {
                XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

            },
            success: function (data, status) {

                if (status == "success" || data.success == "true" || data.success == true) {
                    //console.log(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));

                    var provideData = JSON.parse(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));

                    console.log(provideData);
                    cityData = [];
                    var children;
                    for (var i = 0; i < provideData.Tables[4].Rows.length; i++) {
                        var id_province = provideData.Tables[4].Rows[i].id;
                        children = new Array();
                        for (var j = 0; j < provideData.Tables[5].Rows.length; j++) {
                            var id_city = provideData.Tables[5].Rows[j].id;
                            if (id_province == id_city) {
                                var city = ({
                                    value: provideData.Tables[5].Rows[j].cityid,
                                    text: provideData.Tables[5].Rows[j].cityname,
                                    type: provideData.Tables[5].Rows[j].citytype,
                                    id: provideData.Tables[5].Rows[j].id,
                                    province: provideData.Tables[4].Rows[i].provincename
                                });
                                children.push(city);
                            }
                        }

                        var province_city = ({
                            value: provideData.Tables[4].Rows[i].provinceid,
                            text: provideData.Tables[4].Rows[i].provincename,
                            children: children
                        });
                        cityData.push(province_city);

                    }


                }
            }, error: function (e) {

            }, complete: function () {
                $(".city_collection").css("display", "block");
                var controls = document.getElementById("segmentedControls");
                var contents = document.getElementById("segmentedControlContents");
                var html = [];
                var i = 0,
                    j = 0,
                    m = cityData.length, //左侧选项卡数量+1
                    n = 21; //每个选项卡列表数量+1
                for (; i < cityData.length; i++) {
                    html.push('<a class="mui-control-item item_province" data-index="' + (i) + '" href="#content' + (i + 1) + '">' + cityData[i].text + '</a>');
                }
                controls.innerHTML = html.join('');
                html = [];
                for (i = 0; i < cityData.length; i++) {
                    html.push('<div id="content' + i + '" class="mui-control-content"><ul class="mui-table-view">');
                    for (j = 0; j < cityData[i].children.length; j++) {

                        html.push('<li class="mui-table-view-cell city_chosen">' + cityData[i].children[j].text + '<input type="hidden" id="citytype" name="citytype" value="' + cityData[i].children[j].type + '"/><input type="hidden" id="citymid" name="citymid" value="' + cityData[i].children[j].id + '"/><input type="hidden" id="provincename" name="provincename" value="' + cityData[i].children[j].province + '"/></li>');
                    }
                    html.push('</ul></div>');
                }
                contents.innerHTML = html.join('');
                //默认选中第一个
                controls.querySelector('.mui-control-item').classList.add('mui-active');
                //contents.querySelector('.mui-control-content').classList.add('mui-active');
                (function () {
                    var controlsElem = document.getElementById("segmentedControls");
                    var contentsElem = document.getElementById("segmentedControlContents");
                    var controlListElem = controlsElem.querySelectorAll('.mui-control-item');
                    var contentListElem = contentsElem.querySelectorAll('.mui-control-content');
                    var controlWrapperElem = controlsElem.parentNode;
                    var controlWrapperHeight = controlWrapperElem.offsetHeight;
                    var controlMaxScroll = controlWrapperElem.scrollHeight - controlWrapperHeight;//左侧类别最大可滚动高度

                    var maxScroll = contentsElem.scrollHeight - contentsElem.offsetHeight;//右侧内容最大可滚动高度

                    var controlHeight = controlListElem[0].offsetHeight;//左侧类别每一项的高度
                    var controlTops = []; //存储control的scrollTop值
                    var contentTops = [0]; //存储content的scrollTop值
                    var length = contentListElem.length;
                    for (var i = 0; i < length; i++) {
                        controlTops.push(controlListElem[i].offsetTop + controlHeight);
                    }
                    for (var i = 1; i < length; i++) {
                        var offsetTop = contentListElem[i].offsetTop;
                        if (offsetTop + 100 >= maxScroll) {
                            var height = Math.max(offsetTop + 100 - maxScroll, 100);
                            var totalHeight = 0;
                            var heights = [];
                            for (var j = i; j < length; j++) {
                                var offsetHeight = contentListElem[j].offsetHeight;
                                totalHeight += offsetHeight;
                                heights.push(totalHeight);
                            }
                            for (var m = 0, len = heights.length; m < len; m++) {
                                contentTops.push(parseInt(maxScroll - (height - heights[m] / totalHeight * height)));
                            }
                            break;
                        } else {
                            contentTops.push(parseInt(offsetTop));
                        }
                    }
                    contentsElem.addEventListener('scroll', function () {
                        var scrollTop = contentsElem.scrollTop;
                        for (var i = 0; i < length; i++) {
                            var offsetTop = contentTops[i];
                            var offset = Math.abs(offsetTop - scrollTop);
                            //						console.log("i:"+i+",scrollTop:"+scrollTop+",offsetTop:"+offsetTop+",offset:"+offset);
                            if (scrollTop < offsetTop) {
                                if (scrollTop >= maxScroll) {
                                    onScroll(length - 1);
                                } else {
                                    onScroll(i - 1);
                                }
                                break;
                            } else if (offset < 20) {
                                onScroll(i);
                                break;
                            } else if (scrollTop >= maxScroll) {
                                onScroll(length - 1);
                                break;
                            }
                        }
                    });
                    var lastIndex = 0;
                    //监听content滚动
                    var onScroll = function (index) {
                        if (lastIndex !== index) {
                            lastIndex = index;
                            var lastActiveElem = controlsElem.querySelector('.mui-active');
                            lastActiveElem && (lastActiveElem.classList.remove('mui-active'));
                            var currentElem = controlsElem.querySelector('.mui-control-item:nth-child(' + (index + 1) + ')');
                            currentElem.classList.add('mui-active');
                            //简单处理左侧分类滚动，要么滚动到底，要么滚动到顶
                            var controlScrollTop = controlWrapperElem.scrollTop;
                            if (controlScrollTop + controlWrapperHeight < controlTops[index]) {
                                controlWrapperElem.scrollTop = controlMaxScroll;
                            } else if (controlScrollTop > controlTops[index] - controlHeight) {
                                controlWrapperElem.scrollTop = 0;
                            }
                        }
                    };
                    //滚动到指定content
                    var scrollTo = function (index) {
                        contentsElem.scrollTop = contentTops[index];
                    };
                    mui(controlsElem).on('tap', '.mui-control-item', function (e) {
                        scrollTo(this.getAttribute('data-index'));
                        return false;
                    });

                })();

                (function () {


                    var fdeparture_chosen = document.getElementById('fdeparture_chosen');
                    var fdestination_chosen = document.getElementById('fdestination_chosen');
                    $('.city_chosen').on('tap', function () {
                        var cityvalue = $(this).text();
                        var citytype;
                        var citymid;
                        var id = $(this)[0].id;
                        var province = '';

                        //处理城市类型和城市所属省份编码
                        if (String($(this)[0].id).indexOf("history") == -1) {
                            citytype = $(this)[0].children.citytype.value;
                            citymid = $(this)[0].children.citymid.value;
                        }  else {

                            //console.log($(this).parent().find(".historyprovince").val());
                            citytype = $(this).parent().find(".historycitytype").val();
                            citymid = $(this).parent().find(".historycitymid").val();
                        }

                        //处理城市所属省份
                        if (typeof ($(this)[0].children.provincename) != 'undefined') {
                            province = $(this)[0].children.provincename.value;
                        }

                        if (id.indexOf("history") == -1) {
                            if ($("#fdestination_chosen").is(":focus") || fdestination_chosen.hasAttribute('autofocus')) {
                                $("#fdestination_province_chosen").val(province);
                                if (isSafari()) {
                                    $("#fdeparture_province_chosen").val(province);
                                }
                               
                               
                            } else if ($("#fdeparture_chosen").is(":focus") || fdeparture_chosen.hasAttribute('autofocus')) {
                               
                                $("#fdeparture_province_chosen").val(province);
                                if (isSafari()) {
                                    $("#fdestination_province_chosen").val(province);
                                }
                               
                            } else {
                                
                            }
                        }  else if (id.indexOf("history") != -1) {
                            //undo:处理省份
                            province = $(this).parent().find(".historyprovince").val();
                            if ($("#fdestination_chosen").is(":focus") || fdestination_chosen.hasAttribute('autofocus')) {
                                $("#fdestination_province_chosen").val(province);
                                if (isSafari()) {
                                    $("#fdeparture_province_chosen").val(province);
                                }
                              
                            } else if ($("#fdeparture_chosen").is(":focus") || fdeparture_chosen.hasAttribute('autofocus')) {
                                $("#fdeparture_province_chosen").val(province);
                                if (isSafari()) {
                                    $("#fdestination_province_chosen").val(province);
                                }
                               
                            } else {
                                console.log('省份出现问题');
                            }
                        } else {
                            mui.toast("id获取错误");
                        }

                        //处理自动获取焦点或者用户点击输入框获取焦点部分
                        if (fdestination_chosen.hasAttribute('autofocus')) {
                            $("#fdestination_chosen").val(cityvalue);

                            $("#citytype_chosen").val(citytype);
                            $("#fdestination_citymid").val(citymid);
                            fdestination_chosen.removeAttribute('autofocus');
                            //变换焦点
                            fdeparture_chosen.setAttribute('autofocus', 'autofocus');
                            city_auto_focus_flag = 2;

                        } else if (fdeparture_chosen.hasAttribute('autofocus')) {
                            $("#fdeparture_chosen").val(cityvalue);
                            $("#fdeparture_citymid").val(citymid);
                            fdeparture_chosen.removeAttribute('autofocus');
                            //变换焦点
                            fdestination_chosen.setAttribute('autofocus', 'autofocus');
                            city_auto_focus_flag = 2;
                        } else if ($("#fdeparture_chosen").is(":focus")) {
                            $("#fdeparture_chosen").val(cityvalue);
                            $("#fdeparture_citymid").val(citymid);
                        } else if ($("#fdestination_chosen").is(":focus")) {
                            $("#fdestination_chosen").val(cityvalue);
                            $("#fdestination_citymid").val(citymid);
                            $("#citytype_chosen").val(citytype);
                        } else {
                            mui.toast('获取输入框焦点失败');
                        }


                    });

                    $('.aim_input').focus(function () {

                        if (fdestination_chosen.hasAttribute('autofocus') && city_auto_focus_flag == 2) {
                            fdestination_chosen.removeAttribute('autofocus');
                        } else if (fdeparture_chosen.hasAttribute('autofocus') && city_auto_focus_flag == 2) {
                            fdeparture_chosen.removeAttribute('autofocus');
                        } else {
                            city_auto_focus_flag = 2;
                        }

                    });
                    $("#cancel_city").on('tap', function () {
                        hiddencity();
                    });
                    $("#complete_city").on('tap', function () {
                        var anchor_id = anchor_context.id;
                        //alert($("#fdeparture_province_chosen").val());
                        //console.log($(anchor_context).parent().parent().find("#departure_province"));
                        $(anchor_context).parent().parent().find("#departure_province").val($("#fdeparture_province_chosen").val());
                        $(anchor_context).parent().parent().find("#destination_province").val($("#fdestination_province_chosen").val());
                        $(anchor_context).parent().parent().find("#departure_city").text($("#fdeparture_chosen").val());
                        $(anchor_context).parent().parent().find("#destination_city").text($("#fdestination_chosen").val());
                        //console.log($("#" + anchor_id).parent().parent().parent());
                        //alert($(anchor_context).parent().parent().find("#departure_province").val());
                        //alert($(anchor_context).parent().parent().find("#destination_province").val());
                        $(anchor_context).parent().parent().parent().find("#farea").val($("#citytype_chosen").val());
                        $(anchor_context).parent().parent().find("#citymid").val($("#fdestination_citymid").val());
                        $(anchor_context).parent().parent().find("#kscitymid").val($("#fdeparture_citymid").val());
                        // console.log($("#" + anchor_id).parent().parent().find("#kscitymid").val());
                        hiddencity();
                    });

                })(Zepto);
            }
        });



        function auto_focus() {
            var autofocus = city_auto_focus_flag;

            var fdestination_chosen = document.getElementById('fdestination_chosen');
            var fdeparture_chosen = document.getElementById('fdeparture_chosen');
            if (autofocus == 0) {
                fdeparture_chosen.setAttribute("autofocus", "autofocus");

            } else if (autofocus == 1) {
                fdestination_chosen.setAttribute("autofocus", "autofocus");
            }

        }

    </script>
    <script>

        function initMsg() {
            var url = window.location.href;
            if (String(url).indexOf("DraftGuid") != -1) {
                url = url.split("?")[1];
                DraftGuid = url.split("&")[0].replace("DraftGuid=", "");
                version = url.split("&")[1].replace("version=","");
                $.ajax({

                    type: 'get',
                    url: "/api/bpm/GetDraftData",
                    data: { 'draftID': DraftGuid},
                    beforeSend: function (XHR) {
                        XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));
                    },
                    success: function (data, status) {
                        if (status == "success") {
                            console.log(data);
                            var item_a = data.FormDataSet.BPM_ZPJT_SCCLVFBX_A[0];

                            $("#fname").text(item_a.fname);
                            $("#fno").val(item_a.fuser_no);
                            $("#fbm").val(item_a.fbm);
                            $("#fjob").val(item_a.fzw);
                            $("#fgrade").val(item_a.fjb);
                            $("#fsex").val(item_a.fxb);
                            $("#fcompany").val(item_a.fcompany);
                            $("#fmarket").val(item_a.ffcompany);
                            $("#fregion").val(item_a.fdq);
                            $("#foffice").val(item_a.fbsq);

                            $("#fbusinessday").val(item_a.fbcbxts);
                            $("#freimbursecannumber").val(item_a.fkbxcs);
                            $("#fbxhj").val(item_a.fhj_bx);
                            $("#fcwsh").val(item_a.fhj_cwsh);
                            $("#freimburseusenumber").val(item_a.fcftb);
                            $("#freimbursedate").val(FormatterTimeYMS(item_a.fdate));
                            $("#freimbursedate2").text(FormatterTimeYMS(item_a.fdate));
                            $("#fbsczrno").val(item_a.办事处主任工号);
                            $("#fbsczrsp").val(item_a.办事处主任审批);
                            $("#fdqjlno").val(item_a.大区经理工号);
                            $("#fdqjlsp").val(item_a.大区经理审批);
                            $("#ffgszjlno").val(item_a.分公司总经理工号);
                            $("#ffgszjlsp").val(item_a.分公司总经理审批);
                            $("#fxsfzno").val(item_a.销售副总工号);
                            $("#fxsfzsp").val(item_a.销售副总审批);
                            $("#fzjlno").val(item_a.总经理工号);
                            $("#fzjlsp").val(item_a.总经理审批);
                            $("#fsckjno").val(item_a.市场会计工号);
                            $("#fsckjsp").val(item_a.市场会计审批);
                            $("#fzgkjno").val(item_a.主管会计工号);
                            $("#fzgkjsp").val(item_a.主管会计审批);
                            $("#fzjlzlno").val(item_a.总经理助理工号);
                            $("#fzjlzlsp").val(item_a.总经理助理审批);
                            $("#freimburselast").val(FormatterTimeYMS(item_a.fscbxdate));

                            var item_b = data.FormDataSet.BPM_ZPJT_SCCLVFBX_B;
                            for (var i = 0; i < item_b.length; i++) {
                                if (item_b[i].fjtgj == null) {
                                    item_b[i].fjtgj = "";
                                }
                                if (item_b[i].fbz == null) {
                                    item_b[i].fbz = "";
                                }
                                if (item_b[i].ffyxm == '住宿费') {
                                    var li = '<form class="mui-card" id="sc-form">';
                                    li = li + '     <div class="sc-bg">';
                                    li = li + '<ul class="mui-table-view">';
                                    li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">' + item_b[i].fbxje + '</span></h5 >';
                                    li = li + '</a> ';

                                    li = li + '<div class="mui-collapse-content">';

                                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                                    li = li + '                  <p>出发地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                    li = li + '                  <span id="departure_city" class="mdcity" onclick="showcity(0,this)">' + item_b[i].cfdd_city + '</span>';
                                    li = li + '             </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                    li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                    li = li + '            </div>';
                                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                                    li = li + '                <p>目的地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                    li = li + '                <span id="destination_city" class="mdcity" onclick="showcity(1,this)">' + item_b[i].dddd_city + '</span>';
                                    li = li + '           </div>';
                                    li = li + '          </div>';
                                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                                    li = li + '                <input type="text" value="至"/>';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                 <p>天数</p>';
                                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                <p>报销金额</p>';
                                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>会计审核</p>';
                                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>财务审核</p>';
                                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">费用标准</p>';
                                    li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">地区类别</p>';
                                    li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb+'"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj"></p>';
                                    if (item_b[i].fistp == "是") {
                                        li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                    } else {
                                        li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                    }
                                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                    li = li + '              </div>';
                                    li = li + '      </div>';

                                    li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                    li = li + '               <p>备注</p>';
                                    li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                    li = li + '      </div>';

                                    li = li + '</div>';
                                    li = li + '</li>';
                                    li = li + '</ul>';

                                    li = li + '    </div>';
                                    li = li + '  </form>';


                                    $("#form_secondary").append(li);
                                } else if (item_b[i].ffyxm == '市内交通费') {
                                    var li = '<form class="mui-card" id="sc-form">';
                                    li = li + '     <div class="sc-bg">';
                                    li = li + '<ul class="mui-table-view">';
                                    li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">' + item_b[i].fbxje + '</span></h5 >';
                                    li = li + '</a> ';

                                    li = li + '<div class="mui-collapse-content">';

                                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                                    li = li + '                  <p>出发地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                    li = li + '                  <span id="departure_city" class="mdcity" onclick="showcity(0,this)">' + item_b[i].cfdd_city + '</span>';
                                    li = li + '             </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                    li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                    li = li + '            </div>';
                                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                                    li = li + '                <p>目的地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                    li = li + '                <span id="destination_city" class="mdcity" onclick="showcity(1,this)">' + item_b[i].dddd_city + '</span>';
                                    li = li + '           </div>';
                                    li = li + '          </div>';
                                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                                    li = li + '                <input type="text" value="至"/>';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                 <p>天数</p>';
                                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                <p>报销金额</p>';
                                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>会计审核</p>';
                                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>财务审核</p>';
                                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">费用标准</p>';
                                    li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">地区类别</p>';
                                    li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj"></p>';
                                    if (item_b[i].fistp == "是") {
                                        li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                    } else {
                                        li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                    }
                                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                    li = li + '              </div>';
                                    li = li + '      </div>';

                                    li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                    li = li + '               <p>备注</p>';
                                    li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                    li = li + '      </div>';

                                    li = li + '</div>';
                                    li = li + '</li>';
                                    li = li + '</ul>';

                                    li = li + '    </div>';
                                    li = li + '  </form>';


                                    $("#form_secondary").append(li);
                                } else if (item_b[i].ffyxm == '餐补费') {
                                    var li = '<form class="mui-card" id="sc-form">';
                                    li = li + '     <div class="sc-bg">';
                                    li = li + '<ul class="mui-table-view">';
                                    li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">' + item_b[i].fbxje + '</span></h5 >';
                                    li = li + '</a> ';

                                    li = li + '<div class="mui-collapse-content">';

                                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                                    li = li + '                  <p>出发地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                    li = li + '                  <span id="departure_city" class="mdcity" onclick="showcity(0,this)">' + item_b[i].cfdd_city + '</span>';
                                    li = li + '             </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                    li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                    li = li + '            </div>';
                                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                                    li = li + '                <p>目的地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                    li = li + '                <span id="destination_city" class="mdcity" onclick="showcity(1,this)">' + item_b[i].dddd_city + '</span>';
                                    li = li + '           </div>';
                                    li = li + '          </div>';
                                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                                    li = li + '                <input type="text" value="至"/>';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                 <p>天数</p>';
                                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                <p>报销金额</p>';
                                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>会计审核</p>';
                                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>财务审核</p>';
                                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">费用标准</p>';
                                    li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">地区类别</p>';
                                    li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj"></p>';
                                    if (item_b[i].fistp == "是") {
                                        li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                    } else {
                                        li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                    }
                                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                    li = li + '              </div>';
                                    li = li + '      </div>';

                                    li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                    li = li + '               <p>备注</p>';
                                    li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                    li = li + '      </div>';

                                    li = li + '</div>';
                                    li = li + '</li>';
                                    li = li + '</ul>';

                                    li = li + '    </div>';
                                    li = li + '  </form>';


                                    $("#form_secondary").append(li);
                                } else if (item_b[i].ffyxm == '车船费'){
                                    var li = '<form class="mui-card" id="sc-form">';
                                    li = li + '     <div class="sc-bg">';
                                    li = li + '<ul class="mui-table-view">';
                                    li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">' + item_b[i].fbxje + '</span></h5 >';
                                    li = li + '</a> ';

                                    li = li + '<div class="mui-collapse-content">';

                                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                                    li = li + '                  <p>出发地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                    li = li + '                  <span id="departure_city" class="mdcity" onclick="showcity(0,this)">' + item_b[i].cfdd_city + '</span>';
                                    li = li + '             </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div">';
                                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                    li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                    li = li + '            </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                                    li = li + '                <p>目的地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                    li = li + '                <span id="destination_city" class="mdcity" onclick="showcity(1,this)">' + item_b[i].dddd_city + '</span>';
                                    li = li + '           </div>';
                                    li = li + '          </div>';
                                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                 <p>天数</p>';
                                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                <p>报销金额</p>';
                                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>会计审核</p>';
                                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>财务审核</p>';
                                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">费用标准</p>';
                                    li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">地区类别</p>';
                                    li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj"></p>';
                                    if (item_b[i].fistp == "是") {
                                        li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                    } else {
                                        li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                    }
                                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                    li = li + '              </div>';
                                    li = li + '      </div>';

                                    li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                    li = li + '               <p>备注</p>';
                                    li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                    li = li + '      </div>';

                                    li = li + '</div>';
                                    li = li + '</li>';
                                    li = li + '</ul>';

                                    li = li + '    </div>';
                                    li = li + '  </form>';


                                    $("#form_secondary").append(li);
                                } else if (item_b[i].ffyxm == '飞机费') {
                                    var li = '<form class="mui-card" id="sc-form">';
                                    li = li + '     <div class="sc-bg">';
                                    li = li + '<ul class="mui-table-view">';
                                    li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">' + item_b[i].fbxje + '</span></h5 >';
                                    li = li + '</a> ';

                                    li = li + '<div class="mui-collapse-content">';

                                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                                    li = li + '                  <p>出发地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                    li = li + '                  <span id="departure_city" class="mdcity" onclick="showcity(0,this)">' + item_b[i].cfdd_city + '</span>';
                                    li = li + '             </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div">';
                                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                    li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                    li = li + '            </div>';
                                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                                    li = li + '                <p>目的地<i>*</i></p>';
                                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                    li = li + '                <span id="destination_city" class="mdcity" onclick="showcity(1,this)">' + item_b[i].dddd_city + '</span>';
                                    li = li + '           </div>';
                                    li = li + '          </div>';
                                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                    li = li + '             </div>';

                                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                 <p>天数</p>';
                                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '                <p>报销金额</p>';
                                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                    li = li + '             </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>会计审核</p>';
                                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                    li = li + '              </div>';
                                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                    li = li + '               <p>财务审核</p>';
                                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                    li = li + '             </div>';
                                    li = li + '       </div>';
                                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">费用标准</p>';
                                    li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj">地区类别</p>';
                                    li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                    li = li + '              </div>';
                                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                    li = li + '                 <p class="p_adj"></p>';
                                    if (item_b[i].fistp == "是") {
                                        li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                    } else {
                                        li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                    }
                                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                    li = li + '              </div>';
                                    li = li + '      </div>';

                                    li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                    li = li + '               <p>备注</p>';
                                    li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                    li = li + '      </div>';

                                    li = li + '</div>';
                                    li = li + '</li>';
                                    li = li + '</ul>';

                                    li = li + '    </div>';
                                    li = li + '  </form>';


                                    $("#form_secondary").append(li);
                                }


                                autoSerial();
                                $(".mdate").mdater();
                               
                                   


                                    var picker = new mui.PopPicker();
                                    picker.setData(transport_data);

                                    $("#form_secondary").find("#transport_div").each(function () {

                                        var self = this;
                                        var aim = $(self).find("#transpotation");
                                        if (aim.text() != '' && aim.text() != '飞机' && typeof (aim) != 'undefined') {
                                            $(self).off('tap');
                                            $(self).on('tap', function () {

                                                picker.show(function (items) {
                                                    aim.text(items[0].text);
                                                });
                                            });

                                        }
                                        
                                    });
                               


                                $(".bxje").on('input', function () {
                                    CalculateExpenses();
                                    var bxje = $(this).val();
                                    $(this).parent().parent().parent().parent().find('#ffy').children().text(bxje);
                                });
                                //$("#form_secondary").children().find("li").removeClass('mui-acitve');
                                $("#form_secondary").children().first().find("li").addClass('mui-active');

                            }

                            if (item_a.fj != null && item_a.fj != "") {
                                var fjtmp = (String)(item_a.fj);

                                fjArray = fjtmp.split(";");


                                //console.log("fjArray:" + fjArray);

                                //请求附件详细信息
                                $.ajax({
                                    type: 'POST',
                                    url: '/api/bpm/GetAttachmentsInfo',
                                    //dataType:'json',
                                    data: { 'fileIds': fjArray },

                                    beforeSend: function (XHR) {
                                        XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));
                                    },
                                    success: function (data, status) {
                                        if (status == "success") {

                                            console.log(data);

                                            for (var i = 0; i < data.length; i++) {

                                                var name = data[i].Name;
                                                var type = (data[i].Ext).replace(".", "");
                                                var size = String(data[i].Size);

                                                var time = String(data[i].LastUpdate).replace("T", " ");
                                                var downurl = baseDownloadUrl + data[i].FileID;
                                                var attach = attachItem(name, type, size, time, downurl);
                                                attachArray.push(attach);



                                                var li = '<div class="pic-preview smallyulan success">';
                                                li = li + ' <div class="del none" style="opacity:1;z-index:999;"onclick="delPicture(this)">x</div>';

                                                //类型判断
                                                if ((data[i].Ext).indexOf("png") != -1 || (data[i].Ext).indexOf("jpg") != -1 || (data[i].Ext).indexOf("bmp") != -1) {

                                                    //li = li + '    <div class="img-wrap smallimg" id="simg" ><a href="'+baseDownloadUrl + data[i].FileID + '"><img src="'+baseDownloadUrl + data[i].FileID + '"/></a></div>';
                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '" ><img src="'+baseDownloadUrl + data[i].FileID + '"/></div>';

                                                } else if ((data[i].Ext).indexOf("xls") != -1) {

                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/xlsx@2x.png"/></div>';

                                                } else if ((data[i].Ext).indexOf("doc") != -1) {

                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/docx@2x.png"/></div>';

                                                } else if ((data[i].Ext).indexOf("ppt") != -1) {

                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/ppt@2x.png"/></div>';

                                                } else if ((data[i].Ext).indexOf("pdf") != -1) {

                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/pdf@2x.png"/></div>';

                                                } else if ((data[i].Ext).indexOf("zip") != -1 || (data[i].Ext).indexOf("rar") != -1 || (data[i].Ext).indexOf("7z") != -1) {

                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/zip@2x.png"/></div>';

                                                } else if ((data[i].Ext).indexOf("txt") != -1) {

                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/txt@2x.png"/></div>';

                                                } else {
                                                    li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/unkown@2x.png"/></div>';
                                                }

                                                li = li + ' </div>';
                                                li = li + '</div>';
                                                $(".upload-img-list").append(li);


                                                $(".imgdiv").each(function () {

                                                    $(this).parent().find(".del.none").hide();

                                                });




                                            }

                                            $(".imgdiv").on('tap', function () {
                                                console.log($(this)[0].id);
                                                XuntongJSBridge.call('showFile', {
                                                    'fileName': attachArray[$(this)[0].id].name,
                                                    'fileExt': attachArray[$(this)[0].id].type,
                                                    'fileTime': attachArray[$(this)[0].id].time,
                                                    'fileSize': attachArray[$(this)[0].id].size,
                                                    'fileDownloadUrl': attachArray[$(this)[0].id].downurl
                                                }, function (result) {
                                                    //alert(JSON.stringify(result));
                                                });
                                            });


                                        }

                                    }, error: function (e) {
                                        console.log(e);

                                    }, complete: function () {

                                    }

                                });

                            }
                        }
                    }, error: function (e) {
                    }, complete: function () {
                    }
                });


            } else {
               
            }
           
            var fno;
            $.ajax({

                type: 'get',
                url: "/api/bpm/GetBPMParam",
                data: {},
                beforeSend: function (XHR) {
                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));
                },
                success: function (data, status) {
                    if (status == "success") {
                        //console.log(data);
                        BPMOU = data.Position[0].FullName;

                    } else {

                    }
                },
                error: function (e) {

                },

                complete: function () {

                    //$("#fno").val('00027772');

                    if ($("#fno").val() == '') {
                        if (typeof (BPMOU) != 'undefined') {
                            var BPMInfoArr = String(BPMOU).split("/");
                            fno = BPMInfoArr[BPMInfoArr.length - 1];
                        } else {
                            mui.toast('获取BPMOU失败 ');
                        }

                    } else {
                        fno = $("#fno").val();
                    }

                    
                    var xml = '<?xml version= "1.0" ?>';
                    xml = xml + '      <Requests>';
                    xml = xml + '     <Params>';
                    xml = xml + '          <Method>GetFormPostData</Method>';
                    xml = xml + '        <ProcessName>市场差旅费用报销单</ProcessName>';
                    //xml = xml + '         <ProcessVersion>1.1</ProcessVersion>';
                    xml = xml + '         <ProcessVersion>' + version + '</ProcessVersion>';
                    xml = xml + '          <Owner></Owner>';
                    xml = xml + '      </Params>';

                    xml = xml + '      <Params>';
                    xml = xml + '         <DataSource>BPM_EXPENSE</DataSource>';
                    xml = xml + '         <ID>业务员基础信息表</ID>';
                    xml = xml + '         <Type>1</Type>';
                    xml = xml + '        <Method>GetUserDataTable</Method>';
                    xml = xml + '       <TableName>业务员基础信息表</TableName>';
                    xml = xml + '       <OrderBy></OrderBy>';
                    xml = xml + '        <Filter><业务员工号>' + fno + '</业务员工号></Filter>';
                    xml = xml + '        </Params>';

                    xml = xml + '  <Params>';
                    xml = xml + '    <DataSource>BPM_EXPENSE</DataSource>';
                    xml = xml + '    <ID>sp_zpjt_wfcs</ID>';
                    xml = xml + '    <Type>2</Type>';
                    xml = xml + '    <Method>GetUserDataProcedure</Method>';
                    xml = xml + '    <ProcedureName>sp_zpjt_wfcs</ProcedureName>';
                    xml = xml + '    <Filter>';
                    xml = xml + '       <_x0040_user_no>' + fno + '</_x0040_user_no>';
                    xml = xml + '      </Filter>';
                    xml = xml + ' </Params>';


                    xml = xml + '  <Params>';
                    xml = xml + '   <DataSource>BPM_EXPENSE</DataSource>';
                    xml = xml + '   <ID>sp_zpjt_scclfdate</ID>';
                    xml = xml + '   <Type>2</Type>';
                    xml = xml + '    <Method>GetUserDataProcedure</Method>';
                    xml = xml + '    <ProcedureName>sp_zpjt_scclfdate</ProcedureName>';
                    xml = xml + '   <Filter>';
                    xml = xml + '       <_x0040_user_no>' + fno + '</_x0040_user_no>';
                    xml = xml + '    </Filter>';
                    xml = xml + ' </Params>';

                    xml = xml + '      <Params>';
                    xml = xml + '       <DataSource>BPM_EXPENSE</DataSource>';
                    //xml = xml + '          <ID>p_ZPJTSCCL_city</ID>';
                    xml = xml + '          <ID>erpcloud_医用制品差旅费报销</ID>';
                    xml = xml + '         <Type>2</Type>';
                    xml = xml + '           <Method>GetUserDataProcedure</Method>';
                    //xml = xml + '          <ProcedureName>p_ZPJTSCCL_city</ProcedureName>';
                    xml = xml + '          <ProcedureName>erpcloud_医用制品差旅费报销</ProcedureName>';
                    xml = xml + '          <Filter>';
                    xml = xml + '                <_x0040_fuser_no>' + fno + '</_x0040_fuser_no>';
                    xml = xml + '           </Filter>';
                    xml = xml + '      </Params>';

                    xml = xml + '   </Requests>';
                    $.ajax({
                        type: "POST",
                        url: "/api/bpm/DataProvider",
                        data: { '': xml },
                        beforeSend: function (XHR) {
                            XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                        },
                        success: function (data, status) {

                            if (status == "success" || data.success == "true" || data.success == true) {


                                console.log(data);
                                var provideData = JSON.parse(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));


                                console.log(provideData);
                                $("#fname").text(provideData.Tables[0].Rows[0].fname);
                                $("#fno").val(provideData.Tables[0].Rows[0].fuser_no);
                                $("#fbm").val(provideData.Tables[0].Rows[0].fbm);
                                var currentfno = $("#fno").val();
                                var userinfoArr = provideData.Tables[3].Rows;
                                if (userinfoArr.length == 0) {
                                    mui.toast('获取人员信息失败');
                                    return;
                                }

                                $("#fjob").val(userinfoArr[0].职务);
                                $("#fgrade").val(userinfoArr[0].级别);
                                $("#fsex").val(userinfoArr[0].性别);
                                $("#fcompany").val(userinfoArr[0].公司名称);
                                $("#fmarket").val(userinfoArr[0].销售分公司);
                                $("#fregion").val(userinfoArr[0].大区);
                                $("#foffice").val(userinfoArr[0].办事处);
                                $("#freimbursedate").val(getNowFormatDate(2));
                                $("#freimbursedate2").text(getNowFormatDate(2));
                                $("#fbsczrno").val(userinfoArr[0].办事处主任市场部主管商务部主管员工号);
                                $("#fbsczrsp").val(userinfoArr[0].办事处主任审批);
                                $("#fdqjlno").val(userinfoArr[0].大区经理员工号);
                                $("#fdqjlsp").val(userinfoArr[0].大区经理审批);
                                $("#ffgszjlno").val(userinfoArr[0].销售分公司总经理员工号);
                                $("#ffgszjlsp").val(userinfoArr[0].分公司总经理审批);
                                $("#fxsfzno").val(userinfoArr[0].销售副总工号);
                                $("#fxsfzsp").val(userinfoArr[0].销售副总审批);
                                $("#fzjlno").val(userinfoArr[0].总经理工号);
                                $("#fzjlsp").val(userinfoArr[0].总经理审批);
                                $("#fsckjno").val(userinfoArr[0].市场会计工号);
                                $("#fsckjsp").val(userinfoArr[0].市场会计审批);
                                $("#fzgkjno").val(userinfoArr[0].主管会计工号);
                                $("#fzgkjsp").val(userinfoArr[0].主管会计审批);
                                $("#fzjlzlno").val(userinfoArr[0].总经理助理工号);
                                $("#fzjlzlsp").val(userinfoArr[0].总经理助理审批);

                                $("#freimbursecannumber").val(provideData.Tables[4].Rows[0].fkwfcs);

                                var year = (provideData.Tables[5].Rows[0].fzdrq).year;
                                var month = (provideData.Tables[5].Rows[0].fzdrq).month;
                                var day = (provideData.Tables[5].Rows[0].fzdrq).day;
                                var dateString = FormatterTime_Y_M_S(year, month, day);
                                //console.log(dateString);
                                $("#freimburselast").val(dateString);


                                //获取历史城市信息部分
                                var historycitydata = provideData.Tables[6].Rows;
                                for (var i = 0; i < historycitydata.length; i++){
                                    $("#history" + (i + 1) + "city").text(historycitydata[i].cityname);
                                    $("#history" + (i + 1) + "province").val(historycitydata[i].dddd_pro);
                                    $("#history" + (i + 1) + "citytype").val(historycitydata[i].citytype);
                                    $("#history" + (i + 1) + "citymid").val(historycitydata[i].proId);

                                }

                            }


                        }, error: function (e) {

                        }, complete: function () {

                        }
                    });



                }

            });


        }




        function GetDateDiff(startDate, endDate) {
            var startTime = new Date(Date.parse(startDate.replace(/-/g, "/"))).getTime();
            var endTime = new Date(Date.parse(endDate.replace(/-/g, "/"))).getTime();
            var dates = Math.abs((startTime - endTime)) / (1000 * 60 * 60 * 24);
            return dates;
        }

        function CalculateExpenses() {
            var total = 0;
           
            $("#form_secondary").find("#fsubmit_expense").each(function () {
                if (isNaN($(this).val()) == true) {

                } else {
                    total += parseInt($(this).val());
                } 
               

            });
         

            $("#fbxhj").val(total);
           
        }

        var item = {
            itemid: 0,
            fentyrno: 0,
            ffyxm: '',               //费用项目
            ffykm: '2241.01.02.05',     //费用科目
            fksdate: '',                //开始日期
            fjsdate: '',                //结束日期
            cfdd_pro: '',               //出发省份
            cfdd_city: '',              //出发城市
            dddd_pro: '',               //目的省份
            dddd_city: '',              //目的城市
            citymid: '',                //目的地城市所属省份的id
            fdd: '',                    //地址（县）
            fdqlb: '',                  //地区类别
            fccts: 0,                   //出差天数
            fjtgj: '',                  //交通工具
            fccbz: '',                  //费用标准
            fbxje: '',                  //报销金额
            fkjshje: '',                //会计审核金额
            fcwshje: '',                //财务审核金额
            fbz: '',                    //备注
            kscitymid: 0,               //出发地所属省份的id
            fccbzhj: 0,
            fistp: '',                  //是否特批
            fzt: ''
        }
        function expenseItem(item) {
            console.log(item);
            if (!item.ffyxm || item.ffyxm == '') {
                mui.toast('请填写费用项目');
                return null;
            }
            if (!item.fksdate || item.fksdate == '') {
                mui.toast('请填写开始日期');
                return null;
            }
            if (!item.fjsdate || item.fjsdate == '') {
                mui.toast('请填写结束日期');
                return null;
            }
          
            //if (!item.cfdd_city || item.cfdd_city == '') {

            //    mui.toast('请选择出发地城市');
            //    return null;
            //}
            
            if (!item.dddd_city || item.dddd_city == '') {
                mui.toast('请选择目的地城市');
                return null;
            }
            if (!item.fbxje || item.fbxje == '') {
                mui.toast('请输入报销金额');
                return null;
            }
           
           
            return item;

        }

        function Save() {

            var fflag = true;
            var fuser_no = $("#fno").val();
            var fname = $("#fname").text();
            var fzw = $("#fjob").val();
            var fjb = $("#fgrade").val();
            var fxb = $("#fsex").val();
            var fdate = $("#freimbursedate").val() + " 00:00:00";
            var fscbxdate = $("#freimburselast").val() + " 00:00:00";
            var fcompany = $("#fcompany").val();
            var ffcompany = $("#fmarket").val();
            var fdq = $("#fregion").val();
            var fbsq = $("#foffice").val();
            var fbcbxts = $("#fbusinessday").val();
            var fkbxcs = $("#freimbursecannumber").val();
            var fcftb = $("#freimburseusenumber").val();
            var fhj_bx = $("#fbxhj").val();
            var fhj_bxdx = atoc(parseFloat(fhj_bx));

            if (!fbcbxts || fbcbxts == '') {
                mui.toast("请填写本次出差天数");
                return false;
            }

            if (!fcftb || fcftb == '') {
                mui.toast('请填写本单往返次数');
                return false;
            }
          

            var fbm = $("#fbm").val();
            var fbsczrno = $("#fbsczrno").val();
            var fbsczrsp = $("#fbsczrsp").val();
            var fdqjlno = $("#fdqjlno").val();
            var fdqjlsp = $("#fdqjlsp").val();
            var ffgszjlno = $("#ffgszjlno").val();
            var ffgszjlsp = $("#ffgszjlsp").val();
            var fxsfzno = $("#fxsfzno").val();
            var fxsfzsp = $("#fxsfzsp").val();
            var fzjlno = $("#fzjlno").val();
            var fzjlsp = $("#fzjlsp").val();
            var fsckjno = $("#fsckjno").val();
            var fsckjsp = $("#fsckjsp").val();
            var fzgkjno = $("#fzgkjno").val();
            var fzgkjsp = $("#fzgkjsp").val();
            var fzjlzlno = $("#fzjlzlno").val();
            var fzjlzlsp = $("#fzjlzlsp").val();

            var expenselistArr = new Array();
            $("#form_secondary").find("#sc-form").each(function () {
                var ffyxm = $(this).find("#ffyxm").val();
                var fksdate = $(this).find("#fstartdate").val() + " 00:00:00";
                var fjsdate = $(this).find("#fenddate").val() + " 00:00:00";
                var cfdd_pro = $(this).find("#departure_province").val();
                var cfdd_city = $(this).find("#departure_city").text();
                var dddd_pro = $(this).find("#destination_province").val();
                var dddd_city = $(this).find("#destination_city").text();
                var citymid = $(this).find("#citymid").val();
                var fdqlb = $(this).find("#farea").val();
                var fccts = $(this).find("#fday").val();
                var fjtgj = $(this).find("#transpotation").text();

                var fbxje = $(this).find("#fsubmit_expense").val();

                var fbz = $(this).find("#fbz").val();



                var kscitymid = $(this).find("#kscitymid").val();
                var fccbzhj = $(this).find("#fstandard").val();
                var fistp = $(this).find("#ftp").val();

                var item = {
                    itemid: 0,
                    fentyrno: 0,
                    ffyxm: ffyxm,               //费用项目
                    ffykm: '2241.01.02.05',     //费用科目
                    fksdate: fksdate,                //开始日期
                    fjsdate: fjsdate,                //结束日期
                    cfdd_pro: cfdd_pro,               //出发省份
                    cfdd_city: cfdd_city,              //出发城市
                    dddd_pro: dddd_pro,               //目的省份
                    dddd_city: dddd_city,              //目的城市
                    citymid: citymid,                //目的地城市所属省份的id
                    fdd: '',                    //地址（县）
                    fdqlb: fdqlb,                  //地区类别
                    fccts: fccts,                   //出差天数
                    fjtgj: fjtgj,                  //交通工具
                    fccbz: '',
                    fbxje: fbxje,                  //报销金额
                    fkjshje: '',                //会计审核金额
                    fcwshje: '',                //财务审核金额
                    fbz: fbz,                    //备注
                    kscitymid: kscitymid,               //出发地所属省份的id
                    fccbzhj: fccbzhj,                 //费用标准
                    fistp: fistp,                  //是否特批
                    fzt: ''
                }

                if (expenseItem(item) == null) {
                    fflag = false;
                    return false;
                }
                var expenseitem = expenseItem(item);

                expenselistArr.push(expenseitem);
            });
            if (fflag == false) {
                return false;
            }

            var btnArry = ["取消", "确定"];
            mui.confirm('即将提交，是否确定？', '提交确认提醒', btnArry, function (e) {
                if (e.index == 1) {
                    //测试数据部分
                    //fname = '王均友';
                    //fuser_no = '00027772';
                    //fbm = '医用制品公司本部';
                    //BPMOU = 'BPMOU://威高集团/医用制品集团/医用制品公司/医用制品公司本部/华北销售公司/辽宁大区/沈阳办事处/00027772';

                    var xml = '<?xml version= "1.0" ?>';
                    xml = xml + ' <XForm>';
                    xml = xml + '       <Header>';
                    xml = xml + '           <Method>Post</Method>';
                    xml = xml + '          <ProcessName>市场差旅费用报销单</ProcessName>';
                    xml = xml + '            <ProcessVersion>' + version + '</ProcessVersion>';
                    xml = xml + '            <DraftGuid>' + DraftGuid + '</DraftGuid>';
                    xml = xml + '            <OwnerMemberFullName>' + BPMOU + '</OwnerMemberFullName>';
                    xml = xml + '            <Action>提交</Action>';
                    xml = xml + '            <Comment></Comment>';
                    xml = xml + '            <InviteIndicateUsers></InviteIndicateUsers>';
                    xml = xml + '       </Header>';
                    xml = xml + '       <FormData>';
                    xml = xml + '            <BPM_ZPJT_SCCLVFBX_A>';
                    xml = xml + '                <fbillno>自动生成</fbillno>';
                    xml = xml + '                <fuser_no>' + fuser_no + '</fuser_no>';
                    xml = xml + '                <fname>' + fname + '</fname>';
                    xml = xml + '                <fzw>' + fzw + '</fzw>';
                    xml = xml + '                <fjb>' + fjb + '</fjb>';
                    xml = xml + '                <fxb>' + fxb + '</fxb>';
                    xml = xml + '                <fdate>' + fdate + '</fdate>';
                    xml = xml + '                <fscbxdate>' + fscbxdate + '</fscbxdate>';
                    xml = xml + '                <fcwdate></fcwdate>';
                    xml = xml + '               <fcompany>' + fcompany + '</fcompany>';
                    xml = xml + '                <ffcompany>' + ffcompany + '</ffcompany>';
                    xml = xml + '                <fdq>' + fdq + '</fdq>';
                    xml = xml + '              <fbsq>' + fbsq + '</fbsq>';
                    xml = xml + '                <fbcbxts>' + fbcbxts + '</fbcbxts>';
                    xml = xml + '                <fkbxcs>' + fkbxcs + '</fkbxcs>';
                    xml = xml + '                 <fcftb>' + fcftb + '</fcftb>';
                    xml = xml + '                <fwfcs></fwfcs>';
                    xml = xml + '               <fhj_bx>' + fhj_bx + '</fhj_bx>';
                    xml = xml + '               <fhj_bxdx>' + fhj_bxdx + '</fhj_bxdx>';
                    xml = xml + '              <fhj_cwsh>0</fhj_cwsh>';
                    xml = xml + '               <fhj_cwshdx>零元整</fhj_cwshdx>';
                    if (fjArray.toString() != null && fjArray.toString() != "") {

                        xml = xml + '      <fj>' + fjArray.toString().replace(",", ";") + '</fj>';
                    } else {

                        xml = xml + '      <fj></fj>';
                    }

                    xml = xml + '                 <TaskID></TaskID>';
                    xml = xml + '              <fbm>' + fbm + '</fbm>';
                    xml = xml + '                                    <fswscno></fswscno>';
                    xml = xml + '              <fbsczrno></fbsczrno>';
                    xml = xml + '              <fdqjlno></fdqjlno>';
                    xml = xml + '               <fsckjno></fsckjno>';
                    xml = xml + '               <fxszgno></fxszgno>';
                    xml = xml + '              <fisswscno></fisswscno>';
                    xml = xml + '                 <fisbsczrno></fisbsczrno>';
                    xml = xml + '                <fisdqjlno></fisdqjlno>';
                    xml = xml + '               <fissckjno></fissckjno>';
                    xml = xml + '                 <fisxszgno></fisxszgno>';
                    xml = xml + '                <办事处主任工号>' + fbsczrno + '</办事处主任工号>';
                    xml = xml + '                <办事处主任审批>' + fbsczrsp + '</办事处主任审批>';
                    xml = xml + '                <大区经理工号>' + fdqjlno + '</大区经理工号>';
                    xml = xml + '               <大区经理审批>' + fdqjlsp + '</大区经理审批>';
                    xml = xml + '                <分公司总经理工号>' + ffgszjlno + '</分公司总经理工号>';
                    xml = xml + '               <分公司总经理审批>' + ffgszjlsp + '</分公司总经理审批>';
                    xml = xml + '                <销售副总工号>' + fxsfzno + '</销售副总工号>';
                    xml = xml + '               <销售副总审批>' + fxsfzsp + '</销售副总审批>';
                    xml = xml + '                <总经理工号>' + fzjlno + '</总经理工号>';
                    xml = xml + '                <总经理审批>' + fzjlsp + '</总经理审批>';
                    xml = xml + '                <市场会计工号>' + fsckjno + '</市场会计工号>';
                    xml = xml + '               <市场会计审批>' + fsckjsp + '</市场会计审批>';
                    xml = xml + '                 <主管会计工号>' + fzgkjno + '</主管会计工号>';
                    xml = xml + '                <主管会计审批>' + fzgkjsp + '</主管会计审批>';
                    xml = xml + '               <总经理助理工号>' + fzjlno + '</总经理助理工号>';
                    xml = xml + '               <总经理助理审批>' + fzjlsp + '</总经理助理审批>';
                    xml = xml + '              </BPM_ZPJT_SCCLVFBX_A>';
                    for (var i = 0; i < expenselistArr.length; i++) {

                        xml = xml + '    <BPM_ZPJT_SCCLVFBX_B>';
                        xml = xml + '                <RelationRowGuid>' + (i + 1) + '</RelationRowGuid>';
                        xml = xml + '            <RowPrimaryKeys></RowPrimaryKeys>';
                        xml = xml + '                  <fentyrno>' + (i + 1) + '</fentyrno>';
                        xml = xml + '                <ffyxm>' + expenselistArr[i].ffyxm + '</ffyxm>';
                        xml = xml + '                <ffykm>2241.01.02.05</ffykm>';
                        xml = xml + '                <fksdate>' + expenselistArr[i].fksdate + '</fksdate>';
                        xml = xml + '                <fjsdate>' + expenselistArr[i].fjsdate + '</fjsdate>';
                        xml = xml + '               <cfdd_pro>' + expenselistArr[i].cfdd_pro + '</cfdd_pro>';
                        xml = xml + '                 <cfdd_city>' + expenselistArr[i].cfdd_city + '</cfdd_city>';
                        xml = xml + '                <kscitymid>' + expenselistArr[i].kscitymid + '</kscitymid>';
                        xml = xml + '                 <dddd_pro>' + expenselistArr[i].dddd_pro + '</dddd_pro>';
                        xml = xml + '                <dddd_city>' + expenselistArr[i].dddd_city + '</dddd_city>';
                        xml = xml + '               <citymid>' + expenselistArr[i].citymid + '</citymid>';
                        xml = xml + '                 <fdd></fdd>';
                        xml = xml + '                 <fdqlb>' + expenselistArr[i].fdqlb + '</fdqlb>';
                        xml = xml + '                <fccts>' + expenselistArr[i].fccts + '</fccts>';
                        xml = xml + '                <fjtgj>' + expenselistArr[i].fjtgj + '</fjtgj>';
                        xml = xml + '                <fccbz></fccbz>';
                        xml = xml + '                <fccbzhj>' + expenselistArr[i].fccbzhj + '</fccbzhj>';
                        xml = xml + '               <fistp>' + expenselistArr[i].fistp + '</fistp>';
                        xml = xml + '                 <fbxje>' + expenselistArr[i].fbxje + '</fbxje>';
                        xml = xml + '                <fkjshje></fkjshje>';
                        xml = xml + '                 <fcwshje></fcwshje>';
                        xml = xml + '                 <fbz>' + expenselistArr[i].fbz + '</fbz>';
                        xml = xml + '                 <fzt></fzt>';
                        xml = xml + '             </BPM_ZPJT_SCCLVFBX_B>';
                    }


                    xml = xml + '</FormData >';
                    xml = xml + '     </XForm>';

                    PostXml(xml);
                }
            });
        }

        function saveAsDraft() {

            var fuser_no = $("#fno").val();
            var fname = $("#fname").text();
            var fzw = $("#fjob").val();
            var fjb = $("#fgrade").val();
            var fxb = $("#fsex").val();
            var fdate = $("#freimbursedate").val() + " 00:00:00";
            var fscbxdate = $("#freimburselast").val() + " 00:00:00";
            var fcompany = $("#fcompany").val();
            var ffcompany = $("#fmarket").val();
            var fdq = $("#fregion").val();
            var fbsq = $("#foffice").val();
            var fbcbxts = $("#fbusinessday").val();
            var fkbxcs = $("#freimbursecannumber").val();
            var fcftb = $("#freimburseusenumber").val();
            var fhj_bx = $("#fbxhj").val();
            var fhj_bxdx = atoc(parseFloat(fhj_bx));

           

            var fbm = $("#fbm").val();
            var fbsczrno = $("#fbsczrno").val();
            var fbsczrsp = $("#fbsczrsp").val();
            var fdqjlno = $("#fdqjlno").val();
            var fdqjlsp = $("#fdqjlsp").val();
            var ffgszjlno = $("#ffgszjlno").val();
            var ffgszjlsp = $("#ffgszjlsp").val();
            var fxsfzno = $("#fxsfzno").val();
            var fxsfzsp = $("#fxsfzsp").val();
            var fzjlno = $("#fzjlno").val();
            var fzjlsp = $("#fzjlsp").val();
            var fsckjno = $("#fsckjno").val();
            var fsckjsp = $("#fsckjsp").val();
            var fzgkjno = $("#fzgkjno").val();
            var fzgkjsp = $("#fzgkjsp").val();
            var fzjlzlno = $("#fzjlzlno").val();
            var fzjlzlsp = $("#fzjlzlsp").val();

            var expenselistArr = new Array();
            $("#form_secondary").find("#sc-form").each(function () {
                var ffyxm = $(this).find("#ffyxm").val();
                var fksdate = $(this).find("#fstartdate").val() + " 00:00:00";
                var fjsdate = $(this).find("#fenddate").val() + " 00:00:00";
                var cfdd_pro = $(this).find("#departure_province").val();
                var cfdd_city = $(this).find("#departure_city").text();
                var dddd_pro = $(this).find("#destination_province").val();
                var dddd_city = $(this).find("#destination_city").text();
                var citymid = $(this).find("#citymid").val();
                var fdqlb = $(this).find("#farea").val();
                var fccts = $(this).find("#fday").val();
                var fjtgj = $(this).find("#transpotation").text();

                var fbxje = $(this).find("#fsubmit_expense").val();

                var fbz = $(this).find("#fbz").val();



                var kscitymid = $(this).find("#kscitymid").val();
                var fccbzhj = $(this).find("#fstandard").val();
                var fistp = $(this).find("#ftp").val();

                var item = {
                    itemid: 0,
                    fentyrno: 0,
                    ffyxm: ffyxm,               //费用项目
                    ffykm: '2241.01.02.05',     //费用科目
                    fksdate: fksdate,                //开始日期
                    fjsdate: fjsdate,                //结束日期
                    cfdd_pro: cfdd_pro,               //出发省份
                    cfdd_city: cfdd_city,              //出发城市
                    dddd_pro: dddd_pro,               //目的省份
                    dddd_city: dddd_city,              //目的城市
                    citymid: citymid,                //目的地城市所属省份的id
                    fdd: '',                    //地址（县）
                    fdqlb: fdqlb,                  //地区类别
                    fccts: fccts,                   //出差天数
                    fjtgj: fjtgj,                  //交通工具
                    fccbz: '',
                    fbxje: fbxje,                  //报销金额
                    fkjshje: '',                //会计审核金额
                    fcwshje: '',                //财务审核金额
                    fbz: fbz,                    //备注
                    kscitymid: kscitymid,               //出发地所属省份的id
                    fccbzhj: fccbzhj,                 //费用标准
                    fistp: fistp,                  //是否特批
                    fzt: ''
                }

               
                var expenseitem = expenseItem(item);

                expenselistArr.push(expenseitem);
            });

            var xml = '<?xml version= "1.0" ?>';
            xml = xml + ' <XForm>';
            xml = xml + '       <Header>';
            xml = xml + '           <Method>SaveAsDraft</Method>';
            xml = xml + '          <ProcessName>市场差旅费用报销单</ProcessName>';
        
            xml = xml + '            <OwnerMemberFullName>' + BPMOU + '</OwnerMemberFullName>';
        
            xml = xml + '            <Comment></Comment>';
           
            xml = xml + '       </Header>';
            xml = xml + '       <FormData>';
            xml = xml + '            <BPM_ZPJT_SCCLVFBX_A>';
            xml = xml + '                <fbillno>自动生成</fbillno>';
            xml = xml + '                <fuser_no>' + fuser_no + '</fuser_no>';
            xml = xml + '                <fname>' + fname + '</fname>';
            xml = xml + '                <fzw>' + fzw + '</fzw>';
            xml = xml + '                <fjb>' + fjb + '</fjb>';
            xml = xml + '                <fxb>' + fxb + '</fxb>';
            xml = xml + '                <fdate>' + fdate + '</fdate>';
            xml = xml + '                <fscbxdate>' + fscbxdate + '</fscbxdate>';
            xml = xml + '                <fcwdate></fcwdate>';
            xml = xml + '               <fcompany>' + fcompany + '</fcompany>';
            xml = xml + '                <ffcompany>' + ffcompany + '</ffcompany>';
            xml = xml + '                <fdq>' + fdq + '</fdq>';
            xml = xml + '              <fbsq>' + fbsq + '</fbsq>';
            xml = xml + '                <fbcbxts>' + fbcbxts + '</fbcbxts>';
            xml = xml + '                <fkbxcs>' + fkbxcs + '</fkbxcs>';
            xml = xml + '                 <fcftb>' + fcftb + '</fcftb>';
            xml = xml + '                <fwfcs></fwfcs>';
            xml = xml + '               <fhj_bx>' + fhj_bx + '</fhj_bx>';
            xml = xml + '               <fhj_bxdx>' + fhj_bxdx + '</fhj_bxdx>';
            xml = xml + '              <fhj_cwsh>0</fhj_cwsh>';
            xml = xml + '               <fhj_cwshdx>零元整</fhj_cwshdx>';
            if (fjArray.toString() != null && fjArray.toString() != "") {

                xml = xml + '      <fj>' + fjArray.toString().replace(",", ";") + '</fj>';
            } else {

                xml = xml + '      <fj></fj>';
            }

            xml = xml + '                 <TaskID></TaskID>';
            xml = xml + '              <fbm>' + fbm + '</fbm>';
            xml = xml + '                                    <fswscno></fswscno>';
            xml = xml + '              <fbsczrno></fbsczrno>';
            xml = xml + '              <fdqjlno></fdqjlno>';
            xml = xml + '               <fsckjno></fsckjno>';
            xml = xml + '               <fxszgno></fxszgno>';
            xml = xml + '              <fisswscno></fisswscno>';
            xml = xml + '                 <fisbsczrno></fisbsczrno>';
            xml = xml + '                <fisdqjlno></fisdqjlno>';
            xml = xml + '               <fissckjno></fissckjno>';
            xml = xml + '                 <fisxszgno></fisxszgno>';
            xml = xml + '                <办事处主任工号>' + fbsczrno + '</办事处主任工号>';
            xml = xml + '                <办事处主任审批>' + fbsczrsp + '</办事处主任审批>';
            xml = xml + '                <大区经理工号>' + fdqjlno + '</大区经理工号>';
            xml = xml + '               <大区经理审批>' + fdqjlsp + '</大区经理审批>';
            xml = xml + '                <分公司总经理工号>' + ffgszjlno + '</分公司总经理工号>';
            xml = xml + '               <分公司总经理审批>' + ffgszjlsp + '</分公司总经理审批>';
            xml = xml + '                <销售副总工号>' + fxsfzno + '</销售副总工号>';
            xml = xml + '               <销售副总审批>' + fxsfzsp + '</销售副总审批>';
            xml = xml + '                <总经理工号>' + fzjlno + '</总经理工号>';
            xml = xml + '                <总经理审批>' + fzjlsp + '</总经理审批>';
            xml = xml + '                <市场会计工号>' + fsckjno + '</市场会计工号>';
            xml = xml + '               <市场会计审批>' + fsckjsp + '</市场会计审批>';
            xml = xml + '                 <主管会计工号>' + fzgkjno + '</主管会计工号>';
            xml = xml + '                <主管会计审批>' + fzgkjsp + '</主管会计审批>';
            xml = xml + '               <总经理助理工号>' + fzjlno + '</总经理助理工号>';
            xml = xml + '               <总经理助理审批>' + fzjlsp + '</总经理助理审批>';
            xml = xml + '              </BPM_ZPJT_SCCLVFBX_A>';
            for (var i = 0; i < expenselistArr.length; i++) {

                xml = xml + '    <BPM_ZPJT_SCCLVFBX_B>';
                xml = xml + '                <RelationRowGuid>' + (i + 1) + '</RelationRowGuid>';
                xml = xml + '            <RowPrimaryKeys></RowPrimaryKeys>';
                xml = xml + '                  <fentyrno>' + (i + 1) + '</fentyrno>';
                xml = xml + '                <ffyxm>' + expenselistArr[i].ffyxm + '</ffyxm>';
                xml = xml + '                <ffykm>2241.01.02.05</ffykm>';
                xml = xml + '                <fksdate>' + expenselistArr[i].fksdate + '</fksdate>';
                xml = xml + '                <fjsdate>' + expenselistArr[i].fjsdate + '</fjsdate>';
                xml = xml + '               <cfdd_pro>' + expenselistArr[i].cfdd_pro + '</cfdd_pro>';
                xml = xml + '                 <cfdd_city>' + expenselistArr[i].cfdd_city + '</cfdd_city>';
                xml = xml + '                <kscitymid>' + expenselistArr[i].kscitymid + '</kscitymid>';
                xml = xml + '                 <dddd_pro>' + expenselistArr[i].dddd_pro + '</dddd_pro>';
                xml = xml + '                <dddd_city>' + expenselistArr[i].dddd_city + '</dddd_city>';
                xml = xml + '               <citymid>' + expenselistArr[i].citymid + '</citymid>';
                xml = xml + '                 <fdd></fdd>';
                xml = xml + '                 <fdqlb>' + expenselistArr[i].fdqlb + '</fdqlb>';
                xml = xml + '                <fccts>' + expenselistArr[i].fccts + '</fccts>';
                xml = xml + '                <fjtgj>' + expenselistArr[i].fjtgj + '</fjtgj>';
                xml = xml + '                <fccbz></fccbz>';
                xml = xml + '                <fccbzhj>' + expenselistArr[i].fccbzhj + '</fccbzhj>';
                xml = xml + '               <fistp>' + expenselistArr[i].fistp + '</fistp>';
                xml = xml + '                 <fbxje>' + expenselistArr[i].fbxje + '</fbxje>';
                xml = xml + '                <fkjshje></fkjshje>';
                xml = xml + '                 <fcwshje></fcwshje>';
                xml = xml + '                 <fbz>' + expenselistArr[i].fbz + '</fbz>';
                xml = xml + '                 <fzt></fzt>';
                xml = xml + '             </BPM_ZPJT_SCCLVFBX_B>';
            }


            xml = xml + '</FormData >';
            xml = xml + '     </XForm>';

            $.ajax({
                type: "POST",
                url: "/api/bpm/PostProcess",
                data: { '': xml },
                beforeSend: function (XHR) {
                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                },
                success: function (data, status) {

                    if (status == "success") {
                        console.log(data);

                        mui.toast('保存草稿成功');


                    } else {
                        mui.toast("保存失败!请稍后重试");
                    }
                },
                error: function (e) {
                    alert(e.statusText + " .... " + e.responseText);

                },
                complete: function () {

                }

            });
        }

    </script>
    <!--<script>
        //侧滑容器父节点
        var offCanvasWrapper = mui('#offCanvasWrapper');
        //主界面容器
        var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
        //菜单容器
        var offCanvasSide = document.getElementById("offCanvasSide");

        //移动效果是否为整体移动
        var moveTogether = false;
        //侧滑容器的class列表，增加.mui-slide-in即可实现菜单移动、主界面不动的效果；
        var classList = offCanvasWrapper[0].classList;
        //变换侧滑动画移动效果；
        (function () {

            offCanvasSide.classList.remove('mui-transitioning');
            offCanvasSide.setAttribute('style', '');
            classList.remove('mui-slide-in');
            classList.remove('mui-scalable');
            moveTogether = true;
            //整体滑动时，侧滑菜单在inner-wrap内
            offCanvasInner.insertBefore(offCanvasSide, offCanvasInner.firstElementChild);
            offCanvasWrapper.offCanvas().refresh();

        })();
        //菜单界面，‘关闭侧滑菜单’按钮的点击事件
        document.getElementById('offCanvasHide').addEventListener('tap', function () {
            offCanvasWrapper.offCanvas('close');
        });
        //主界面和侧滑菜单界面均支持区域滚动；
        mui('#offCanvasSideScroll').scroll();
        mui('#offCanvasContentScroll').scroll();
       
        mui('body').on('tap', 'a', function () {

            document.location.href = this.href;
        });
        mui('body').on('tap', 'span', function () {
            this.click();
        });
        mui('body').on('tap', 'a', function () {
            this.click();
            //document.location.href = this.href;
        });
        mui('body').on('tap', 'div', function () {
            this.click();
        });
        mui('body').on('scroll', 'div', function () {
          
        });
    </script>-->
</body>



</html>