<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta charset="utf-8" />
    <title>差旅费报销</title>
    <script type="text/javascript" src="../../../../Scripts/baidu-statistics.js"></script>
    <script type="text/javascript" src="../../../../Scripts/zepto.min.js"></script>
    
    <script type="text/javascript" src="../../../../Scripts/mui.js"></script>
    <script type="text/javascript" src="../../../../Scripts/mui.poppicker.js"></script>
    <script type="text/javascript" src="../../../../Scripts/mui.picker.min.js"></script>
    <script type="text/javascript" src="http://wb.weigaoholding.com:8090/res/js/qingjs.js"></script>
    <script type="text/javascript" src="../../../../Scripts/util.js"></script>
    <script type="text/javascript" src="../../../../Scripts/upload.js"></script>
    <script type="text/javascript" src="../../../../Scripts/upload.detail.js"></script>
    <script type="text/javascript" src="../../../../Scripts/calendar-selector.js"></script>
    <script type="text/javascript" src="../../../../Scripts/city.data.js"></script>
    <script type="text/javascript" src="../../../../Scripts/ApprovalUtils.js"></script>
    <link rel="stylesheet" href="../../../../Content/mui.min.css" />
    <link rel="stylesheet" href="../../../../Content/mui.picker.min.css" />
    <link rel="stylesheet" href="../../../../Content/mui.poppicker.css" />
    <link rel="stylesheet" href="../../../../Content/upload.css" />
    <link rel="stylesheet" href="../../Content/ApprovalUtils.css" />
    <link rel="stylesheet" href="../../../../Content/maintanse.css" />
    <link rel="stylesheet" href="../../../../Content/city-selector.css" />
    <link rel="stylesheet" href="../../../../Content/calendar-selector.css" />
    <link rel="stylesheet" href="../../Content/DoneOrMyApproval.css"/>
</head>
<body>
    <div class="mui-card extra_content" id="#expense_detail">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell mui-collapse mui-active">
                <a href="#" class="mui-navigate-right">差旅费和区间交通费用标准</a>
                <div class="mui-collapse-content">
                    <form>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-2 illustration_context">人员</div>
                            <div class="mui-col-xs-2 illustration_context">飞机</div>
                            <div class="mui-col-xs-2 illustration_context">高铁(动车)</div>
                            <div class="mui-col-xs-2 illustration_context">火车</div>
                            <div class="mui-col-xs-2 illustration_context">轮船</div>
                            <div class="mui-col-xs-2 illustration_context">长途汽车</div>
                        </div>
                        <div class="mui-row ">
                            <div class="mui-col-xs-2 illustration_context">一级</div>
                            <div class="mui-col-xs-2 illustration_context">经济舱</div>
                            <div class="mui-col-xs-2 illustration_context">二等座</div>
                            <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                            <div class="mui-col-xs-2 illustration_context">三等舱</div>
                            <div class="mui-col-xs-2 illustration_context">实报</div>
                        </div>
                        <div class="mui-row ">
                            <div class="mui-col-xs-2 illustration_context">二级</div>
                            <div class="mui-col-xs-2 illustration_context"></div>
                            <div class="mui-col-xs-2 illustration_context">二等座</div>
                            <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                            <div class="mui-col-xs-2 illustration_context">四等舱</div>
                            <div class="mui-col-xs-2 illustration_context">实报</div>
                        </div>
                        <div class="mui-row ">
                            <div class="mui-col-xs-2 illustration_context">三级</div>
                            <div class="mui-col-xs-2 illustration_context"></div>
                            <div class="mui-col-xs-2 illustration_context">二等座</div>
                            <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                            <div class="mui-col-xs-2 illustration_context">四等舱</div>
                            <div class="mui-col-xs-2 illustration_context">实报</div>
                        </div>
                        <div class="mui-row ">
                            <div class="mui-col-xs-2 illustration_context">四级</div>
                            <div class="mui-col-xs-2 illustration_context"></div>
                            <div class="mui-col-xs-2 illustration_context">二等座</div>
                            <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                            <div class="mui-col-xs-2 illustration_context">四等舱</div>
                            <div class="mui-col-xs-2 illustration_context">实报</div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-2 illustration_context">五级</div>
                            <div class="mui-col-xs-2 illustration_context"></div>
                            <div class="mui-col-xs-2 illustration_context">二等座</div>
                            <div class="mui-col-xs-2 illustration_context">硬卧/硬座</div>
                            <div class="mui-col-xs-2 illustration_context">四等舱</div>
                            <div class="mui-col-xs-2 illustration_context">实报</div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                1.常驻地为：新疆、云南、广西、贵州、广东、海南、福建、甘肃、四川、重庆、青海地区的人员可乘坐飞机；2.其他人员从公司出发到以上地区出差可按照上述地区人员标准乘坐飞机。3.其他常驻地的人员，乘坐飞机则按照火车票、轮船票的票价予以报销差旅费；
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li class="mui-table-view-cell mui-collapse">
                <a href="#" class="mui-navigate-right">住宿费标准</a>
                <div class="mui-collapse-content">
                    <form>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                人员/标准
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                一类城市
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                二类城市
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                一级
                            </div>
                            <div class="mui-col-xs-8 illustration_context">
                                280元/天
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                二级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                180元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                160元/天
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                三级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                140元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                120元/天
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                四级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                120元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                100元/天
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                五级
                            </div>
                            <div class="mui-col-xs-8 illustration_context">
                                男50元/天，女80元/天
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                审批同意指定的全国连锁酒店住宿，标准不得超过150元/天；同一地区有两名以上常住人员，必须按照公司《201406号市场房屋租赁规定》租房，否则不予报销住宿费。
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                外围市场租房标准
                            </div>
                            <div class="mui-col-xs-8 illustration_context">
                                8000元/年
                            </div>
                        </div>
                        <div class="mui-row ">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                具体租房标准见《201406号市场房屋租赁规定》
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li class="mui-table-view-cell mui-collapse">
                <a href="#" class="mui-navigate-right">市内交通费</a>
                <div class="mui-collapse-content">
                    <form>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                人员/标准
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                一类城市
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                二类城市
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                一级
                            </div>
                            <div class="mui-col-xs-8 illustration_context">
                                60元/天
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                二级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                60元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                50元/天
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-4 illustration_context">
                                三级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                50元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                40元/天
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                四级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                40元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                30元/天
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                配备办公用车的销售干部由公司由公司统一采购油卡，发往各市场，销售干部不再报销市内交通费；
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                五级
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                15元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                10元/天
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                护理团队业务员上市场一年以后取消市内交通补助，其他人员继续享受以上标准
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li class="mui-table-view-cell mui-collapse">
                <a href="#" class="mui-navigate-right">餐饮费标准</a>
                <div class="mui-collapse-content">
                    <form>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                类型/标准
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                一类地区
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                二类地区
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                不固定出差地的人员
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                30元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                25元/天
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                含5元的水电补助及物业费用
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-4 illustration_context">
                                办事处统一食宿的人员
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                700元/人/月
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                600元/人/月
                            </div>
                        </div>
                        <div class="mui-row bottomborder">
                            <div class="mui-col-xs-12 illustration_context_extra">
                                含5元的水电补助及物业费用
                            </div>
                        </div>
                        <div class="mui-row ">
                            <div class="mui-col-xs-4 illustration_context">
                                报销住宿费及租房的人员
                            </div>
                            <div class="mui-col-xs-4 illustration_context">
                                20元/天
                            </div>
                            <div class="mui-col-xs-4 illustration_context">

                            </div>
                        </div>
                    </form>
                </div>
            </li>
        </ul>
    </div>
    <!--</div>
            </div>
        </div>
    </aside>-->
    <!--<div class="mui-inner-wrap">
        <div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
            <div class="mui-scroll">-->
    <!--<div id="form_guide_extra" class="mui-btn-row">

        <button id="seekexd" name="seekexp" class="mui-btn mui-btn-yellow show_button" onclick="showdetail()">查看费用标准参考</button>
    </div>-->
    <div id="wrapper">
        <div id="form_main">
            <div id="personal_info" class="mui-card">
                <ul class="mui-table-view">
                    <li class="mui-table-view-cell mui-collapse">
                        <a class="mui-navigate-right mui-row" href="#"><h5 class="mui-col-xs-7">报销人</h5><h5 class="mui-col-xs-5" id="fname"></h5></a>
                        <div class="mui-collapse-content">
                            <form class="mui-input-group">
                                <div class="mui-input-row">
                                    <label for="fjob">职务</label>
                                    <input type="text" id="fjob" name="fjob" readonly="readonly" value="" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="fgrade">级别</label>
                                    <input type="text" id="fgrade" name="fgrade" readonly="readonly" value="" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="fsex">性别</label>
                                    <input type="text" id="fsex" name="fsex" readonly="readonly" value="" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="fcompany">公司名称</label>
                                    <input type="text" id="fcompany" name="fcompany" readonly="readonly" value="" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="fmarket">销售分公司</label>
                                    <input type="text" id="fmarket" name="fmarket" readonly="readonly" value="" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="fregion">大区</label>
                                    <input type="text" id="fregion" name="fregion" readonly="readonly" value="" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="foffice">办事处</label>
                                    <input type="text" id="foffice" name="foffice" readonly="readonly" value="" />
                                </div>
                            </form>
                        </div>
                    </li>
                    <li class="mui-table-view-cell mui-collapse">
                        <a class="mui-navigate-right mui-row" href="#"><h5 class="mui-col-xs-7">报销日期</h5><h5 class="mui-col-xs-5" id="freimbursedate2"></h5></a>
                        <div class="mui-collapse-content">
                            <form class="mui-input-group">
                                <div class="mui-input-row">
                                    <label for="freimbursedate">本次日期</label>
                                    <input type="date" id="freimbursedate" name="freimbursedate" value="2017-06-13" readonly="readonly" />
                                </div>
                                <div class="mui-input-row">
                                    <label for="freimburselast">上次日期</label>
                                    <input type="date" id="freimburselast" name="freimburselast" value="2017-05-04" readonly="readonly" />
                                </div>
                                <div class="mui-input-row" id="cwdate">
                                    <label for="freimbursepend">财务审核日期</label>
                                    <input type="date" id="freimbursepend" name="freimbursepend" value="2017-06-19" readonly="readonly" />
                                </div>
                            </form>
                        </div>
                    </li>

                    <li class="mui-input-row">
                        <label for="fbusinessday">出差天数</label>
                        <input type="number" id="fbusinessday" name="fbusinessday" value="0" readonly="readonly" />
                    </li>

                    <li class="mui-input-row">
                        <label for="freimbursecannumber">可报销次数</label>
                        <input type="number" id="freimbursecannumber" name="freimbursecannumber" value="0" readonly="readonly" />
                    </li>

                    <li class="mui-input-row">
                        <label for="freimburseusenumber">本单次数</label>
                        <input type="number" id="freimburseusenumber" name="freimburseusenumber" value="0" readonly="readonly" />
                    </li>
                    <li class="mui-input-row">
                        <label for="fbxhj">报销合计</label>
                        <input type="text" id="fbxhj" name="fbxhj" value="0" readonly="readonly" />
                    </li>
                    <li class="mui-input-row">
                        <label for="fcwsh">财务审核</label>
                        <input type="text" id="fcwsh" name="fcwsh" value="0" readonly="readonly" />
                    </li>
                </ul>
            </div>

        </div>

        <input type="hidden" id="fbm" name="fbm" value="" />
        <input type="hidden" id="fno" name="fno" value="" />

        <input type="hidden" id="fbsczrno" name="fbsczrno" value="" />
        <input type="hidden" id="fbsczrsp" name="fbsczrsp" value="" />
        <input type="hidden" id="fdqjlno" name="fdqjlno" value="" />
        <input type="hidden" id="fdqjlsp" name="fdqjlsp" value="" />
        <input type="hidden" id="ffgszjlno" name="ffgszjlno" value="" />
        <input type="hidden" id="ffgszjlsp" name="ffgszjlsp" value="" />
        <input type="hidden" id="fxsfzno" name="fxsfzno" value="" />
        <input type="hidden" id="fxsfzsp" name="fxsfzsp" value="" />
        <input type="hidden" id="fzjlno" name="fzjlno" value="" />
        <input type="hidden" id="fzjlsp" name="fzjlsp" value="" />
        <input type="hidden" id="fsckjno" name="fsckjno" value="" />
        <input type="hidden" id="fsckjsp" name="fsckjsp" value="" />
        <input type="hidden" id="fzgkjno" name="fzgkjno" value="" />
        <input type="hidden" id="fzgkjsp" name="fzgkjsp" value="" />
        <input type="hidden" id="fzjlzlno" name="fzjlzlno" value="" />
        <input type="hidden" id="fzjlzlsp" name="fzjlzlsp" value="" />

        <div class="mui-input-row mui-card" style="height:7rem;overflow:scroll;" id="uploaddiv">
            <div class="border border-t upload-img" style="top:0rem;">
                <!--上传图片-->
                <div class="clearfix upload-btn" id="children-bg">
                    <label class="label">附件</label>
                    <span class="tips" id="imageCount"><!--已添加0张--></span>
                    <!--上传图片按钮  -->
                    <span class="upload-addbtn" style="display:none;">
                        <input type="file" accept="image/jpeg,image/jpg,image/png,image/jp2,image/bmp" id="file" style="opacity:0;">
                    </span>

                </div>
                <div class="upload-img-list"></div>
            </div>
        </div>
        

        
        <div id="form_secondary">


        </div>
        <div id="form_guide_project" style="display:none;">
            <a id="button_tjmx" name="button_tjmx" class="mui-btn mui-btn-primary mui-btn-block mui-btn-outlined" href="#tjmx">
                添加费用明细
                <span class="mui-icon mui-icon-plusempty"></span>
            </a>
        </div>
        <div class="mui-table-view" style="margin-bottom:3.25rem;">
            <div class="mui-table-view-cell  mui-collapse mui-active">
                <a class="mui-navigate-right" href="#" style="background-color:#00a0ea;color:white;font-size:0.75rem !important;height:2rem;">

                    历史签核意见
                </a>
                <div class="mui-collapse-content">

                    <!--流程列表-->
                    <div class="list">
                        <ul id="signff"></ul>
                    </div>


                </div>
            </div>
        </div>
        <div id="form_guide_city_all">
            <div id="form_guide_city">
                <section id="city_header">
                    <div class="mui-row">
                        <button class="mui-btn mui-btn-yellow mui-pull-left mui-col-xs-2" id="cancel_city">取消</button>
                        <h4 class="mui-text-center city_h mui-col-xs-8">城市选择</h4>
                        <button class="mui-btn mui-btn-blue mui-pull-right mui-col-xs-2" id="complete_city">完成</button>
                    </div>

                    <div id="city_show" class="city_show">
                        <form class="mui-row mui-card">
                            <div class="mui-col-xs-5 aim_div">
                                <label for="fdeparture_chosen">出发地</label>
                                <input type="hidden" id="fdeparture_citymid" name="fdeparture_citymid" />
                                <input type="hidden" id="fdeparture_province_chosen" name="fdeparture_province_chosen">
                                <input type="text" id="fdeparture_chosen" name="fdeparture_chosen" placeholder="请选择出发地" class="aim_input" />
                            </div>
                            <div class="mui-col-xs-2 mui-text-center">
                                <span class="mui-icon mui-icon-arrowthinright"></span>
                                <input type="hidden" id="citytype_chosen" name="citytype_chosen" />
                            </div>
                            <div class="mui-col-xs-5 aim_div">
                                <label for="fdestination_chosen">目的地</label>
                                <input type="hidden" id="fdestination_citymid" name="fdestination_citymid" />
                                <input type="hidden" id="fdestination_province_chosen" name="fdestination_province_chosen" />
                                <input type="text" id="fdestination_chosen" name="fdestination_chosen" placeholder="请选择目的地" class="aim_input" />
                            </div>
                        </form>

                    </div>
                    <div id="city_main" class="city_main">
                        <div>
                            <h5 class="mui-text-left">历史城市</h5>
                            <input type="hidden" id="history1p" name="history1p" value="山东省" />
                            <input type="hidden" id="history1t" name="history1t" value="二类" />
                            <button id="history1c" name="history1c" class="mui-btn mui-btn-primary city_chosen">威海市</button>
                            &nbsp;
                            <input type="hidden" id="history2p" name="history2p" value="山东省" />
                            <input type="hidden" id="history2t" name="history2t" value="二类" />
                            <button id="history2c" name="history2c" class="mui-btn mui-btn-primary city_chosen">青岛市</button>
                        </div>
                        <br />
                        <div>
                            <h5 class="mui-text-left">热门城市</h5>
                            <input type="hidden" id="hot1p" name="hot1p" value="上海市" />
                            <input type="hidden" id="hot1t" name="hot1t" value="一类" />
                            <button id="hot1c" name="hot1c" class="mui-btn mui-btn-primary city_chosen">上海市</button>
                            &nbsp;
                            <input type="hidden" id="hot2p" name="hot2p" value="北京市" />
                            <input type="hidden" id="hot2t" name="hot2t" value="一类" />
                            <button id="hot2c" name="hot2c" class="mui-btn mui-btn-primary city_chosen">北京市</button>
                            &nbsp;
                            <input type="hidden" id="hot3p" name="hot3p" value="深圳市" />
                            <input type="hidden" id="hot3t" name="hot3t" value="一类" />
                            <button id="hot3c" name="hot3c" class="mui-btn mui-btn-primary city_chosen">深圳市</button>
                            &nbsp;
                            <input type="hidden" id="hot4p" name="hot4p" value="广东省" />
                            <input type="hidden" id="hot4t" name="hot4t" value="一类" />
                            <button id="hot4c" name="hot4c" class="mui-btn mui-btn-primary city_chosen">广州市</button>

                        </div>
                        <br />
                        <div>
                            <h5 class="mui-text-left">列表检索</h5>
                        </div>



                    </div>
                </section>
            </div>

            <div class="mui-row mui-fullscreen city_collection">
                <div class="mui-col-xs-3">
                    <div id="segmentedControls" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-vertical">
                    </div>
                </div>
                <div id="segmentedControlContents" class="mui-col-xs-9" style="border-left: 1px solid #c8c7cc;">
                </div>
            </div>


            <!--</div>

            </div>
        </div>-->







        </div>
        <div class="mui-btn-row"  id="createD">
            <button class="mui-btn mui-btn-primary" type="button"  id="commitbt" onclick="Save()">提交</button>
        </div>
        <div class="mui-btn-row"  id="approvalD">
            &nbsp;&nbsp;
            <button class="mui-btn mui-btn-primary" type="button" style="width:25%;" id="agreebt" onclick="showConfirm()">同意</button>&nbsp;&nbsp;&nbsp;
            <button class="mui-btn mui-btn-danger" type="button" style="width:25%;" id="refusebt" onclick="reject()">拒绝</button>&nbsp;&nbsp;&nbsp;
            <button class="mui-btn mui-btn-yellow" type="button" style="width:25%;" id="refusebt" onclick="Refilled()">退回重填</button>
        </div>
        <div class="mui-btn-row"  id="readD">
            <button class="mui-btn mui-btn-primary" type="button"  id="readbt" onclick="hasRead()">已阅</button>
        </div>
        <div class="mui-btn-row post_div" id="commit_div">
            <button class="mui-btn mui-btn-success hidden_button" type="button" id="hidden_button" onclick="hiddendetail()">返回主页面</button>
        </div>
    </div>
    
    <input value="" id="stepId" name="stepId" type="hidden" />
    <input type="hidden" id="flowPerId" name="flowPerId" value="" />
    <input type="hidden" id="processName" name="processName" value="" />
    <input type="hidden" id="noticeUser" name="noticeUser" value="" />
    <input type="hidden" id="noticeOpenId" name="noticeOpenId" value="" />
    <input type="hidden" id="taskId" name="taskId" value="" />
    <input type="hidden" id="myPhone" name="myPhone" value="" />
    <input type="hidden" id="consignUser" name="consignUser" value="" />
    <input type="hidden" id="consignOpenId" name="consignOpenId" value="" />
    <input type="hidden" id="fbillno" name="fbillno" value="" />
    <input type="hidden" id="nodename" name="nodename" value=""/>
    <div id="signd" style="display:none;background-color:white;">
        <div class="mui-input-row"  id="ssd">
            <label>签核意见</label>
            <textarea rows="8" id="signSuggest" placeholder="请输入签核意见"></textarea>

        </div>
        <div class="mui-btn-row mui-text-center" style="margin-top:1rem;">
            <button class="mui-btn mui-btn-primary" type="button" onclick="AgreeOrConSign()">确定</button>&nbsp;&nbsp;
            <button class="mui-btn mui-btn-danger" type="button" onclick="cancelConfirm()">取消</button>
        </div>
    </div>
    <div id="tjmx" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#">住宿费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">市内交通费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">餐补费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">车船费</a>
            </li>
            <li class="mui-table-view-cell">
                <a href="#">飞机费</a>
            </li>
        </ul>
        <ul class="mui-table-view">
            <li class="mui-table-view-cell">
                <a href="#tjmx"><b>取消</b></a>
            </li>
        </ul>
    </div>

    <script>

        mui.init();

        mui.ready(function () {
            getBPMParam();

            getTaskMsg();
            upload();
            watch();
        });
    
        XuntongJSBridge.call('setWebViewTitle', { 'title': '审批详情' });

        XuntongJSBridge.call('createPop', {
            'popTitle': '',
            'popTitleCallBackId': '1',
            'items': [
                { 'text': '刷新', 'callBackId': 'callback1' },
                { 'text': '知会', 'callBackId': 'callback2' },
               { 'text': '查看费用标准', 'callBackId': 'callback3' }

            ],
            'menuList': [
                'openWithBrowser'
            ],

        }, function (result) {
            if (result.success == true || result.success == 'true') {
                var callBackId = result.data ? result.data.callBackId : '';
                if (callBackId == 'callback1') {
                    window.location.reload();
                } else if (callBackId == 'callback2') {
                    XuntongJSBridge.call('selectPersons', { 'isMulti': 'true', 'pType': '1' }, function (result) {

                        if (typeof (result) == "string") {
                            result = JSON.parse(result);
                        }


                        noticeOpenIdArr = new Array();
                        if (result.success == true || result.success == "true") {

                            for (var i = 0; i < result.data.persons.length; i++) {

                                noticeOpenIdArr.push(result.data.persons[i].openId);

                            }
                            $("#noticeOpenId").val(noticeOpenIdArr);
                            //知会

                            $.ajax({
                                type: "POST",
                                url: "/api/bpm/PostAccount",
                                data: { "ids": noticeOpenIdArr },
                                beforeSend: function (XHR) {
                                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                                }, success: function (data, status) {

                                    if (status == "success") {
                                        var accounts = new Array();
                                        var accName = new Array();
                                        for (var i = 0; i < data.data.length; i++) {
                                            accounts.push((String)(data.data[i].phone));
                                            accName.push(data.data[i].name);
                                        }
                                        //alert(JSON.stringify({ 'taskID': taskId, 'comments': '', 'accounts': accounts }));

                                        var btnArry = ["取消", "确定"];
                                        mui.confirm('将知会下列人员:' + accName, '知会通知', btnArry, function (e) {
                                            if (e.index == 1) {
                                                $.ajax({
                                                    type: "POST",
                                                    url: "/api/bpm/PostInform",
                                                    data: { 'taskID': taskId, 'comments': '', 'accounts': accounts },
                                                    dataType: "json",
                                                    beforeSend: function (XHR) {

                                                        XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                                                    },
                                                    success: function (data, status) {

                                                        if (status == "success") {
                                                            mui.toast("知会成功");
                                                        }
                                                    }, error: function (e) {
                                                        //console.log(e);  

                                                    },
                                                    complete: function () { }


                                                });
                                            } else {

                                            }
                                        });


                                    }
                                }, error: function (e) {

                                }, complete: function () { }


                            });


                        }



                    });
                } else if (callBackId == 'callback3') {
                    //getRecedableToSteps();
                    showdetail();
                }
            }
        });

        XuntongJSBridge.call('getPersonInfo', {}, function (result) {
            if (typeof (result) == "string") {
                result = JSON.parse(result);
            }

            if (result.success == true || result.success == "true") {
                if (typeof (result.data.userName) == "undefined") {
                    $('#myPhone').val("");
                } else {
                    $('#myPhone').val(result.data.userName);
                }
            }

        });

        function getTaskMsg() {

            var url = window.location.href;
            if (url != null && url.indexOf("tid") != -1 && url.indexOf("pid") != -1) {


                taskId = url.substring(url.indexOf("=") + 1, url.indexOf("&"));
                if (url.split("pid=")[1].indexOf("ticket") != -1) {
                    stepId = url.split("pid=")[1];
                    stepId = stepId.split("&ticket")[0];
                    var ticket = url.split("=")[3];
                    localStorage.setItem('ticket', ticket);
                } else {
                    stepId = url.split("pid=")[1];
                }


            } else {
                mui.toast("网络异常,请稍后重试");
                history.go(-1);

            }

            itemidArr = new Array();
            $.ajax({
                type: "get",
                url: "/api/bpm/GetTaskData",
                data: { 'taskId': taskId },

                beforeSend: function (XHR) {
                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));
                },
                success: function (data, status) {
                    //console.log(data);
                    if (status == "success") {

                        console.log(data);
                        var item_a = data.FormDataSet.BPM_ZPJT_SCCLVFBX_A[0];
                        $("#fname").text(item_a.fname);
                        $("#fno").val(item_a.fuser_no);
                        $("#fbm").val(item_a.fbm);

                        $("#fjob").val(item_a.fzw);
                        $("#fgrade").val(item_a.fjb);
                        $("#fsex").val(item_a.fxb);
                        $("#fcompany").val(item_a.fcompany);
                        $("#fmarket").val(item_a.ffcompany);
                        $("#fregion").val(item_a.fdq);
                        $("#foffice").val(item_a.fbsq);
                        $("#fbusinessday").val(item_a.fbcbxts);
                        $("#freimbursecannumber").val(item_a.fkbxcs);
                        $("#fbxhj").val(item_a.fhj_bx);
                        $("#fcwsh").val(item_a.fhj_cwsh);
                        $("#freimburseusenumber").val(item_a.fcftb);
                        $("#freimbursedate").val(FormatterTimeYMS(item_a.fdate));
                        $("#freimbursedate2").text(FormatterTimeYMS(item_a.fdate));
                        $("#fbsczrno").val(item_a.办事处主任工号);
                        $("#fbsczrsp").val(item_a.办事处主任审批);
                        $("#fdqjlno").val(item_a.大区经理工号);
                        $("#fdqjlsp").val(item_a.大区经理审批);
                        $("#ffgszjlno").val(item_a.分公司总经理工号);
                        $("#ffgszjlsp").val(item_a.分公司总经理审批);
                        $("#fxsfzno").val(item_a.销售副总工号);
                        $("#fxsfzsp").val(item_a.销售副总审批);
                        $("#fzjlno").val(item_a.总经理工号);
                        $("#fzjlsp").val(item_a.总经理审批);
                        $("#fsckjno").val(item_a.市场会计工号);
                        $("#fsckjsp").val(item_a.市场会计审批);
                        $("#fzgkjno").val(item_a.主管会计工号);
                        $("#fzgkjsp").val(item_a.主管会计审批);
                        $("#fzjlzlno").val(item_a.总经理助理工号);
                        $("#fzjlzlsp").val(item_a.总经理助理审批);
                        $("#freimburselast").val(FormatterTimeYMS(item_a.fscbxdate));
                        $("#stepId").val(stepId);
                        $("#fbillno").val(item_a.fbillno);
                        $("#taskId").val(item_a.TaskID);
                        var item_b = data.FormDataSet.BPM_ZPJT_SCCLVFBX_B;
                        for (var i = 0; i < item_b.length; i++) {
                            if (item_b[i].fjtgj == null) {
                                item_b[i].fjtgj = "";
                            }
                            if (item_b[i].fbz == null) {
                                item_b[i].fbz = "";
                            }
                            itemidArr.push(item_b[i].itemid);
                           
                            if (item_b[i].ffyxm == '住宿费') {
                                var li = '<form class="mui-card" id="sc-form">';
                                li = li + '     <div class="sc-bg">';
                                li = li + '<ul class="mui-table-view">';
                                li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)" style="display:none;">删除</button>';
                                li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">' + item_b[i].fbxje + '</span></h5 >';
                                li = li + '</a> ';

                                li = li + '<div class="mui-collapse-content">';

                                li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                                li = li + '                  <p>出发地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                li = li + '                  <span id="departure_city" class="mdcity" >' + item_b[i].cfdd_city + '</span>';
                                li = li + '             </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                                li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                li = li + '            </div>';
                                li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                                li = li + '                <p>目的地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                li = li + '                <span id="destination_city" class="mdcity" >' + item_b[i].dddd_city + '</span>';
                                li = li + '           </div>';
                                li = li + '          </div>';
                                li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                                li = li + '                <input type="text" value="至"/>';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                 <p>天数</p>';
                                li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                <p>报销金额</p>';
                                li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>会计审核</p>';
                                li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>财务审核</p>';
                                li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">费用标准</p>';
                                li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">地区类别</p>';
                                li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj"></p>';
                                if (item_b[i].fistp == "是") {
                                    li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                } else {
                                    li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                }
                                li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                li = li + '              </div>';
                                li = li + '      </div>';

                                li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                li = li + '               <p>备注</p>';
                                li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                li = li + '      </div>';

                                li = li + '</div>';
                                li = li + '</li>';
                                li = li + '</ul>';

                                li = li + '    </div>';
                                li = li + '  </form>';


                                $("#form_secondary").append(li);
                            } else if (item_b[i].ffyxm == '市内交通费') {
                                var li = '<form class="mui-card" id="sc-form">';
                                li = li + '     <div class="sc-bg">';
                                li = li + '<ul class="mui-table-view">';
                                li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)" style="display:none;">删除</button>';
                                li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">' + item_b[i].fbxje + '</span></h5 >';
                                li = li + '</a> ';

                                li = li + '<div class="mui-collapse-content">';

                                li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                                li = li + '                  <p>出发地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                li = li + '                  <span id="departure_city" class="mdcity" >' + item_b[i].cfdd_city + '</span>';
                                li = li + '             </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                                li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                li = li + '            </div>';
                                li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                                li = li + '                <p>目的地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                li = li + '                <span id="destination_city" class="mdcity" >' + item_b[i].dddd_city + '</span>';
                                li = li + '           </div>';
                                li = li + '          </div>';
                                li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                                li = li + '                <input type="text" value="至"/>';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                 <p>天数</p>';
                                li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                <p>报销金额</p>';
                                li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>会计审核</p>';
                                li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>财务审核</p>';
                                li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">费用标准</p>';
                                li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">地区类别</p>';
                                li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj"></p>';
                                if (item_b[i].fistp == "是") {
                                    li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                } else {
                                    li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                }
                                li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                li = li + '              </div>';
                                li = li + '      </div>';

                                li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                li = li + '               <p>备注</p>';
                                li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                li = li + '      </div>';

                                li = li + '</div>';
                                li = li + '</li>';
                                li = li + '</ul>';

                                li = li + '    </div>';
                                li = li + '  </form>';


                                $("#form_secondary").append(li);
                            } else if (item_b[i].ffyxm == '餐补费') {
                                var li = '<form class="mui-card" id="sc-form">';
                                li = li + '     <div class="sc-bg">';
                                li = li + '<ul class="mui-table-view">';
                                li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)" style="display:none;">删除</button>';
                                li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">' + item_b[i].fbxje + '</span></h5 >';
                                li = li + '</a> ';

                                li = li + '<div class="mui-collapse-content">';

                                li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                                li = li + '                  <p>出发地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                li = li + '                  <span id="departure_city" class="mdcity" >' + item_b[i].cfdd_city + '</span>';
                                li = li + '             </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                                li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                li = li + '            </div>';
                                li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                                li = li + '                <p>目的地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                li = li + '                <span id="destination_city" class="mdcity" >' + item_b[i].dddd_city + '</span>';
                                li = li + '           </div>';
                                li = li + '          </div>';
                                li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                                li = li + '                <input type="text" value="至"/>';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                                li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                 <p>天数</p>';
                                li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                <p>报销金额</p>';
                                li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>会计审核</p>';
                                li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>财务审核</p>';
                                li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">费用标准</p>';
                                li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">地区类别</p>';
                                li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj"></p>';
                                if (item_b[i].fistp == "是") {
                                    li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                } else {
                                    li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                }
                                li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                li = li + '              </div>';
                                li = li + '      </div>';

                                li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                li = li + '               <p>备注</p>';
                                li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                li = li + '      </div>';

                                li = li + '</div>';
                                li = li + '</li>';
                                li = li + '</ul>';

                                li = li + '    </div>';
                                li = li + '  </form>';


                                $("#form_secondary").append(li);
                            } else if (item_b[i].ffyxm == '车船费') {
                                var li = '<form class="mui-card" id="sc-form">';
                                li = li + '     <div class="sc-bg">';
                                li = li + '<ul class="mui-table-view">';
                                li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)" style="display:none;">删除</button>';
                                li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">' + item_b[i].fbxje + '</span></h5 >';
                                li = li + '</a> ';

                                li = li + '<div class="mui-collapse-content">';

                                li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                                li = li + '                  <p>出发地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                li = li + '                  <span id="departure_city" class="mdcity" >' + item_b[i].cfdd_city + '</span>';
                                li = li + '             </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div">';
                                li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                li = li + '            </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                                li = li + '                <p>目的地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                li = li + '                <span id="destination_city" class="mdcity" >' + item_b[i].dddd_city + '</span>';
                                li = li + '           </div>';
                                li = li + '          </div>';
                                li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                 <p>天数</p>';
                                li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                <p>报销金额</p>';
                                li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>会计审核</p>';
                                li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>财务审核</p>';
                                li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">费用标准</p>';
                                li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">地区类别</p>';
                                li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj"></p>';
                                if (item_b[i].fistp == "是") {
                                    li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                } else {
                                    li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                }
                                li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                li = li + '              </div>';
                                li = li + '      </div>';

                                li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                li = li + '               <p>备注</p>';
                                li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                li = li + '      </div>';

                                li = li + '</div>';
                                li = li + '</li>';
                                li = li + '</ul>';

                                li = li + '    </div>';
                                li = li + '  </form>';


                                $("#form_secondary").append(li);
                            } else if (item_b[i].ffyxm == '飞机费') {
                                var li = '<form class="mui-card" id="sc-form">';
                                li = li + '     <div class="sc-bg">';
                                li = li + '<ul class="mui-table-view">';
                                li = li + '<li class="mui-table-view-cell mui-collapse mui-active">';
                                li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                                li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + item_b[i].ffyxm + '</h5>';
                                li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)" style="display:none;">删除</button>';
                                li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary mui-pull-right">' + item_b[i].fbxje + '</span></h5 >';
                                li = li + '</a> ';

                                li = li + '<div class="mui-collapse-content">';

                                li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="' + item_b[i].ffyxm + '"/>';

                                li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                                li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                                li = li + '                  <p>出发地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="' + item_b[i].kscitymid + '"/>';
                                li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="' + item_b[i].cfdd_pro + '"/>';
                                li = li + '                  <span id="departure_city" class="mdcity" >' + item_b[i].cfdd_city + '</span>';
                                li = li + '             </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div">';
                                li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                                li = li + '                 <p id="transpotation">' + item_b[i].fjtgj + '</p>';
                                li = li + '            </div>';
                                li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                                li = li + '                <p>目的地<i>*</i></p>';
                                li = li + '                <input type="hidden" id="citymid" name="citymid" value="' + item_b[i].citymid + '"/>';
                                li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="' + item_b[i].dddd_pro + '"/>';
                                li = li + '                <span id="destination_city" class="mdcity" >' + item_b[i].dddd_city + '</span>';
                                li = li + '           </div>';
                                li = li + '          </div>';
                                li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                                li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fksdate) + '" class="mdate" />';
                                li = li + '             </div>';

                                li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                                li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="' + FormatterTimeYMS(item_b[i].fjsdate) + '" class="mdate" />';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                                li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                 <p>天数</p>';
                                li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="' + item_b[i].fccts + '"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '                <p>报销金额</p>';
                                li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="' + item_b[i].fbxje + '" class="bxje" />';
                                li = li + '             </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>会计审核</p>';
                                li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="' + item_b[i].fkjshje + '" readonly="readonly"/>';
                                li = li + '              </div>';
                                li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                                li = li + '               <p>财务审核</p>';
                                li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="' + item_b[i].fcwshje + '" readonly="readonly"/>';
                                li = li + '             </div>';
                                li = li + '       </div>';
                                li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">费用标准</p>';
                                li = li + '                 <input id="fstandard" name="fstandard" type="number" value="' + item_b[i].fccbzhj + '" class="mui-text-center" placeholder="待填"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj">地区类别</p>';
                                li = li + '                 <input id="farea" class="mui-text-center" type="text" value="' + item_b[i].fdqlb + '"/>';
                                li = li + '              </div>';
                                li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                                li = li + '                 <p class="p_adj"></p>';
                                if (item_b[i].fistp == "是") {
                                    li = li + ' <label id= "fspecially"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "是" /></label> ';
                                } else {
                                    li = li + ' <label id= "fspecially" class="label_tp"> 特批 <input type= "hidden" id= "ftp" name= "ftp" value= "否" /></label> ';
                                }
                                li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                                li = li + '              </div>';
                                li = li + '      </div>';

                                li = li + '       <div id="sc-row-7" class="mui-card-footer mui-row bottom_border">';
                                li = li + '               <p>备注</p>';
                                li = li + '              <input type="text" id="fbz" name="fbz" value="' + item_b[i].fbz + '" />';
                                li = li + '      </div>';

                                li = li + '</div>';
                                li = li + '</li>';
                                li = li + '</ul>';

                                li = li + '    </div>';
                                li = li + '  </form>';


                                $("#form_secondary").append(li);
                            }



                        }
                        if (item_a.fj != null && item_a.fj != "") {
                            var fjtmp = (String)(item_a.fj);

                            fjArray = fjtmp.split(";");


                            //console.log("fjArray:" + fjArray);

                            //请求附件详细信息
                            $.ajax({
                                type: 'POST',
                                url: '/api/bpm/GetAttachmentsInfo',
                                //dataType:'json',
                                data: { 'fileIds': fjArray },

                                beforeSend: function (XHR) {
                                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));
                                },
                                success: function (data, status) {
                                    if (status == "success") {

                                        console.log(data);

                                        for (var i = 0; i < data.length; i++) {

                                            var name = data[i].Name;
                                            var type = (data[i].Ext).replace(".", "");
                                            var size = String(data[i].Size);

                                            var time = String(data[i].LastUpdate).replace("T", " ");
                                            var downurl = baseDownloadUrl + data[i].FileID;
                                            var attach = attachItem(name, type, size, time, downurl);
                                            attachArray.push(attach);



                                            var li = '<div class="pic-preview smallyulan success">';
                                            li = li + ' <div class="del none" style="opacity:1;z-index:999;"onclick="delPicture(this)">x</div>';

                                            //类型判断 
                                            if ((data[i].Ext).indexOf("png") != -1 || (data[i].Ext).indexOf("jpg") != -1 || (data[i].Ext).indexOf("bmp") != -1) {

                                                //li = li + '    <div class="img-wrap smallimg" id="simg" ><a href="'+baseDownloadUrl + data[i].FileID + '"><img src="'+baseDownloadUrl + data[i].FileID + '"/></a></div>';
                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '" ><img src="'+baseDownloadUrl + data[i].FileID + '"/></div>';

                                            } else if ((data[i].Ext).indexOf("xls") != -1) {

                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/xlsx@2x.png"/></div>';

                                            } else if ((data[i].Ext).indexOf("doc") != -1) {

                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/docx@2x.png"/></div>';

                                            } else if ((data[i].Ext).indexOf("ppt") != -1) {

                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/ppt@2x.png"/></div>';

                                            } else if ((data[i].Ext).indexOf("pdf") != -1) {

                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/pdf@2x.png"/></div>';

                                            } else if ((data[i].Ext).indexOf("zip") != -1 || (data[i].Ext).indexOf("rar") != -1 || (data[i].Ext).indexOf("7z") != -1) {

                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/zip@2x.png"/></div>';

                                            } else if ((data[i].Ext).indexOf("txt") != -1) {

                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/txt@2x.png"/></div>';

                                            } else {
                                                li = li + '    <div class="img-wrap smallimg imgdiv" id="' + i + '"><img src="../../../../Content/images/unkown@2x.png"/></div>';
                                            }

                                            li = li + ' </div>';
                                            li = li + '</div>';
                                            $(".upload-img-list").append(li);


                                            $(".imgdiv").each(function () {

                                                $(this).parent().find(".del.none").hide();

                                            });




                                        }
                                        watch();  
                                        $(".imgdiv").on('tap', function () {
                                            console.log($(this)[0].id);
                                            XuntongJSBridge.call('showFile', {
                                                'fileName': attachArray[$(this)[0].id].name,
                                                'fileExt': attachArray[$(this)[0].id].type,
                                                'fileTime': attachArray[$(this)[0].id].time,
                                                'fileSize': attachArray[$(this)[0].id].size,
                                                'fileDownloadUrl': attachArray[$(this)[0].id].downurl
                                            }, function (result) {
                                                //alert(JSON.stringify(result));
                                            });
                                        });


                                    }

                                }, error: function (e) {
                                    console.log(e);

                                }, complete: function () {

                                }

                            });

                        }
                        if ($('#myPhone').val() == "") {
                            var myPhone = String(BPMOU).split("/");
                            $('#myPhone').val(String(myPhone[myPhone.length - 1]));

                        }
                        var NodeName;
                        //判断流程本节点是否结束，处理者是否为当前用户,
                        //流程步骤是否是传过来的流程步骤，再根据这三项查出对应的节点名称
                        for (var i = 0; i < data.Steps.length; i++) {
                            //debugger;

                            if (data.Steps[i].Finished == false && data.Steps[i].RecipientAccount == ($('#myPhone').val())) {


                                if (stepId.indexOf(data.Steps[i].StepID) != -1) {

                                    NodeName = data.Steps[i].NodeName;
                                    $("#nodename").val(NodeName);
                                }

                            }

                        }
                        if (NodeName == "开始") {
                            $("#createD").css("display", "block");
                            $(".upload-addbtn").css("display", "block");
                            $("#form_guide_project").css("display", "block");
                        } else if (NodeName == "sysInform") {
                            $("#readD").css("display", "block");
                        } else {
                            if (typeof (NodeName) != "undefined") {
                                $("#approvalD").css("display", "block");
                                if (NodeName.indexOf("会计") != -1) {

                                    $("#form_secondary").find("#faccountant_expense").each(function () {
                                        $(this).removeAttr("readonly");
                                    });
                                    $("#freimburseusenumber").removeAttr("readonly");     
                                } else if (NodeName.indexOf("财务") != -1) {
                                    $("#form_secondary").find("#ffinance_expense").each(function () {
                                        $(this).removeAttr("readonly");
                                        $(this).on('change', function () {
                                            CalculateExpenses();
                                        });

                                    });
                                    $("#freimburseusenumber").removeAttr("readonly");     
                                } else {

                                }
                            }
                        }
                        for (var i = 0; i < data.Steps.length; i++) {

                            if (data.Steps[i].FinishAt == "0001-01-01T00:00:00") {
                                data.Steps[i].FinishAt = "";
                            }
                            var time = FormatterTime(data.Steps[i].FinishAt);

                            var stepName = data.Steps[i].NodeName;
                            if (data.Steps[i].NodeName == "sysInform") {
                                stepName = "知会";
                            } else if (data.Steps[i].NodeName == "sysTaskOpt") {
                                stepName = "任务操作";
                            } else if (data.Steps[i].NodeName == "开始") {
                                stepName = "开始";
                            }

                            var stepAction = locationAction(data.Steps[i].SelAction);
                            if (data.Steps[i].SelAction == "sysInform") {
                                stepAction = "发起知会";
                            } else if (data.Steps[i].SelAction == "Submit") {
                                stepAction = "已阅";
                            } else if (data.Steps[i].SelAction == "null" || data.Steps[i].SelAction == null) {
                                stepAction = "待处理";
                            } else if (data.Steps[i].SelAction == "sysReject") {
                                stepAction = "拒绝";
                            } else if (data.Steps[i].SelAction == "sysRecedeRestart") {
                                stepAction = "退回重填";
                            }


                            var contents = data.Steps[i].Comments;
                            if (contents == null) {
                                contents = "无";
                            }
                            //判断是否是加签
                            if (data.Steps[i].IsConsignStep == false) {
                                var li = ' <li>';
                                li = li + '  <span class="lefttime"><i></i>' + time + '</span>';
                                li = li + '  <div class="righttext">';
                                li = li + '     <div style="font-size:0.65rem;">';
                                li = li + '        <div class="flowmsg">' + stepName + '<span style="font-size:0.65rem !important;">' + data.Steps[i].RecipientFullName + '</span></div>';
                                li = li + '        <label class="flowstatus">' + stepAction + '</label>';
                                li = li + '        <p>签核意见: ' + contents + '</p>';
                                li = li + '     </div>';
                                li = li + '   </div>';
                                li = li + '</li>';

                            } else {
                                var li = ' <li>';
                                li = li + '  <span class="lefttime"><i></i>' + time + '</span>';
                                li = li + '  <div class="righttext">';
                                li = li + '     <div style="font-size:0.65rem;">';
                                li = li + '        <div class="flowmsg signadd">加签<span style="font-size:0.65rem !important;">' + data.Steps[i].RecipientFullName + '</span></div>';
                                li = li + '        <label class="flowstatus">' + stepAction + '</label>';
                                li = li + '        <p>签核意见: ' + contents + '</p>';
                                li = li + '     </div>';
                                li = li + '   </div>';
                                li = li + '</li>';

                            }
                            $("#signff").append(li);
                        }
                    }
                }, error: function (e) {

                }, complete: function () {

                }
            });
        }


        function hasRead() {
            var fuser_no = $("#fno").val();
            var fname = $("#fname").text();
            var fzw = $("#fjob").val();
            var fjb = $("#fgrade").val();
            var fxb = $("#fsex").val();
            var fdate = $("#freimbursedate").val() + " 00:00:00";
            var fscbxdate = $("#freimburselast").val() + " 00:00:00";
            var fcompany = $("#fcompany").val();
            var ffcompany = $("#fmarket").val();
            var fdq = $("#fregion").val();
            var fbsq = $("#foffice").val();
            var fbcbxts = $("#fbusinessday").val();
            var fkbxcs = $("#freimbursecannumber").val();
            var fcftb = $("#freimburseusenumber").val();
            var fhj_bx = $("#fbxhj").val();
            var fhj_bxdx = atoc(parseFloat(fhj_bx));

            var fhj_cwsh = $("#fcwsh").val();
            var fhj_cwshdx = atoc(parseFloat(fhj_cwsh));
           
            var fbm = $("#fbm").val();
            var fbsczrno = $("#fbsczrno").val();
            var fbsczrsp = $("#fbsczrsp").val();
            var fdqjlno = $("#fdqjlno").val();
            var fdqjlsp = $("#fdqjlsp").val();
            var ffgszjlno = $("#ffgszjlno").val();
            var ffgszjlsp = $("#ffgszjlsp").val();
            var fxsfzno = $("#fxsfzno").val();
            var fxsfzsp = $("#fxsfzsp").val();
            var fzjlno = $("#fzjlno").val();
            var fzjlsp = $("#fzjlsp").val();
            var fsckjno = $("#fsckjno").val();
            var fsckjsp = $("#fsckjsp").val();
            var fzgkjno = $("#fzgkjno").val();
            var fzgkjsp = $("#fzgkjsp").val();
            var fzjlzlno = $("#fzjlzlno").val();
            var fzjlzlsp = $("#fzjlzlsp").val();
            var taskId = $("#taskId").val();
            var fbillno = $("#fbillno").val();
            var pid = $("#stepId").val();
            var expenselistArr = new Array();
            $("#form_secondary").find("#sc-form").each(function () {
                var ffyxm = $(this).find("#ffyxm").val();
                var fksdate = $(this).find("#fstartdate").val() + " 00:00:00";
                var fjsdate = $(this).find("#fenddate").val() + " 00:00:00";
                var cfdd_pro = $(this).find("#departure_province").val();
                var cfdd_city = $(this).find("#departure_city").text();
                var dddd_pro = $(this).find("#destination_province").val();
                var dddd_city = $(this).find("#destination_city").text();
                var citymid = $(this).find("#citymid").val();
                var fdqlb = $(this).find("#farea").val();
                var fccts = $(this).find("#fday").val();
                var fjtgj = $(this).find("#transpotation").text();

                var fbxje = $(this).find("#fsubmit_expense").val();

                var fbz = $(this).find("#fbz").val();

                
                var kscitymid = $(this).find("#kscitymid").val();
                var fccbzhj = $(this).find("#fstandard").val();
                var fistp = $(this).find("#ftp").val();

                var fkjshje = $(this).find("#faccountant_expense").val();
                var fcwshje = $(this).find("#ffinance_expense").val();

                var item = {
                    itemid: 0,
                    fentyrno: 0,
                    ffyxm: ffyxm,               //费用项目
                    ffykm: '2241.01.02.05',     //费用科目
                    fksdate: fksdate,                //开始日期
                    fjsdate: fjsdate,                //结束日期
                    cfdd_pro: cfdd_pro,               //出发省份
                    cfdd_city: cfdd_city,              //出发城市
                    dddd_pro: dddd_pro,               //目的省份
                    dddd_city: dddd_city,              //目的城市
                    citymid: citymid,                //目的地城市所属省份的id
                    fdd: '',                    //地址（县）
                    fdqlb: fdqlb,                  //地区类别
                    fccts: fccts,                   //出差天数
                    fjtgj: fjtgj,                  //交通工具
                    fccbz: '',
                    fbxje: fbxje,                  //报销金额
                    fkjshje: fkjshje,                //会计审核金额
                    fcwshje: fcwshje,                //财务审核金额
                    fbz: fbz,                    //备注
                    kscitymid: kscitymid,               //出发地所属省份的id
                    fccbzhj: fccbzhj,                 //费用标准
                    fistp: fistp,                  //是否特批
                    fzt: ''
                }

               
                var expenseitem = expenseItem(item);

                expenselistArr.push(expenseitem);
            });

            var comment = '';
            var btnArray = ['取消', '确定'];
            mui.prompt('请选填知会意见', '可以不填', '知会意见', btnArray, function (e) {
                if (e.index == 1) {
                    comment = e.value;
                    var xml = '<?xml version="1.0"?>';
                    xml = xml + '<XForm>';
                    xml = xml + '<Header>';
                    xml = xml + '<Method>InformSubmit</Method>';
                    xml = xml + '<PID>' + pid + '</PID>';
                    xml = xml + '<Comment>' + comment + '</Comment>';
                    xml = xml + '</Header>';
                    xml = xml + '<FormData>';
                    xml = xml + '            <BPM_ZPJT_SCCLVFBX_A>';
                    xml = xml + '                <fbillno>' + fbillno+'</fbillno>';
                    xml = xml + '                <fuser_no>' + fuser_no + '</fuser_no>';
                    xml = xml + '                <fname>' + fname + '</fname>';
                    xml = xml + '                <fzw>' + fzw + '</fzw>';
                    xml = xml + '                <fjb>' + fjb + '</fjb>';
                    xml = xml + '                <fxb>' + fxb + '</fxb>';
                    xml = xml + '                <fdate>' + fdate + '</fdate>';
                    xml = xml + '                <fscbxdate>' + fscbxdate + '</fscbxdate>';
                    xml = xml + '                <fcwdate></fcwdate>';
                    xml = xml + '               <fcompany>' + fcompany + '</fcompany>';
                    xml = xml + '                <ffcompany>' + ffcompany + '</ffcompany>';
                    xml = xml + '                <fdq>' + fdq + '</fdq>';
                    xml = xml + '              <fbsq>' + fbsq + '</fbsq>';
                    xml = xml + '                <fbcbxts>' + fbcbxts + '</fbcbxts>';
                    xml = xml + '                <fkbxcs>' + fkbxcs + '</fkbxcs>';
                    xml = xml + '                 <fcftb>' + fcftb + '</fcftb>';
                    xml = xml + '                <fwfcs></fwfcs>';
                    xml = xml + '               <fhj_bx>' + fhj_bx + '</fhj_bx>';
                    xml = xml + '               <fhj_bxdx>' + fhj_bxdx + '</fhj_bxdx>';
                    xml = xml + '              <fhj_cwsh>' + fhj_cwsh + '</fhj_cwsh>';
                    xml = xml + '               <fhj_cwshdx>' + fhj_cwshdx + '</fhj_cwshdx>';
                    if (fjArray.toString() != null && fjArray.toString() != "") {

                        xml = xml + '      <fj>' + fjArray.toString().replace(",", ";") + '</fj>';
                    } else {

                        xml = xml + '      <fj></fj>';
                    }

                    xml = xml + '                 <TaskID>' + taskId + '</TaskID>';
                    xml = xml + '              <fbm>' + fbm + '</fbm>';
                    xml = xml + '                                    <fswscno></fswscno>';
                    xml = xml + '              <fbsczrno></fbsczrno>';
                    xml = xml + '              <fdqjlno></fdqjlno>';
                    xml = xml + '               <fsckjno></fsckjno>';
                    xml = xml + '               <fxszgno></fxszgno>';
                    xml = xml + '              <fisswscno></fisswscno>';
                    xml = xml + '                 <fisbsczrno></fisbsczrno>';
                    xml = xml + '                <fisdqjlno></fisdqjlno>';
                    xml = xml + '               <fissckjno></fissckjno>';
                    xml = xml + '                 <fisxszgno></fisxszgno>';
                    xml = xml + '                <办事处主任工号>' + fbsczrno + '</办事处主任工号>';
                    xml = xml + '                <办事处主任审批>' + fbsczrsp + '</办事处主任审批>';
                    xml = xml + '                <大区经理工号>' + fdqjlno + '</大区经理工号>';
                    xml = xml + '               <大区经理审批>' + fdqjlsp + '</大区经理审批>';
                    xml = xml + '                <分公司总经理工号>' + ffgszjlno + '</分公司总经理工号>';
                    xml = xml + '               <分公司总经理审批>' + ffgszjlsp + '</分公司总经理审批>';
                    xml = xml + '                <销售副总工号>' + fxsfzno + '</销售副总工号>';
                    xml = xml + '               <销售副总审批>' + fxsfzsp + '</销售副总审批>';
                    xml = xml + '                <总经理工号>' + fzjlno + '</总经理工号>';
                    xml = xml + '                <总经理审批>' + fzjlsp + '</总经理审批>';
                    xml = xml + '                <市场会计工号>' + fsckjno + '</市场会计工号>';
                    xml = xml + '               <市场会计审批>' + fsckjsp + '</市场会计审批>';
                    xml = xml + '                 <主管会计工号>' + fzgkjno + '</主管会计工号>';
                    xml = xml + '                <主管会计审批>' + fzgkjsp + '</主管会计审批>';
                    xml = xml + '               <总经理助理工号>' + fzjlno + '</总经理助理工号>';
                    xml = xml + '               <总经理助理审批>' + fzjlsp + '</总经理助理审批>';
                    xml = xml + '              </BPM_ZPJT_SCCLVFBX_A>';
                    for (var i = 0; i < expenselistArr.length; i++) {

                        xml = xml + '    <BPM_ZPJT_SCCLVFBX_B>';
                        xml = xml + '                <RelationRowGuid>' + (i + 1) + '</RelationRowGuid>';
                        xml = xml + '            <RowPrimaryKeys>itemid=' + itemidArr[i] + '</RowPrimaryKeys>';
                        xml = xml + '                  <fentyrno>' + (i + 1) + '</fentyrno>';
                        xml = xml + '                <ffyxm>' + expenselistArr[i].ffyxm + '</ffyxm>';
                        xml = xml + '                <ffykm>2241.01.02.05</ffykm>';
                        xml = xml + '                <fksdate>' + expenselistArr[i].fksdate + '</fksdate>';
                        xml = xml + '                <fjsdate>' + expenselistArr[i].fjsdate + '</fjsdate>';
                        xml = xml + '               <cfdd_pro>' + expenselistArr[i].cfdd_pro + '</cfdd_pro>';
                        xml = xml + '                 <cfdd_city>' + expenselistArr[i].cfdd_city + '</cfdd_city>';
                        xml = xml + '                <kscitymid>' + expenselistArr[i].kscitymid + '</kscitymid>';
                        xml = xml + '                 <dddd_pro>' + expenselistArr[i].dddd_pro + '</dddd_pro>';
                        xml = xml + '                <dddd_city>' + expenselistArr[i].dddd_city + '</dddd_city>';
                        xml = xml + '               <citymid>' + expenselistArr[i].citymid + '</citymid>';
                        xml = xml + '                 <fdd></fdd>';
                        xml = xml + '                 <fdqlb>' + expenselistArr[i].fdqlb + '</fdqlb>';
                        xml = xml + '                <fccts>' + expenselistArr[i].fccts + '</fccts>';
                        xml = xml + '                <fjtgj>' + expenselistArr[i].fjtgj + '</fjtgj>';
                        xml = xml + '                <fccbz></fccbz>';
                        xml = xml + '                <fccbzhj>' + expenselistArr[i].fccbzhj + '</fccbzhj>';
                        xml = xml + '               <fistp>' + expenselistArr[i].fistp + '</fistp>';
                        xml = xml + '                 <fbxje>' + expenselistArr[i].fbxje + '</fbxje>';
                        xml = xml + '                <fkjshje>' + expenselistArr[i].fkjshje + '</fkjshje>';
                        xml = xml + '                 <fcwshje>' + expenselistArr[i].fcwshje + '</fcwshje>';
                        xml = xml + '                 <fbz>' + expenselistArr[i].fbz + '</fbz>';
                        xml = xml + '                 <fzt></fzt>';
                        xml = xml + '             </BPM_ZPJT_SCCLVFBX_B>';
                    }


                    xml = xml + '</FormData >';
                    xml = xml + '     </XForm>';

                    PostXml(xml);
                }
            });

        }

        function AgreeOrConSign() {
            var comment = $("#signSuggest").val();
            var fuser_no = $("#fno").val();
            var fname = $("#fname").text();
            var fzw = $("#fjob").val();
            var fjb = $("#fgrade").val();
            var fxb = $("#fsex").val();
            var fdate = $("#freimbursedate").val() + " 00:00:00";
            var fscbxdate = $("#freimburselast").val() + " 00:00:00";
            var fcompany = $("#fcompany").val();
            var ffcompany = $("#fmarket").val();
            var fdq = $("#fregion").val();
            var fbsq = $("#foffice").val();
            var fbcbxts = $("#fbusinessday").val();
            var fkbxcs = $("#freimbursecannumber").val();
            var fcftb = $("#freimburseusenumber").val();
            var fhj_bx = $("#fbxhj").val();
            var fhj_bxdx = atoc(parseFloat(fhj_bx));

            var fhj_cwsh = $("#fcwsh").val();
            var fhj_cwshdx = atoc(parseFloat(fhj_cwsh));

            var fbm = $("#fbm").val();
            var fbsczrno = $("#fbsczrno").val();
            var fbsczrsp = $("#fbsczrsp").val();
            var fdqjlno = $("#fdqjlno").val();
            var fdqjlsp = $("#fdqjlsp").val();
            var ffgszjlno = $("#ffgszjlno").val();
            var ffgszjlsp = $("#ffgszjlsp").val();
            var fxsfzno = $("#fxsfzno").val();
            var fxsfzsp = $("#fxsfzsp").val();
            var fzjlno = $("#fzjlno").val();
            var fzjlsp = $("#fzjlsp").val();
            var fsckjno = $("#fsckjno").val();
            var fsckjsp = $("#fsckjsp").val();
            var fzgkjno = $("#fzgkjno").val();
            var fzgkjsp = $("#fzgkjsp").val();
            var fzjlzlno = $("#fzjlzlno").val();
            var fzjlzlsp = $("#fzjlzlsp").val();

            var taskId = $("#taskId").val();
            var fbillno = $("#fbillno").val();
            var pid = $("#stepId").val();

            var nodename = $("#nodename").val();
           

            var expenselistArr = new Array();
            $("#form_secondary").find("#sc-form").each(function () {
                var ffyxm = $(this).find("#ffyxm").val();
                var fksdate = $(this).find("#fstartdate").val() + " 00:00:00";
                var fjsdate = $(this).find("#fenddate").val() + " 00:00:00";
                var cfdd_pro = $(this).find("#departure_province").val();
                var cfdd_city = $(this).find("#departure_city").text();
                var dddd_pro = $(this).find("#destination_province").val();
                var dddd_city = $(this).find("#destination_city").text();
                var citymid = $(this).find("#citymid").val();
                var fdqlb = $(this).find("#farea").val();
                var fccts = $(this).find("#fday").val();
                var fjtgj = $(this).find("#transpotation").text();

                var fbxje = $(this).find("#fsubmit_expense").val();

                var fbz = $(this).find("#fbz").val();


                var kscitymid = $(this).find("#kscitymid").val();
                var fccbzhj = $(this).find("#fstandard").val();
                var fistp = $(this).find("#ftp").val();

                var fkjshje = $(this).find("#faccountant_expense").val();
                var fcwshje = $(this).find("#ffinance_expense").val();

                var item = {
                    itemid: 0,
                    fentyrno: 0,
                    ffyxm: ffyxm,               //费用项目
                    ffykm: '2241.01.02.05',     //费用科目
                    fksdate: fksdate,                //开始日期
                    fjsdate: fjsdate,                //结束日期
                    cfdd_pro: cfdd_pro,               //出发省份
                    cfdd_city: cfdd_city,              //出发城市
                    dddd_pro: dddd_pro,               //目的省份
                    dddd_city: dddd_city,              //目的城市
                    citymid: citymid,                //目的地城市所属省份的id
                    fdd: '',                    //地址（县）
                    fdqlb: fdqlb,                  //地区类别
                    fccts: fccts,                   //出差天数
                    fjtgj: fjtgj,                  //交通工具
                    fccbz: '',
                    fbxje: fbxje,                  //报销金额
                    fkjshje: fkjshje,                //会计审核金额
                    fcwshje: fcwshje,                //财务审核金额
                    fbz: fbz,                    //备注
                    kscitymid: kscitymid,               //出发地所属省份的id
                    fccbzhj: fccbzhj,                 //费用标准
                    fistp: fistp,                  //是否特批
                    fzt: ''
                }


                var expenseitem = expenseItem(item);

                expenselistArr.push(expenseitem);
            });

            var xml = '<?xml version="1.0"?>';
            xml = xml + '<XForm>';
            xml = xml + '<Header>';
            xml = xml + '<Method>Process</Method>';
            xml = xml + '<PID>' + pid + '</PID>';
            xml = xml + '<Action>同意</Action>';
            xml = xml + '<Comment>' + comment + '</Comment>';
            xml = xml + ' <UrlParams></UrlParams>';
            xml = xml + '  <ConsignEnabled>false</ConsignEnabled>';
            xml = xml + '  <ConsignUsers>[]</ConsignUsers>';
            xml = xml + '  <ConsignRoutingType>Parallel</ConsignRoutingType>';
            xml = xml + '  <ConsignReturnType>Return</ConsignReturnType>';
            xml = xml + '   <InviteIndicateUsers>[]</InviteIndicateUsers>';
            xml = xml + '   <Context>{&quot;Routing&quot;:{}}</Context>';
            xml = xml + '</Header>';
            xml = xml + '<FormData>';
            xml = xml + '            <BPM_ZPJT_SCCLVFBX_A>';
            xml = xml + '                <fbillno>' + fbillno + '</fbillno>';
            xml = xml + '                <fuser_no>' + fuser_no + '</fuser_no>';
            xml = xml + '                <fname>' + fname + '</fname>';
            xml = xml + '                <fzw>' + fzw + '</fzw>';
            xml = xml + '                <fjb>' + fjb + '</fjb>';
            xml = xml + '                <fxb>' + fxb + '</fxb>';
            xml = xml + '                <fdate>' + fdate + '</fdate>';
            xml = xml + '                <fscbxdate>' + fscbxdate + '</fscbxdate>';
            xml = xml + '                <fcwdate></fcwdate>';
            xml = xml + '               <fcompany>' + fcompany + '</fcompany>';
            xml = xml + '                <ffcompany>' + ffcompany + '</ffcompany>';
            xml = xml + '                <fdq>' + fdq + '</fdq>';
            xml = xml + '              <fbsq>' + fbsq + '</fbsq>';
            xml = xml + '                <fbcbxts>' + fbcbxts + '</fbcbxts>';
            xml = xml + '                <fkbxcs>' + fkbxcs + '</fkbxcs>';
            xml = xml + '                 <fcftb>' + fcftb + '</fcftb>';
            xml = xml + '                <fwfcs></fwfcs>';
            xml = xml + '               <fhj_bx>' + fhj_bx + '</fhj_bx>';
            xml = xml + '               <fhj_bxdx>' + fhj_bxdx + '</fhj_bxdx>';
            xml = xml + '              <fhj_cwsh>' + fhj_cwsh + '</fhj_cwsh>';
            xml = xml + '               <fhj_cwshdx>' + fhj_cwshdx + '</fhj_cwshdx>';
            if (fjArray.toString() != null && fjArray.toString() != "") {

                xml = xml + '      <fj>' + fjArray.toString().replace(",", ";") + '</fj>';
            } else {

                xml = xml + '      <fj></fj>';
            }

            xml = xml + '                 <TaskID>' + taskId+'</TaskID>';
            xml = xml + '              <fbm>' + fbm + '</fbm>';
            xml = xml + '                                    <fswscno></fswscno>';
            xml = xml + '              <fbsczrno></fbsczrno>';
            xml = xml + '              <fdqjlno></fdqjlno>';
            xml = xml + '               <fsckjno></fsckjno>';
            xml = xml + '               <fxszgno></fxszgno>';
            xml = xml + '              <fisswscno></fisswscno>';
            xml = xml + '                 <fisbsczrno></fisbsczrno>';
            xml = xml + '                <fisdqjlno></fisdqjlno>';
            xml = xml + '               <fissckjno></fissckjno>';
            xml = xml + '                 <fisxszgno></fisxszgno>';
            xml = xml + '                <办事处主任工号>' + fbsczrno + '</办事处主任工号>';
            xml = xml + '                <办事处主任审批>' + fbsczrsp + '</办事处主任审批>';
            xml = xml + '                <大区经理工号>' + fdqjlno + '</大区经理工号>';
            xml = xml + '               <大区经理审批>' + fdqjlsp + '</大区经理审批>';
            xml = xml + '                <分公司总经理工号>' + ffgszjlno + '</分公司总经理工号>';
            xml = xml + '               <分公司总经理审批>' + ffgszjlsp + '</分公司总经理审批>';
            xml = xml + '                <销售副总工号>' + fxsfzno + '</销售副总工号>';
            xml = xml + '               <销售副总审批>' + fxsfzsp + '</销售副总审批>';
            xml = xml + '                <总经理工号>' + fzjlno + '</总经理工号>';
            xml = xml + '                <总经理审批>' + fzjlsp + '</总经理审批>';
            xml = xml + '                <市场会计工号>' + fsckjno + '</市场会计工号>';
            xml = xml + '               <市场会计审批>' + fsckjsp + '</市场会计审批>';
            xml = xml + '                 <主管会计工号>' + fzgkjno + '</主管会计工号>';
            xml = xml + '                <主管会计审批>' + fzgkjsp + '</主管会计审批>';
            xml = xml + '               <总经理助理工号>' + fzjlno + '</总经理助理工号>';
            xml = xml + '               <总经理助理审批>' + fzjlsp + '</总经理助理审批>';
            xml = xml + '              </BPM_ZPJT_SCCLVFBX_A>';
            for (var i = 0; i < expenselistArr.length; i++) {

                xml = xml + '    <BPM_ZPJT_SCCLVFBX_B>';
                xml = xml + '                <RelationRowGuid>' + (i + 1) + '</RelationRowGuid>';
                xml = xml + '            <RowPrimaryKeys>itemid=' + itemidArr[i] + '</RowPrimaryKeys>';
                xml = xml + '                  <fentyrno>' + (i + 1) + '</fentyrno>';
                xml = xml + '                <ffyxm>' + expenselistArr[i].ffyxm + '</ffyxm>';
                xml = xml + '                <ffykm>2241.01.02.05</ffykm>';
                xml = xml + '                <fksdate>' + expenselistArr[i].fksdate + '</fksdate>';
                xml = xml + '                <fjsdate>' + expenselistArr[i].fjsdate + '</fjsdate>';
                xml = xml + '               <cfdd_pro>' + expenselistArr[i].cfdd_pro + '</cfdd_pro>';
                xml = xml + '                 <cfdd_city>' + expenselistArr[i].cfdd_city + '</cfdd_city>';
                xml = xml + '                <kscitymid>' + expenselistArr[i].kscitymid + '</kscitymid>';
                xml = xml + '                 <dddd_pro>' + expenselistArr[i].dddd_pro + '</dddd_pro>';
                xml = xml + '                <dddd_city>' + expenselistArr[i].dddd_city + '</dddd_city>';
                xml = xml + '               <citymid>' + expenselistArr[i].citymid + '</citymid>';
                xml = xml + '                 <fdd></fdd>';
                xml = xml + '                 <fdqlb>' + expenselistArr[i].fdqlb + '</fdqlb>';
                xml = xml + '                <fccts>' + expenselistArr[i].fccts + '</fccts>';
                xml = xml + '                <fjtgj>' + expenselistArr[i].fjtgj + '</fjtgj>';
                xml = xml + '                <fccbz></fccbz>';
                xml = xml + '                <fccbzhj>' + expenselistArr[i].fccbzhj + '</fccbzhj>';
                xml = xml + '               <fistp>' + expenselistArr[i].fistp + '</fistp>';
                xml = xml + '                 <fbxje>' + expenselistArr[i].fbxje + '</fbxje>';
                xml = xml + '                <fkjshje>' + expenselistArr[i].fkjshje + '</fkjshje>';
                xml = xml + '                 <fcwshje>' + expenselistArr[i].fcwshje + '</fcwshje>';
                xml = xml + '                 <fbz>' + expenselistArr[i].fbz + '</fbz>';
                xml = xml + '                 <fzt></fzt>';
                xml = xml + '             </BPM_ZPJT_SCCLVFBX_B>';
            }


            xml = xml + '</FormData >';
            xml = xml + '     </XForm>';

            PostXml(xml);
        }

        function CalculateExpenses() {
            var total = 0;
            var total_cw = 0;
            $("#form_secondary").find("#fsubmit_expense").each(function () {

                total += parseInt($(this).val());

            });
            $("#form_secondary").find("#fcwsh").each(function () {
                total_cw += parseInt($(this).val());

            });

            $("#fbxhj").val(total);
            $("#fcwsh").val(total_cw);
        }

        var item = {
            itemid: 0,
            fentyrno: 0,
            ffyxm: '',               //费用项目
            ffykm: '2241.01.02.05',     //费用科目
            fksdate: '',                //开始日期
            fjsdate: '',                //结束日期
            cfdd_pro: '',               //出发省份
            cfdd_city: '',              //出发城市
            dddd_pro: '',               //目的省份
            dddd_city: '',              //目的城市
            citymid: '',                //目的地城市所属省份的id
            fdd: '',                    //地址（县）
            fdqlb: '',                  //地区类别
            fccts: 0,                   //出差天数
            fjtgj: '',                  //交通工具
            fccbz: '',                  //费用标准
            fbxje: '',                  //报销金额
            fkjshje: '',                //会计审核金额
            fcwshje: '',                //财务审核金额
            fbz: '',                    //备注
            kscitymid: 0,               //出发地所属省份的id
            fccbzhj: 0,
            fistp: '',                  //是否特批
            fzt: ''
        }
        function expenseItem(item) {
            console.log(item);
            if (!item.ffyxm || item.ffyxm == '') {
                mui.toast('请填写费用项目');
                return null;
            }
            if (!item.fksdate || item.fksdate == '') {
                mui.toast('请填写开始日期');
                return null;
            }
            if (!item.fjsdate || item.fjsdate == '') {
                mui.toast('请填写结束日期');
                return null;
            }
           
            if (!item.cfdd_city || item.cfdd_city == '') {

                mui.toast('请选择出发地城市');
                return null;
            }
           
            if (!item.dddd_city || item.dddd_city == '') {
                mui.toast('请选择目的地城市');
                return null;
            }
            return item;

        }

        function Save() {
            var taskId = $("#taskId").val();
            var fuser_no = $("#fno").val();
            var fname = $("#fname").text();
            var fzw = $("#fjob").val();
            var fjb = $("#fgrade").val();
            var fxb = $("#fsex").val();
            var fdate = $("#freimbursedate").val() + " 00:00:00";
            var fscbxdate = $("#freimburselast").val() + " 00:00:00";
            var fcompany = $("#fcompany").val();
            var ffcompany = $("#fmarket").val();
            var fdq = $("#fregion").val();
            var fbsq = $("#foffice").val();
            var fbcbxts = $("#fbusinessday").val();
            var fkbxcs = $("#freimbursecannumber").val();
            var fcftb = $("#freimburseusenumber").val();
            var fhj_bx = $("#fbxhj").val();
            var fhj_bxdx = atoc(parseFloat(fhj_bx));

            if (!fbcbxts || fbcbxts == '') {
                mui.toast("请填写本次出差天数");
                return false;
            }
            var fhj_cwsh = $("#fcwsh").val();
            var fhj_cwshdx = atoc(parseFloat(fhj_cwsh));
            var fbillno = $("#fbillno").val();
            var fbm = $("#fbm").val();
            var fbsczrno = $("#fbsczrno").val();
            var fbsczrsp = $("#fbsczrsp").val();
            var fdqjlno = $("#fdqjlno").val();
            var fdqjlsp = $("#fdqjlsp").val();
            var ffgszjlno = $("#ffgszjlno").val();
            var ffgszjlsp = $("#ffgszjlsp").val();
            var fxsfzno = $("#fxsfzno").val();
            var fxsfzsp = $("#fxsfzsp").val();
            var fzjlno = $("#fzjlno").val();
            var fzjlsp = $("#fzjlsp").val();
            var fsckjno = $("#fsckjno").val();
            var fsckjsp = $("#fsckjsp").val();
            var fzgkjno = $("#fzgkjno").val();
            var fzgkjsp = $("#fzgkjsp").val();
            var fzjlzlno = $("#fzjlzlno").val();
            var fzjlzlsp = $("#fzjlzlsp").val();
            var pid = $("#stepId").val();

            var expenselistArr = new Array();
            $("#form_secondary").find("#sc-form").each(function () {
                var ffyxm = $(this).find("#ffyxm").val();
                var fksdate = $(this).find("#fstartdate").val() + " 00:00:00";
                var fjsdate = $(this).find("#fenddate").val() + " 00:00:00";
                var cfdd_pro = $(this).find("#departure_province").val();
                var cfdd_city = $(this).find("#departure_city").text();
                var dddd_pro = $(this).find("#destination_province").val();
                var dddd_city = $(this).find("#destination_city").text();
                var citymid = $(this).find("#citymid").val();
                var fdqlb = $(this).find("#farea").val();
                var fccts = $(this).find("#fday").val();
                var fjtgj = $(this).find("#transpotation").text();

                var fbxje = $(this).find("#fsubmit_expense").val();

                var fbz = $(this).find("#fbz").val();



                var kscitymid = $(this).find("#kscitymid").val();
                var fccbzhj = $(this).find("#fstandard").val();
                var fistp = $(this).find("#ftp").val();

                var item = {
                    itemid: 0,
                    fentyrno: 0,
                    ffyxm: ffyxm,               //费用项目
                    ffykm: '2241.01.02.05',     //费用科目
                    fksdate: fksdate,                //开始日期
                    fjsdate: fjsdate,                //结束日期
                    cfdd_pro: cfdd_pro,               //出发省份
                    cfdd_city: cfdd_city,              //出发城市
                    dddd_pro: dddd_pro,               //目的省份
                    dddd_city: dddd_city,              //目的城市
                    citymid: citymid,                //目的地城市所属省份的id
                    fdd: '',                    //地址（县）
                    fdqlb: fdqlb,                  //地区类别
                    fccts: fccts,                   //出差天数
                    fjtgj: fjtgj,                  //交通工具
                    fccbz: '',
                    fbxje: fbxje,                  //报销金额
                    fkjshje: '',                //会计审核金额
                    fcwshje: '',                //财务审核金额
                    fbz: fbz,                    //备注
                    kscitymid: kscitymid,               //出发地所属省份的id
                    fccbzhj: fccbzhj,                 //费用标准
                    fistp: fistp,                  //是否特批
                    fzt: ''
                }

                if (expenseItem(item) == null) {
                    return false;
                }
                var expenseitem = expenseItem(item);

                expenselistArr.push(expenseitem);
            });


            var btnArry = ["取消", "确定"];
            mui.confirm('即将提交，是否确定？', '提交确认提醒', btnArry, function (e) {
                if (e.index == 1) {
                    //测试数据部分
                    //fname = '王均友';
                    //fuser_no = '00027772';
                    //fbm = '医用制品公司本部';
                    //BPMOU = 'BPMOU://威高集团/医用制品集团/医用制品公司/医用制品公司本部/华北销售公司/辽宁大区/沈阳办事处/00027772';

                    var xml = '<?xml version= "1.0" ?>';
                    xml = xml + ' <XForm>';
                    xml = xml + '   <Header>';
                    xml = xml + '    <Method>Process</Method>';
                    xml = xml + '   <PID>' + pid + '</PID>';
                    xml = xml + '   <Action>提交</Action>';
                    xml = xml + '    <Comment></Comment>';
                    xml = xml + '    <InviteIndicateUsers></InviteIndicateUsers>';
                    xml = xml + '  </Header>';
                    xml = xml + '       <FormData>';
                    xml = xml + '            <BPM_ZPJT_SCCLVFBX_A>';
                    xml = xml + '                <fbillno>' + fbillno + '</fbillno>';
                    xml = xml + '                <fuser_no>' + fuser_no + '</fuser_no>';
                    xml = xml + '                <fname>' + fname + '</fname>';
                    xml = xml + '                <fzw>' + fzw + '</fzw>';
                    xml = xml + '                <fjb>' + fjb + '</fjb>';
                    xml = xml + '                <fxb>' + fxb + '</fxb>';
                    xml = xml + '                <fdate>' + fdate + '</fdate>';
                    xml = xml + '                <fscbxdate>' + fscbxdate + '</fscbxdate>';
                    xml = xml + '                <fcwdate></fcwdate>';
                    xml = xml + '               <fcompany>' + fcompany + '</fcompany>';
                    xml = xml + '                <ffcompany>' + ffcompany + '</ffcompany>';
                    xml = xml + '                <fdq>' + fdq + '</fdq>';
                    xml = xml + '              <fbsq>' + fbsq + '</fbsq>';
                    xml = xml + '                <fbcbxts>' + fbcbxts + '</fbcbxts>';
                    xml = xml + '                <fkbxcs>' + fkbxcs + '</fkbxcs>';
                    xml = xml + '                 <fcftb>' + fcftb + '</fcftb>';
                    xml = xml + '                <fwfcs></fwfcs>';
                    xml = xml + '               <fhj_bx>' + fhj_bx + '</fhj_bx>';
                    xml = xml + '               <fhj_bxdx>' + fhj_bxdx + '</fhj_bxdx>';
                    xml = xml + '              <fhj_cwsh>0</fhj_cwsh>';
                    xml = xml + '               <fhj_cwshdx>零元整</fhj_cwshdx>';
                    if (fjArray.toString() != null && fjArray.toString() != "") {

                        xml = xml + '      <fj>' + fjArray.toString().replace(",", ";") + '</fj>';
                    } else {

                        xml = xml + '      <fj></fj>';
                    }

                    xml = xml + '                 <TaskID>' + taskId + '</TaskID>';
                    xml = xml + '              <fbm>' + fbm + '</fbm>';
                    xml = xml + '                                    <fswscno></fswscno>';
                    xml = xml + '              <fbsczrno></fbsczrno>';
                    xml = xml + '              <fdqjlno></fdqjlno>';
                    xml = xml + '               <fsckjno></fsckjno>';
                    xml = xml + '               <fxszgno></fxszgno>';
                    xml = xml + '              <fisswscno></fisswscno>';
                    xml = xml + '                 <fisbsczrno></fisbsczrno>';
                    xml = xml + '                <fisdqjlno></fisdqjlno>';
                    xml = xml + '               <fissckjno></fissckjno>';
                    xml = xml + '                 <fisxszgno></fisxszgno>';
                    xml = xml + '                <办事处主任工号>' + fbsczrno + '</办事处主任工号>';
                    xml = xml + '                <办事处主任审批>' + fbsczrsp + '</办事处主任审批>';
                    xml = xml + '                <大区经理工号>' + fdqjlno + '</大区经理工号>';
                    xml = xml + '               <大区经理审批>' + fdqjlsp + '</大区经理审批>';
                    xml = xml + '                <分公司总经理工号>' + ffgszjlno + '</分公司总经理工号>';
                    xml = xml + '               <分公司总经理审批>' + ffgszjlsp + '</分公司总经理审批>';
                    xml = xml + '                <销售副总工号>' + fxsfzno + '</销售副总工号>';
                    xml = xml + '               <销售副总审批>' + fxsfzsp + '</销售副总审批>';
                    xml = xml + '                <总经理工号>' + fzjlno + '</总经理工号>';
                    xml = xml + '                <总经理审批>' + fzjlsp + '</总经理审批>';
                    xml = xml + '                <市场会计工号>' + fsckjno + '</市场会计工号>';
                    xml = xml + '               <市场会计审批>' + fsckjsp + '</市场会计审批>';
                    xml = xml + '                 <主管会计工号>' + fzgkjno + '</主管会计工号>';
                    xml = xml + '                <主管会计审批>' + fzgkjsp + '</主管会计审批>';
                    xml = xml + '               <总经理助理工号>' + fzjlno + '</总经理助理工号>';
                    xml = xml + '               <总经理助理审批>' + fzjlsp + '</总经理助理审批>';
                    xml = xml + '              </BPM_ZPJT_SCCLVFBX_A>';
                    for (var i = 0; i < expenselistArr.length; i++) {

                        xml = xml + '    <BPM_ZPJT_SCCLVFBX_B>';
                        xml = xml + '                <RelationRowGuid>' + (i + 1) + '</RelationRowGuid>';
                        xml = xml + '            <RowPrimaryKeys>itemid=' + itemidArr[i] + '</RowPrimaryKeys>';
                        xml = xml + '                  <fentyrno>' + (i + 1) + '</fentyrno>';
                        xml = xml + '                <ffyxm>' + expenselistArr[i].ffyxm + '</ffyxm>';
                        xml = xml + '                <ffykm>2241.01.02.05</ffykm>';
                        xml = xml + '                <fksdate>' + expenselistArr[i].fksdate + '</fksdate>';
                        xml = xml + '                <fjsdate>' + expenselistArr[i].fjsdate + '</fjsdate>';
                        xml = xml + '               <cfdd_pro>' + expenselistArr[i].cfdd_pro + '</cfdd_pro>';
                        xml = xml + '                 <cfdd_city>' + expenselistArr[i].cfdd_city + '</cfdd_city>';
                        xml = xml + '                <kscitymid>' + expenselistArr[i].kscitymid + '</kscitymid>';
                        xml = xml + '                 <dddd_pro>' + expenselistArr[i].dddd_pro + '</dddd_pro>';
                        xml = xml + '                <dddd_city>' + expenselistArr[i].dddd_city + '</dddd_city>';
                        xml = xml + '               <citymid>' + expenselistArr[i].citymid + '</citymid>';
                        xml = xml + '                 <fdd></fdd>';
                        xml = xml + '                 <fdqlb>' + expenselistArr[i].fdqlb + '</fdqlb>';
                        xml = xml + '                <fccts>' + expenselistArr[i].fccts + '</fccts>';
                        xml = xml + '                <fjtgj>' + expenselistArr[i].fjtgj + '</fjtgj>';
                        xml = xml + '                <fccbz></fccbz>';
                        xml = xml + '                <fccbzhj>' + expenselistArr[i].fccbzhj + '</fccbzhj>';
                        xml = xml + '               <fistp>' + expenselistArr[i].fistp + '</fistp>';
                        xml = xml + '                 <fbxje>' + expenselistArr[i].fbxje + '</fbxje>';
                        xml = xml + '                <fkjshje></fkjshje>';
                        xml = xml + '                 <fcwshje></fcwshje>';
                        xml = xml + '                 <fbz>' + expenselistArr[i].fbz + '</fbz>';
                        xml = xml + '                 <fzt></fzt>';
                        xml = xml + '             </BPM_ZPJT_SCCLVFBX_B>';
                    }


                    xml = xml + '</FormData >';
                    xml = xml + '     </XForm>';

                    PostXml(xml);
                }
            });
        }

        function showdetail() {
            $("#form_main").css("display", "none");
            $("#form_secondary").css("display", "none");
            $("#form_guide_project").css("display", "none");
            $(".post_button").css("display", "none");
            $("#form_guide_extra").css("display", "none");
            $("#uploaddiv").css("display", "none");
            $(".hidden_button").css("display", "block");
            $(".extra_content").css("display", "block");
        }

        function hiddendetail() {
            $("#form_main").css("display", "block");
            $("#form_secondary").css("display", "block");
            $("#form_guide_project").css("display", "block");
            $(".post_button").css("display", "block");
            $("#uploaddiv").css("display", "block");
            $("#form_guide_extra").css("display", "block");
            $(".hidden_button").css("display", "none");
            $(".extra_content").css("display", "none");

        }

        function isTp(flevel, fyxm, fxb, fno) {
            var xml = '<?xml version= "1.0" ?>';
            xml = xml + '    <Requests>';
            xml = xml + '      <Params>';
            xml = xml + '       <DataSource>BPM_EXPENSE</DataSource>';
            xml = xml + '          <ID>sp_zpjt_clfybx</ID>';
            xml = xml + '         <Type>2</Type>';
            xml = xml + '           <Method>GetUserDataProcedure</Method>';
            xml = xml + '          <ProcedureName>sp_zpjt_clfybx</ProcedureName>';
            xml = xml + '          <Filter>';
            xml = xml + '              <_x0040_flevel>' + flevel + '</_x0040_flevel>';
            xml = xml + '                <_x0040_empno>' + fno + '</_x0040_empno>';
            xml = xml + '               <_x0040_fyxm>' + fyxm + '</_x0040_fyxm>';
            xml = xml + '             <_x0040_fxb>' + fxb + '</_x0040_fxb>';
            xml = xml + '                <_x0040_fdqlb></_x0040_fdqlb>';
            xml = xml + '               <_x0040_fsatrdate></_x0040_fsatrdate>';
            xml = xml + '               <_x0040_fenddate></_x0040_fenddate>';
            xml = xml + '           </Filter>';
            xml = xml + '      </Params>';
            xml = xml + '   </Requests>';
            $.ajax({
                type: "POST",
                url: "/api/bpm/DataProvider",
                data: { '': xml },
                beforeSend: function (XHR) {
                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                },
                success: function (data, status) {

                    if (status == "success" || data.success == "true" || data.success == true) {


                        var provideData = JSON.parse(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));
                        //console.log(provideData);
                        var fistp = provideData.Tables[0].Rows[0].fistp;
                        var fybz = provideData.Tables[0].Rows[0].fybz;

                        //console.log($("#form_secondary").find("#fstandard").first());
                        if (fistp == "是") {

                            $("#form_secondary").find("#fspecially").first()[0].classList.value = "";
                            $("#form_secondary").find("#fstandard").first()[0].value = fybz;
                            $("#form_secondary").find("#ftp").first()[0].value = fistp;


                        } else {


                        }





                    }
                }, error: function (e) {
                    mui.toast(e);

                }, complete: function () {


                }
            });
        }

        function autoSerial() {
            var i = 0;
            $("#form_secondary").find("#fentryno").each(function () {
                $(this).text((i + 1));
                i++;
            });
        }

        function tapEvent() {



            mui('body').on('tap', '.mui-popover-action li>a', function () {


                var a = this,
                    parent;
                //根据点击按钮，反推当前是哪个actionsheet
                for (parent = a.parentNode; parent != document.body; parent = parent.parentNode) {
                    if (parent.classList.contains('mui-popover-action')) {
                        break;
                    }
                }
                //关闭actionsheet
                mui('#' + parent.id).popover('toggle');
                var button_id = a.innerHTML;
                //console.log(button_id);

                if (button_id == '住宿费') {
                    //住宿费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';
                    li = li + '           <input type="hidden" id="ffyxm" name="ffyxm" value="住宿费"/>';
                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" class="invalid_field" >威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation"></p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                    li = li + '                <p>所在城市<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                    li = li + '                <input type="text" value="至"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填" />';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder column_adj">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';



                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';




                } else if (button_id == '市内交通费') {
                    //市内交通
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';


                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="市内交通费"/>';


                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" class="invalid_field" >威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation"></p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                    li = li + '                <p>所在城市<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row">';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                    li = li + '                <input type="text" value="至"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="1"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';

                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else if (button_id == '餐补费') {
                    //餐补费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';

                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="餐补费"/>';

                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure" style="display:none;">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" class="invalid_field" >威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" style="display:none;">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation"></p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-12 mui-text-center" id="destination">';
                    li = li + '                <p>所在城市<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-2 mui-text-center">';
                    li = li + '                <input type="text" value="至"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-5 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="0"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';
                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else if (button_id == '车船费') {
                    //车船费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';

                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="车船费"/>';

                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" onclick="showcity(0,this)" class="mdcity">威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div" >';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation">汽车</p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                    li = li + '                <p>目的地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="0"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';
                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else if (button_id == '飞机费') {
                    //飞机费
                    var li = '<form class="mui-card" id="sc-form">';
                    li = li + '     <div class="sc-bg">';
                    li = li + '<ul class="mui-table-view">';
                    li = li + '<li class="mui-table-view-cell mui-collapse">';
                    li = li + ' <a href="#" class="mui-navigate-right mui-row">';
                    li = li + '<p id="fentryno" class="mui-col-xs-1"></p><h5 class="mui-col-xs-3">' + button_id + '</h5>';
                    li = li + '<button type="button" class="mui-btn mui-btn-link " onclick="deleteItem(this)">删除</button>';
                    li = li + '<h5 id= "ffy" name= "ffy" class="mui-col-xs-4"> <span class="mui-badge mui-badge-primary">0</span></h5 >';
                    li = li + '</a> ';
                    li = li + '<div class="mui-collapse-content">';

                    li = li + '                <input type="hidden" id="ffyxm" name="ffyxm" value="飞机费"/>';

                    li = li + '           <div id="sc-row-1" class="mui-card-header mui-row" >';
                    li = li + '             <div class="mui-col-xs-4 mui-text-center" id="departure">';
                    li = li + '                  <p>出发地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="kscitymid" name="kscitymid" value="15"/>';
                    li = li + '                  <input type="hidden" id="departure_province" name="departure_province" value="山东省"/>';
                    li = li + '                  <span id="departure_city" onclick="showcity(0,this)" class="mdcity">威海市</span>';
                    li = li + '             </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="transport_div">';
                    li = li + '                 <span class="mui-icon mui-icon-pengyouquan" id="change_transpotation"></span>';
                    li = li + '                 <p id="transpotation">飞机</p>';
                    li = li + '            </div>';
                    li = li + '            <div class="mui-col-xs-4 mui-text-center" id="destination">';
                    li = li + '                <p>目的地<i>*</i></p>';
                    li = li + '                <input type="hidden" id="citymid" name="citymid" value="15"/>';
                    li = li + '                <input type="hidden" id="destination_province" name="destination_province" value="山东省"/>';
                    li = li + '                <span id="destination_city" onclick="showcity(1,this)" class="mdcity">威海市</span>';
                    li = li + '           </div>';
                    li = li + '          </div>';
                    li = li + '         <div id="sc-row-2" class="mui-card-content mui-row bottomborder">';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fstartdate" name="fstartdate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-6 mui-text-center">';
                    li = li + '               <input type="text" id="fenddate" name="fenddate" readonly="readonly" value="2017-07-19" class="mdate" onclick="mdateTap(this)"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-4" class="mui-card-content mui-row bottomborder">';
                    li = li + '              <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                 <p>天数</p>';
                    li = li + '                <input type="number" id="fday" name="fday" readonly="readonly" value="0"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '                <p>报销金额</p>';
                    li = li + '               <input type="number" id="fsubmit_expense" name="fsubmit_expense" value="" class="bxje" placeholder="待填"/>';
                    li = li + '             </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>会计审核</p>';
                    li = li + '               <input type="number" id="faccountant_expense" name="faccountant_expense" value="0" readonly="readonly"/>';
                    li = li + '              </div>';
                    li = li + '             <div class="mui-col-xs-3 mui-text-center">';
                    li = li + '               <p>财务审核</p>';
                    li = li + '               <input type="number" id="ffinance_expense" name="ffinance_expense" value="0" readonly="readonly"/>';
                    li = li + '             </div>';
                    li = li + '       </div>';
                    li = li + '       <div id="sc-row-6" class="mui-card-content  mui-row bottomborder">';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">费用标准</p>';
                    li = li + '                 <input id="fstandard" name="fstandard" type="number"  class="mui-text-center" placeholder="待填"/>';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj">地区类别</p>';
                    li = li + '                 <input id="farea" name="farea" type="text" class="mui-text-center" value="二类" readonly="readonly" />';
                    li = li + '              </div>';
                    li = li + '               <div class="mui-col-xs-4 mui-text-center">';
                    li = li + '                 <p class="p_adj"></p>';
                    li = li + '                 <label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label>';
                    li = li + '              </div>';
                    li = li + '      </div>';
                    //li = li + '       <div id="sc-row-6" class="mui-input-row ">';
                    //li = li + '               <label class="mui-col-xs-6">费用标准</label>';
                    //li = li + '               <input id="fstandard" name="fstandard" type="number" value="" class="mui-col-xs-6" placeholder="请输入费用标准"/>';
                    //li = li + '      </div>';
                    //li = li + '      <div id="sc-row-5" class="mui-card-footer mui-row  bottomborder">';
                    //li = li + '               <div class="mui-col-xs-6">地区类别 &nbsp;<label id="farea" class="farea">二类</label></div>';

                    //li = li + '              <div class="mui-col-xs-6"><label id="fspecially" class="label_tp">特批<input type="hidden" id="ftp" name="ftp" value="否"/></label></div>';
                    //li = li + '      </div>';
                    li = li + '       <div id="sc-row-7" class="mui-input-row ">';
                    li = li + '               <label>备注</label>';
                    li = li + '              <input type="text" id="fbz" name="fbz" value="" placeholder="请输入备注"/>';
                    li = li + '      </div>';
                    li = li + '</div>';
                    li = li + '</li>';
                    li = li + '</ul>';

                    li = li + '    </div>';
                    li = li + '  </form>';

                } else {


                }
                var flevel = $("#fgrade").val();
                //var fyxm = $(this).text();
                var fyxm = a.innerHTML;
                var fxb = $("#fsex").val();
                var fno = $("#fno").val();

                $("#form_secondary").prepend(li);
                isTp(flevel, fyxm, fxb, fno);

                $(".mdate").mdater();



                if (button_id == '车船费') {
                    var element = document.getElementById('transport_div');
                    var aim = document.getElementById('transpotation');
                    var picker = new mui.PopPicker();
                    picker.setData(transport_data);
                    element.addEventListener('tap', function () {

                        picker.show(function (items) {

                            aim.textContent = items[0].text;
                        });

                    }, false);
                }


                $(".bxje").on('input', function () {
                    CalculateExpenses();
                    var bxje = $(this).val();
                    $(this).parent().parent().parent().parent().find('#ffy').children().text(bxje);
                });
                //$("#form_secondary").children().find("li").removeClass('mui-acitve');
                $("#form_secondary").children().first().find("li").addClass('mui-active');


            });

            $("#freimbursedate").on('change', function () {
                $("#freimbursedate2").text($(this).val());
            });
        }
        //undo:重复绑定了click事件和tap事件
        function mdateTap(context) {

            $(context).mdater();

        }
        var city_auto_focus_flag = 0;
        var anchor_context = '';
        function showcity(i, context) {

            //i: 0代表出发地，1代表目的地
            //window.location.href="city-selector.html?autofocus="+i;


            $("#form_main").css("display", "none");
            $("#form_secondary").css("display", "none");
            $("#form_guide_project").css("display", "none");
            $(".post_div").css("display", "none");
            $("#form_guide_city_all").css("display", "block");
            $("#form_guide_city").css("display", "block");
            $(".city_collection").css("visibility", "visible");
            $("#form_guide_extra").css("display", "none");
            $("#uploaddiv").css("display", "none");
            city_auto_focus_flag = i;
            anchor_context = context;
            auto_focus();

        }
        function hiddencity() {

            $("#form_guide_city_all").css("display", "none");
            $("#form_guide_city").css("display", "none");
            $(".city_collection").css("visibility", "hiddden");
            $("#form_main").css("display", "block");
            $("#form_secondary").css("display", "block");
            $("#form_guide_project").css("display", "block");
            $(".post_div").css("display", "block");
            $("#uploaddiv").css("display", "block");
        }
        function deleteItem(context) {
            //console.log($(context).parent().parent().parent());
            $(context).parent().parent().parent().parent().parent().remove();
        }

        function selectCity() {
            var xml = '<?xml version= "1.0" ?>';
            xml = xml + '      <Requests>';
            xml = xml + '     <Params>';
            xml = xml + '          <Method>GetFormPostData</Method>';
            xml = xml + '        <ProcessName>市场差旅费用报销单</ProcessName>';
            xml = xml + '         <ProcessVersion>1.1</ProcessVersion>';
            xml = xml + '          <Owner></Owner>';
            xml = xml + '      </Params>';
            xml = xml + '      <Params>';
            xml = xml + '         <DataSource>BPM_EXPENSE</DataSource>';
            xml = xml + '          <ID>sys_zpfy_fykm</ID>';
            xml = xml + '      <Type>1</Type>';
            xml = xml + '        <Method>GetUserDataTable</Method>';
            xml = xml + '       <TableName>sys_zpfy_fykm</TableName>';
            xml = xml + '       <OrderBy></OrderBy>';
            xml = xml + '        </Params>';
            xml = xml + '       <Params>';
            xml = xml + '          <DataSource>BPM_EXPENSE</DataSource>';
            xml = xml + '          <ID>BPM_ZPJT_SCCLVFBX_Province</ID>';
            xml = xml + '         <Type>1</Type>';
            xml = xml + '        <Method>GetUserDataTable</Method>';
            xml = xml + '      <TableName>BPM_ZPJT_SCCLVFBX_Province</TableName>';
            xml = xml + '          <OrderBy></OrderBy>';
            xml = xml + '     </Params>';
            xml = xml + '      <Params>';
            xml = xml + '        <DataSource>BPM_EXPENSE</DataSource>';
            xml = xml + '         <ID>BPM_ZPJT_SCCLVFBX_City</ID>';
            xml = xml + '            <Type>1</Type>';
            xml = xml + '          <Method>GetUserDataTable</Method>';
            xml = xml + '        <TableName>BPM_ZPJT_SCCLVFBX_City</TableName>';
            xml = xml + '          <OrderBy></OrderBy>';
            xml = xml + '       </Params>';
            xml = xml + '      <Params>';
            xml = xml + '          <DataSource>BPM_EXPENSE</DataSource>';
            xml = xml + '          <ID>BPM_ZPJT_SCCLVFBX_JTGJ</ID>';
            xml = xml + '        <Type>1</Type>';
            xml = xml + '         <Method>GetUserDataTable</Method>';
            xml = xml + '     <TableName>BPM_ZPJT_SCCLVFBX_JTGJ</TableName>';
            xml = xml + '           <OrderBy></OrderBy>';
            xml = xml + '       </Params>';
            xml = xml + '   </Requests>';
            $.ajax({
                type: "POST",
                url: "/api/bpm/DataProvider",
                data: { '': xml },
                beforeSend: function (XHR) {
                    XHR.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('ticket'));

                },
                success: function (data, status) {

                    if (status == "success" || data.success == "true" || data.success == true) {
                        //console.log(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));

                        var provideData = JSON.parse(unescape(data.replace(/\\(u[0-9a-fA-F]{4})/gm, '%$1')));


                        cityData = [];
                        var children;
                        for (var i = 0; i < provideData.Tables[4].Rows.length; i++) {
                            var id_province = provideData.Tables[4].Rows[i].id;
                            children = new Array();
                            for (var j = 0; j < provideData.Tables[5].Rows.length; j++) {
                                var id_city = provideData.Tables[5].Rows[j].id;
                                if (id_province == id_city) {
                                    var city = ({
                                        value: provideData.Tables[5].Rows[j].cityid,
                                        text: provideData.Tables[5].Rows[j].cityname,
                                        type: provideData.Tables[5].Rows[j].citytype,
                                        id: provideData.Tables[5].Rows[j].id,
                                        province: provideData.Tables[4].Rows[i].provincename
                                    });
                                    children.push(city);
                                }
                            }

                            var province_city = ({
                                value: provideData.Tables[4].Rows[i].provinceid,
                                text: provideData.Tables[4].Rows[i].provincename,
                                children: children
                            });
                            cityData.push(province_city);

                        }


                    }
                }, error: function (e) {

                }, complete: function () {
                    var controls = document.getElementById("segmentedControls");
                    var contents = document.getElementById("segmentedControlContents");
                    var html = [];
                    var i = 0,
                        j = 0,
                        m = cityData.length, //左侧选项卡数量+1
                        n = 21; //每个选项卡列表数量+1
                    for (; i < cityData.length; i++) {
                        html.push('<a class="mui-control-item item_province" data-index="' + (i) + '" href="#content' + (i + 1) + '">' + cityData[i].text + '</a>');
                    }
                    controls.innerHTML = html.join('');
                    html = [];
                    for (i = 0; i < cityData.length; i++) {
                        html.push('<div id="content' + i + '" class="mui-control-content"><ul class="mui-table-view">');
                        for (j = 0; j < cityData[i].children.length; j++) {

                            html.push('<li class="mui-table-view-cell city_chosen">' + cityData[i].children[j].text + '<input type="hidden" id="citytype" name="citytype" value="' + cityData[i].children[j].type + '"/><input type="hidden" id="citymid" name="citymid" value="' + cityData[i].children[j].id + '"/><input type="hidden" id="provincename" name="provincename" value="' + cityData[i].children[j].province + '"/></li>');
                        }
                        html.push('</ul></div>');
                    }
                    contents.innerHTML = html.join('');
                    //默认选中第一个
                    controls.querySelector('.mui-control-item').classList.add('mui-active');
                    //contents.querySelector('.mui-control-content').classList.add('mui-active');
                    (function () {
                        var controlsElem = document.getElementById("segmentedControls");
                        var contentsElem = document.getElementById("segmentedControlContents");
                        var controlListElem = controlsElem.querySelectorAll('.mui-control-item');
                        var contentListElem = contentsElem.querySelectorAll('.mui-control-content');
                        var controlWrapperElem = controlsElem.parentNode;
                        var controlWrapperHeight = controlWrapperElem.offsetHeight;
                        var controlMaxScroll = controlWrapperElem.scrollHeight - controlWrapperHeight;//左侧类别最大可滚动高度

                        var maxScroll = contentsElem.scrollHeight - contentsElem.offsetHeight;//右侧内容最大可滚动高度

                        var controlHeight = controlListElem[0].offsetHeight;//左侧类别每一项的高度
                        var controlTops = []; //存储control的scrollTop值
                        var contentTops = [0]; //存储content的scrollTop值
                        var length = contentListElem.length;
                        for (var i = 0; i < length; i++) {
                            controlTops.push(controlListElem[i].offsetTop + controlHeight);
                        }
                        for (var i = 1; i < length; i++) {
                            var offsetTop = contentListElem[i].offsetTop;
                            if (offsetTop + 100 >= maxScroll) {
                                var height = Math.max(offsetTop + 100 - maxScroll, 100);
                                var totalHeight = 0;
                                var heights = [];
                                for (var j = i; j < length; j++) {
                                    var offsetHeight = contentListElem[j].offsetHeight;
                                    totalHeight += offsetHeight;
                                    heights.push(totalHeight);
                                }
                                for (var m = 0, len = heights.length; m < len; m++) {
                                    contentTops.push(parseInt(maxScroll - (height - heights[m] / totalHeight * height)));
                                }
                                break;
                            } else {
                                contentTops.push(parseInt(offsetTop));
                            }
                        }
                        contentsElem.addEventListener('scroll', function () {
                            var scrollTop = contentsElem.scrollTop;
                            for (var i = 0; i < length; i++) {
                                var offsetTop = contentTops[i];
                                var offset = Math.abs(offsetTop - scrollTop);
                                //						console.log("i:"+i+",scrollTop:"+scrollTop+",offsetTop:"+offsetTop+",offset:"+offset);
                                if (scrollTop < offsetTop) {
                                    if (scrollTop >= maxScroll) {
                                        onScroll(length - 1);
                                    } else {
                                        onScroll(i - 1);
                                    }
                                    break;
                                } else if (offset < 20) {
                                    onScroll(i);
                                    break;
                                } else if (scrollTop >= maxScroll) {
                                    onScroll(length - 1);
                                    break;
                                }
                            }
                        });
                        var lastIndex = 0;
                        //监听content滚动
                        var onScroll = function (index) {
                            if (lastIndex !== index) {
                                lastIndex = index;
                                var lastActiveElem = controlsElem.querySelector('.mui-active');
                                lastActiveElem && (lastActiveElem.classList.remove('mui-active'));
                                var currentElem = controlsElem.querySelector('.mui-control-item:nth-child(' + (index + 1) + ')');
                                currentElem.classList.add('mui-active');
                                //简单处理左侧分类滚动，要么滚动到底，要么滚动到顶
                                var controlScrollTop = controlWrapperElem.scrollTop;
                                if (controlScrollTop + controlWrapperHeight < controlTops[index]) {
                                    controlWrapperElem.scrollTop = controlMaxScroll;
                                } else if (controlScrollTop > controlTops[index] - controlHeight) {
                                    controlWrapperElem.scrollTop = 0;
                                }
                            }
                        };
                        //滚动到指定content
                        var scrollTo = function (index) {
                            contentsElem.scrollTop = contentTops[index];
                        };
                        mui(controlsElem).on('tap', '.mui-control-item', function (e) {
                            scrollTo(this.getAttribute('data-index'));
                            return false;
                        });

                    })();

                    (function () {


                        var fdeparture_chosen = document.getElementById('fdeparture_chosen');
                        var fdestination_chosen = document.getElementById('fdestination_chosen');
                        $('.city_chosen').on('tap', function () {
                            var cityvalue = $(this).text();
                            var citytype;
                            var citymid;
                            //处理城市类型和城市所属省份编码
                            if (String($(this)[0].id).indexOf("hot") == -1 && String($(this)[0].id).indexOf("history") == -1) {
                                citytype = $(this)[0].children.citytype.value;
                                citymid = $(this)[0].children.citymid.value;
                            } else if (String($(this)[0].id).indexOf("hot") != -1) {
                                citytype = "一类";
                                if (String($(this)[0].id).indexOf("3") != -1) {
                                    //深圳
                                    citytype = "二类";
                                    citymid = '19';
                                }
                                if (String($(this)[0].id).indexOf("4") != -1) {
                                    //广州
                                    citymid = '19';
                                }
                                if (String($(this)[0].id).indexOf("1") != -1) {
                                    //上海
                                    citymid = '9';
                                }
                                if (String($(this)[0].id).indexOf("2") != -1) {
                                    //北京
                                    citymid = '2';
                                }
                            } else {
                                //威海 青岛
                                citytype = "二类";
                                citymid = '15';
                            }
                            //处理城市所属省份
                            var id = $(this)[0].id;
                            var province = '';
                            if (typeof ($(this)[0].children.provincename) != 'undefined') {
                                province = $(this)[0].children.provincename.value;
                            }

                            if (id.indexOf("hot") == -1 && id.indexOf("history") == -1) {
                                if ($("#fdestination_chosen").is(":focus") || fdestination_chosen.hasAttribute('autofocus')) {
                                    $("#fdestination_province_chosen").val(province);


                                } else if ($("#fdeparture_chosen").is(":focus") || fdeparture_chosen.hasAttribute('autofocus')) {
                                    $("#fdeparture_province_chosen").val(province);
                                } else {

                                }
                            } else if (id.indexOf("hot") != -1) {
                                //console.log($(this));
                                if (id.indexOf("1") != -1) {
                                    //上海
                                    province = "上海市";
                                } else if (id.indexOf("2") != -1) {
                                    //北京
                                    province = "北京市";
                                } else if (id.indexOf("3") != -1) {
                                    //深圳
                                    province = "广东省";
                                } else if (id.indexOf("4") != -1) {
                                    //广州
                                    province = "广东省";
                                } else {

                                }
                                if ($("#fdestination_chosen").is(":focus") || fdestination_chosen.hasAttribute('autofocus')) {
                                    $("#fdestination_province_chosen").val(province);
                                } else if ($("#fdeparture_chosen").is(":focus") || fdeparture_chosen.hasAttribute('autofocus')) {
                                    $("#fdeparture_province_chosen").val(province);


                                } else {
                                    console.log('省份出现问题');
                                }
                            } else if (id.indexOf("history") != -1) {
                                if (id.indexOf("1") != -1) {
                                    //威海
                                    province = "山东省";
                                } else if (id.indexOf("2") != -1) {
                                    //青岛
                                    province = "山东省";
                                } else if (id.indexOf("3") != -1) {

                                } else if (id.indexOf("4") != -1) {

                                } else {

                                }
                                if ($("#fdestination_chosen").is(":focus") || fdestination_chosen.hasAttribute('autofocus')) {
                                    $("#fdestination_province_chosen").val(province);
                                } else if ($("#fdeparture_chosen").is(":focus") || fdeparture_chosen.hasAttribute('autofocus')) {
                                    $("#fdeparture_province_chosen").val(province);

                                } else {
                                    console.log('省份出现问题');
                                }
                            } else {
                                mui.toast("id获取错误");
                            }

                            //处理自动获取焦点或者用户点击输入框获取焦点部分
                            if (fdestination_chosen.hasAttribute('autofocus')) {
                                $("#fdestination_chosen").val(cityvalue);

                                $("#citytype_chosen").val(citytype);
                                $("#fdestination_citymid").val(citymid);
                                fdestination_chosen.removeAttribute('autofocus');
                                //变换焦点
                                fdeparture_chosen.setAttribute('autofocus', 'autofocus');
                                city_auto_focus_flag = 2;

                            } else if (fdeparture_chosen.hasAttribute('autofocus')) {
                                $("#fdeparture_chosen").val(cityvalue);
                                $("#fdeparture_citymid").val(citymid);
                                fdeparture_chosen.removeAttribute('autofocus');
                                //变换焦点
                                fdestination_chosen.setAttribute('autofocus', 'autofocus');
                                city_auto_focus_flag = 2;
                            } else if ($("#fdeparture_chosen").is(":focus")) {
                                $("#fdeparture_chosen").val(cityvalue);
                                $("#fdeparture_citymid").val(citymid);
                            } else if ($("#fdestination_chosen").is(":focus")) {
                                $("#fdestination_chosen").val(cityvalue);
                                $("#fdestination_citymid").val(citymid);
                                $("#citytype_chosen").val(citytype);
                            } else {
                                mui.toast('获取输入框焦点失败');
                            }


                        });

                        $('.aim_input').focus(function () {

                            if (fdestination_chosen.hasAttribute('autofocus') && city_auto_focus_flag == 2) {
                                fdestination_chosen.removeAttribute('autofocus');
                            } else if (fdeparture_chosen.hasAttribute('autofocus') && city_auto_focus_flag == 2) {
                                fdeparture_chosen.removeAttribute('autofocus');
                            } else {
                                city_auto_focus_flag = 2;
                            }

                        });
                        $("#cancel_city").on('tap', function () {
                            hiddencity();
                        });
                        $("#complete_city").on('tap', function () {
                            var anchor_id = anchor_context.id;
                            //console.log($("#"+anchor_id));
                            $("#" + anchor_id).parent().parent().find("#departure_province").val($("#fdeparture_province_chosen").val());
                            $("#" + anchor_id).parent().parent().find("#destination_province").val($("#fdestination_province_chosen").val());
                            $("#" + anchor_id).parent().parent().find("#departure_city").text($("#fdeparture_chosen").val());
                            $("#" + anchor_id).parent().parent().find("#destination_city").text($("#fdestination_chosen").val());
                            //console.log($("#" + anchor_id).parent().parent().parent());
                            $("#" + anchor_id).parent().parent().parent().find("#farea").val($("#citytype_chosen").val());
                            $("#" + anchor_id).parent().parent().find("#citymid").val($("#fdestination_citymid").val());
                            $("#" + anchor_id).parent().parent().find("#kscitymid").val($("#fdeparture_citymid").val());
                            // console.log($("#" + anchor_id).parent().parent().find("#kscitymid").val());
                            hiddencity();
                        });

                    })(Zepto);
                }
            });



           
        }
        function auto_focus() {
            var autofocus = city_auto_focus_flag;

            var fdestination_chosen = document.getElementById('fdestination_chosen');
            var fdeparture_chosen = document.getElementById('fdeparture_chosen');
            if (autofocus == 0) {
                fdeparture_chosen.setAttribute("autofocus", "autofocus");

            } else if (autofocus == 1) {
                fdestination_chosen.setAttribute("autofocus", "autofocus");
            }

        }

        
        function GetDateDiff(startDate, endDate) {
            var startTime = new Date(Date.parse(startDate.replace(/-/g, "/"))).getTime();
            var endTime = new Date(Date.parse(endDate.replace(/-/g, "/"))).getTime();
            var dates = Math.abs((startTime - endTime)) / (1000 * 60 * 60 * 24);
            return dates;
        }
    </script>
</body>
</html>